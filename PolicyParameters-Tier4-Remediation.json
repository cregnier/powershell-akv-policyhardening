{
  "_comment": "Tier 4: Automation & Remediation Policies (Months 1-6 - Parallel Deployment)",
  "_description": "9 auto-remediation policies with DeployIfNotExists/Modify effects. Deploy parallel with Tier 1/2.",
  "_timeline": "Months 1-6: Deploy with managed identities → Test remediation → Production",
  "_requirements": [
    "Managed Identity: System-assigned or user-assigned with Contributor role",
    "VNet Infrastructure: Subnet for private endpoints",
    "Log Analytics: Workspace for diagnostic logs",
    "Event Hub: Namespace + authorization rule for diagnostic streaming",
    "Private DNS: privatelink.vaultcore.azure.net zone configured"
  ],
  "_successCriteria": "95% automated remediation success rate",
  "_reference": "See ProductionRolloutPlan.md - Tier 4 section + Setup-AzureKeyVaultPolicyEnvironment.ps1",
  
  "Configure Azure Key Vaults with private endpoints": {
    "privateEndpointSubnetId": "/subscriptions/{subscription-id}/resourceGroups/{rg-name}/providers/Microsoft.Network/virtualNetworks/{vnet-name}/subnets/{subnet-name}",
    "effect": "DeployIfNotExists"
  },
  "Configure Azure Key Vaults to use private DNS zones": {
    "privateDnsZoneId": "/subscriptions/{subscription-id}/resourceGroups/{rg-name}/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net",
    "effect": "DeployIfNotExists"
  },
  "Configure key vaults to enable firewall": {
    "effect": "Modify"
  },
  "Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace": {
    "logAnalytics": "/subscriptions/{subscription-id}/resourceGroups/{rg-name}/providers/Microsoft.OperationalInsights/workspaces/{workspace-name}",
    "categoryGroup": "allLogs",
    "effect": "DeployIfNotExists"
  },
  "Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM": {
    "eventHubAuthorizationRuleId": "/subscriptions/{subscription-id}/resourceGroups/{rg-name}/providers/Microsoft.EventHub/namespaces/{namespace-name}/authorizationRules/{rule-name}",
    "eventHubName": "{event-hub-name}",
    "effect": "DeployIfNotExists"
  },
  "[Preview]: Configure Azure Key Vault Managed HSM to disable public network access": {
    "effect": "Modify"
  },
  "[Preview]: Configure Azure Key Vault Managed HSM with private endpoints": {
    "privateEndpointSubnetId": "/subscriptions/{subscription-id}/resourceGroups/{rg-name}/providers/Microsoft.Network/virtualNetworks/{vnet-name}/subnets/{subnet-name}",
    "effect": "DeployIfNotExists"
  },
  "[Preview]: Azure Key Vault Managed HSM should disable public network access": {
    "effect": "Audit"
  },
  "[Preview]: Azure Key Vault Managed HSM should use private link": {
    "effect": "Audit"
  }
}
