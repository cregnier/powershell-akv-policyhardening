**********************
PowerShell transcript start
Start time: 20260122172916
Username: DTL01\lcladmin
RunAs User: DTL01\lcladmin
Configuration Name: 
Machine: DTL01 (Microsoft Windows NT 10.0.20348.0)
Host Application: C:\Program Files\PowerShell\7\pwsh.dll -noexit -command try { . "c:\Program Files\Microsoft VS Code\resources\app\out\vs\workbench\contrib\terminal\common\scripts\shellIntegration.ps1" } catch {}
Process ID: 2380
PSVersion: 7.5.3
PSEdition: Core
GitCommitId: 7.5.3
OS: Microsoft Windows 10.0.20348
Platform: Win32NT
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1, 6.0, 7.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
WSManStackVersion: 3.0
**********************
Transcript started, output file is scenario1-clean-test-20260122-172916.txt
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                   Deploying: DevTest Baseline (30 Policies)
================================================================================

Description:
Safe initial deployment with core policies - Audit mode
Parameter File:
PolicyParameters-DevTest.json
Effect:
Audit
Risk Level:
Low
Duration:
5 minutes

Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED

ğŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json
  -SkipRBACCheck


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 17:29:24Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 17:29:24Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 17:29:24Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 17:29:25Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 17:29:25Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 17:29:25Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 17:29:25Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 17:29:25Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 17:29:25Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 17:29:25Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 17:29:25Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json
[2026-01-22 17:29:25Z]
[INFO]
Detected deployment type: DevTest30 (from parameter file: PolicyParameters-DevTest.json)
[2026-01-22 17:29:25Z]
[INFO]
DEBUG: PSBoundParameters keys: SkipRBACCheck, CsvPath, ParameterOverridesPath
[2026-01-22 17:29:25Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-22 17:29:25Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-22 17:29:29Z]
[INFO]
Checking current subscription context.
[2026-01-22 17:29:29Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 17:29:31Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 17:29:31Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json
[2026-01-22 17:29:31Z]
[SUCCESS]
Loaded 30 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json

Processing 30 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 17:29:31Z]
[INFO]
Preparing to assign (1/30): Certificates should have the specified maximum validity period
[2026-01-22 17:29:31Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:31Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '36' to cleaned params
[2026-01-22 17:29:32Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 17:29:32Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:32Z]
[INFO]
Preparing to assign (2/30): Resource logs in Key Vault should be enabled
[2026-01-22 17:29:32Z]
[INFO]
Assigning policy 'Resource logs in Key Vault should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:32Z]
[SUCCESS]
Found 'Resource logs in Key Vault should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Checking parameter 'requiredRetentionDays' against policy definition
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 17:29:32Z]
[INFO]
DEBUG: Added parameter 'requiredRetentionDays' = '30' to cleaned params
[2026-01-22 17:29:32Z]
[INFO]
Assignment already exists for 'Resource logs in Key Vault should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 17:29:33Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:33Z]
[INFO]
Preparing to assign (3/30): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 17:29:33Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:33Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'CN=ContosoCA CN=InternalCA' to cleaned params
[2026-01-22 17:29:34Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 17:29:34Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:34Z]
[INFO]
Preparing to assign (4/30): [Preview]: Configure Azure Key Vault Managed HSM to disable public network access
[2026-01-22 17:29:34Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:34Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/84d327c3-164a-4685-b453-900478614456
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 17:29:34Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:34Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:34Z]
[INFO]
Preparing to assign (5/30): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 17:29:34Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:34Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 17:29:35Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:35Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 17:29:35Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:35Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 17:29:35Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 17:29:35Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 17:29:35Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 17:29:35Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:35Z]
[INFO]
Preparing to assign (6/30): Configure Azure Key Vaults to use private DNS zones
[2026-01-22 17:29:35Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults to use private DNS zones' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:35Z]
[SUCCESS]
Found 'Configure Azure Key Vaults to use private DNS zones' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01d4
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Checking parameter 'privateDnsZoneId' against policy definition
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Added parameter 'privateDnsZoneId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net' to cleaned params
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:36Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:36Z]
[INFO]
Preparing to assign (7/30): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 17:29:36Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:36Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 17:29:36Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 17:29:36Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 17:29:36Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:36Z]
[INFO]
Preparing to assign (8/30): Certificates should not expire within the specified number of days
[2026-01-22 17:29:36Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:36Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 17:29:37Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:37Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 17:29:37Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:37Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 17:29:37Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 17:29:37Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '30' to cleaned params
[2026-01-22 17:29:37Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 17:29:37Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:37Z]
[INFO]
Preparing to assign (9/30): Deploy Diagnostic Settings for Key Vault to Event Hub
[2026-01-22 17:29:37Z]
[INFO]
Assigning policy 'Deploy Diagnostic Settings for Key Vault to Event Hub' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:37Z]
[SUCCESS]
Found 'Deploy Diagnostic Settings for Key Vault to Event Hub' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-6513/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:38Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:38Z]
[INFO]
Preparing to assign (10/30): Configure key vaults to enable firewall
[2026-01-22 17:29:38Z]
[INFO]
Assigning policy 'Configure key vaults to enable firewall' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:38Z]
[SUCCESS]
Found 'Configure key vaults to enable firewall' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 17:29:38Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:38Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:38Z]
[INFO]
Preparing to assign (11/30): [Preview]: Configure Azure Key Vault Managed HSM with private endpoints
[2026-01-22 17:29:38Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:38Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d1d6d8bb-cc7c-420f-8c7d-6f6f5279a844
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/snet-privateendpoints' to cleaned params
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:39Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:39Z]
[INFO]
Preparing to assign (12/30): Keys should have more than the specified number of days before expiration
[2026-01-22 17:29:39Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:39Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 17:29:39Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 17:29:39Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 17:29:39Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:39Z]
[INFO]
Preparing to assign (13/30): Resource logs in Azure Key Vault Managed HSM should be enabled
[2026-01-22 17:29:39Z]
[INFO]
Assigning policy 'Resource logs in Azure Key Vault Managed HSM should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:39Z]
[SUCCESS]
Found 'Resource logs in Azure Key Vault Managed HSM should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a2a5b911-5617-447e-a49e-59dbe0e0434b
[2026-01-22 17:29:40Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:40Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 17:29:40Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 17:29:40Z]
[INFO]
Assignment already exists for 'Resource logs in Azure Key Vault Managed HSM should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 17:29:40Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:40Z]
[INFO]
Preparing to assign (14/30): Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace
[2026-01-22 17:29:40Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:40Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Checking parameter 'logAnalytics' against policy definition
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Added parameter 'logAnalytics' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6827' to cleaned params
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:41Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:41Z]
[INFO]
Preparing to assign (15/30): Key Vault keys should have an expiration date
[2026-01-22 17:29:41Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:41Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:41Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:41Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 17:29:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:42Z]
[INFO]
Preparing to assign (16/30): Keys should have the specified maximum validity period
[2026-01-22 17:29:42Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:42Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 17:29:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:42Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:42Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 17:29:42Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:42Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 17:29:42Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 17:29:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:42Z]
[INFO]
Preparing to assign (17/30): Key Vault secrets should have an expiration date
[2026-01-22 17:29:42Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:42Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 17:29:43Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:43Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:43Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:43Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 17:29:43Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:43Z]
[INFO]
Preparing to assign (18/30): Key vaults should have soft delete enabled
[2026-01-22 17:29:43Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:43Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 17:29:44Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:44Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:44Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:44Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 17:29:44Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:44Z]
[INFO]
Preparing to assign (19/30): Azure Key Vault should disable public network access
[2026-01-22 17:29:44Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:44Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 17:29:44Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:44Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:44Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:44Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 17:29:45Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:45Z]
[INFO]
Preparing to assign (20/30): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 17:29:45Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:45Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 17:29:45Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 17:29:45Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 17:29:45Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'CN=ContosoCA' to cleaned params
[2026-01-22 17:29:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:45Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 17:29:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:45Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 17:29:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:46Z]
[INFO]
Preparing to assign (21/30): Keys should not be active for longer than the specified number of days
[2026-01-22 17:29:46Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:46Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 17:29:46Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:46Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:46Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:46Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 17:29:46Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:46Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '730' to cleaned params
[2026-01-22 17:29:46Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 17:29:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:46Z]
[INFO]
Preparing to assign (22/30): Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.
[2026-01-22 17:29:46Z]
[INFO]
Assigning policy 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:46Z]
[SUCCESS]
Found 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d8cf8476-a2ec-4916-896e-992351803c44
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Checking parameter 'maximumDaysToRotate' against policy definition
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Added parameter 'maximumDaysToRotate' = '180' to cleaned params
[2026-01-22 17:29:47Z]
[INFO]
Assignment already exists for 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.'. Updating parameters and enforcement mode...
[2026-01-22 17:29:47Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:47Z]
[INFO]
Preparing to assign (23/30): Configure Azure Key Vaults with private endpoints
[2026-01-22 17:29:47Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:47Z]
[SUCCESS]
Found 'Configure Azure Key Vaults with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/9d4fad1f-5189-4a42-b29e-cf7929c6b6df
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/snet-privateendpoints' to cleaned params
[2026-01-22 17:29:47Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:47Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:47Z]
[INFO]
Preparing to assign (24/30): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 17:29:47Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:47Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 17:29:48Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '' to cleaned params
[2026-01-22 17:29:48Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 17:29:48Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:48Z]
[INFO]
Preparing to assign (25/30): Key vaults should have deletion protection enabled
[2026-01-22 17:29:48Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:48Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:49Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 17:29:49Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:49Z]
[INFO]
Preparing to assign (26/30): Certificates should have the specified lifetime action triggers
[2026-01-22 17:29:49Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:49Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '30' to cleaned params
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 17:29:49Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 17:29:49Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 17:29:50Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:50Z]
[INFO]
Preparing to assign (27/30): Secrets should not be active for longer than the specified number of days
[2026-01-22 17:29:50Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:50Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 17:29:50Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:50Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:50Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:50Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 17:29:50Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:50Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '730' to cleaned params
[2026-01-22 17:29:50Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 17:29:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:51Z]
[INFO]
Preparing to assign (28/30): Secrets should have the specified maximum validity period
[2026-01-22 17:29:51Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:51Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 17:29:51Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:51Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:51Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:51Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 17:29:51Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 17:29:51Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 17:29:51Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 17:29:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 17:29:51Z]
[INFO]
Preparing to assign (29/30): Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM
[2026-01-22 17:29:51Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:51Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6d2c800-5230-4a40-bff3-8268b4987d42
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-6513/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 17:29:52Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 17:29:52Z]
[INFO]
Preparing to assign (30/30): Secrets should have more than the specified number of days before expiration
[2026-01-22 17:29:52Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 17:29:52Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 17:29:52Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 17:29:52Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 17:29:53Z]
[SUCCESS]
Updated assignment
[2026-01-22 17:29:53Z]
[INFO]
Collected 22 assignment IDs for filtering
[2026-01-22 17:29:53Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldhavethespecifiedmaximumvalidityperio-407807336, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907

Generating compliance report with operational metrics...
[2026-01-22 17:29:55Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-22 17:29:56Z]
[INFO]
Compliance query returned: Raw states=504, Policies reporting=36
[2026-01-22 17:29:56Z]
[INFO]
Filtering compliance data: 22 assignments, 504 total policy states
[2026-01-22 17:29:56Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldhavethespecifiedmaximumvalidityperio-407807336 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535
[2026-01-22 17:29:56Z]
[INFO]
Found 188 compliance states for newly deployed policies
[2026-01-22 17:29:56Z]
[INFO]
Total unique assignment IDs in compliance data: 36

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
33.51%
 | Policies Reporting:
22
 | Resources Evaluated:
12

[2026-01-22 17:29:56Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-172956.md, KeyVaultPolicyImplementationReport-20260122-172956.json, KeyVaultPolicyImplementationReport-20260122-172956.csv
[2026-01-22 17:29:56Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-172956.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 17:29:56Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-172956.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-172956.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-172956.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (33.51%) - Azure is still evaluating resources

ğŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 33.51% to 60-80% range
with all policies reporting complete data.


[2026-01-22 17:29:56Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 17:29:56Z]
[INFO]
                    ğŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 17:29:56Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ DevTest Deployment Complete (30 Policies - Audit Mode)

âœ… What was deployed:
  â†’ 30 Azure Key Vault governance policies in Audit mode
  â†’ Monitoring compliance without blocking operations
  â†’ Test environment: rg-policy-keyvault-test resource group

ğŸ“‹ Recommended Next Steps:
  1. â³ Wait 30-60 minutes for Azure Policy evaluation cycle
  2. ğŸ“Š Check compliance status:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  3. ğŸ§ª Test infrastructure validation:

.\\AzPolicyImplScript.ps1 -TestInfrastructure -Detailed
  4. ğŸ“ˆ Deploy full 46-policy suite when ready:

.\\AzPolicyImplScript.ps1 -ParameterFile .\\PolicyParameters-DevTest-Full.json

ğŸ“š Documentation:
  â†’ Testing Guide: QUICKSTART.md (lines 1-150)
  â†’ Policy List: DefinitionListExport.csv (first 30 policies)

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!
True

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>.\Deploy-PolicyScenarios.ps1
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                               Deployment History
================================================================================


Scenario 1: DevTest Baseline (30 Policies)
------------------------------------------
  [âœ—]

[ mode]
  [âœ—]

[ mode]


Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


âš ï¸  Invalid choice:
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


âš ï¸  Invalid choice:
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


âš ï¸  Invalid choice:
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


âš ï¸  Invalid choice:
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


âš ï¸  Invalid choice:
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


âš ï¸  Invalid choice: qq
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [âœ— Failed: ]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [Not Deployed]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript
**********************
PowerShell transcript end
End time: 20260122173328
**********************
