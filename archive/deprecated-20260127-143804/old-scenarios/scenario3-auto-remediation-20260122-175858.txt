**********************
PowerShell transcript start
Start time: 20260122175858
Username: DTL01\lcladmin
RunAs User: DTL01\lcladmin
Configuration Name: 
Machine: DTL01 (Microsoft Windows NT 10.0.20348.0)
Host Application: C:\Program Files\PowerShell\7\pwsh.dll -noexit -command try { . "c:\Program Files\Microsoft VS Code\resources\app\out\vs\workbench\contrib\terminal\common\scripts\shellIntegration.ps1" } catch {}
Process ID: 2380
PSVersion: 7.5.3
PSEdition: Core
GitCommitId: 7.5.3
OS: Microsoft Windows 10.0.20348
Platform: Win32NT
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1, 6.0, 7.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
WSManStackVersion: 3.0
**********************
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
               Deploying: DevTest Auto-Remediation (46 Policies)
================================================================================

Description:
Test automated compliance fixes - Audit + DeployIfNotExists
Parameter File:
PolicyParameters-DevTest-Full-Remediation.json
Effect:
Audit + DINE
Risk Level:
Medium
Duration:
60-90 minutes (Azure evaluation)
âš ï¸  This scenario requires a managed identity for auto-remediation.
PS>TerminatingError(): "The term 'Get-ManagedIdentityResourceId' is not recognized as a name of a cmdlet, function, script file, or executable program.
Check the spelling of the name, or if a path was included, verify that the path is correct and try again."

âŒ Unexpected error: The term 'Get-ManagedIdentityResourceId' is not recognized as a name of a cmdlet, function, script file, or executable program.
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
]633;D;1]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâœ… Function added. Testing now...`n" -ForegroundColor Cyan; $outputFile = "scenario3-auto-remediation-$(Get-Date -Format 'yyyyMMdd-HHmmss').txt"; Start-Transcript -Path $outputFile -Append | Out-Null; .\Deploy-PolicyScenarios.ps1

âœ… Function added. Testing now...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [Not Deployed]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
               Deploying: DevTest Auto-Remediation (46 Policies)
================================================================================

Description:
Test automated compliance fixes - Audit + DeployIfNotExists
Parameter File:
PolicyParameters-DevTest-Full-Remediation.json
Effect:
Audit + DINE
Risk Level:
Medium
Duration:
60-90 minutes (Azure evaluation)
âš ï¸  This scenario requires a managed identity for auto-remediation.
  ðŸ” Auto-discovering managed identity...
  âœ… Found: id-policy-remediation
     Resource ID: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
  âœ… Using auto-discovered managed identity


Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED

ðŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -IdentityResourceId /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
  -SkipRBACCheck
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest-Full-Remediation.json


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 18:00:12Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 18:00:12Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 18:00:12Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 18:00:12Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 18:00:12Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 18:00:12Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 18:00:12Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 18:00:12Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 18:00:12Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 18:00:12Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 18:00:12Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest-Full-Remediation.json
[2026-01-22 18:00:12Z]
[INFO]
Detected deployment type: DevTestRemediation (from parameter file: PolicyParameters-DevTest-Full-Remediation.json)
[2026-01-22 18:00:12Z]
[INFO]
DEBUG: PSBoundParameters keys: IdentityResourceId, SkipRBACCheck, CsvPath, ParameterOverridesPath
[2026-01-22 18:00:12Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-22 18:00:13Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-22 18:00:14Z]
[INFO]
Checking current subscription context.
[2026-01-22 18:00:15Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 18:00:16Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 18:00:16Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest-Full-Remediation.json
[2026-01-22 18:00:16Z]
[SUCCESS]
Loaded 46 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest-Full-Remediation.json

Processing 46 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 18:00:16Z]
[INFO]
Preparing to assign (1/46): Secrets should have the specified maximum validity period
[2026-01-22 18:00:16Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:16Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 18:00:17Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:00:17Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:17Z]
[INFO]
Preparing to assign (2/46): Resource logs in Key Vault should be enabled
[2026-01-22 18:00:17Z]
[INFO]
Assigning policy 'Resource logs in Key Vault should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:17Z]
[SUCCESS]
Found 'Resource logs in Key Vault should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Checking parameter 'requiredRetentionDays' against policy definition
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:00:17Z]
[INFO]
DEBUG: Added parameter 'requiredRetentionDays' = '90' to cleaned params
[2026-01-22 18:00:17Z]
[INFO]
Assignment already exists for 'Resource logs in Key Vault should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:00:18Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:18Z]
[INFO]
Preparing to assign (3/46): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 18:00:18Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:18Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 18:00:18Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:18Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:00:18Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:18Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 18:00:18Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:00:18Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'ContosoCA FabrikamCA' to cleaned params
[2026-01-22 18:00:18Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 18:00:19Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:19Z]
[INFO]
Preparing to assign (4/46): [Preview]: Configure Azure Key Vault Managed HSM to disable public network access
[2026-01-22 18:00:19Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:19Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/84d327c3-164a-4685-b453-900478614456
[2026-01-22 18:00:19Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:19Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:19Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:00:19Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:00:19Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:00:22Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:00:22Z]
[INFO]
Assignment already exists for '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:00:23Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:23Z]
[INFO]
Preparing to assign (5/46): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:00:23Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:23Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 18:00:23Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:23Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:00:23Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:23Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:00:23Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:00:23Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:00:23Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:00:23Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:23Z]
[INFO]
Preparing to assign (6/46): Azure Key Vault Managed HSM should have purge protection enabled
[2026-01-22 18:00:23Z]
[INFO]
Assigning policy 'Azure Key Vault Managed HSM should have purge protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:23Z]
[SUCCESS]
Found 'Azure Key Vault Managed HSM should have purge protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c39ba22d-4428-4149-b981-70acb31fc383
[2026-01-22 18:00:24Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:24Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:24Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:24Z]
[INFO]
Assignment already exists for 'Azure Key Vault Managed HSM should have purge protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:00:24Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:24Z]
[INFO]
Preparing to assign (7/46): Certificates using elliptic curve cryptography should have allowed curve names
[2026-01-22 18:00:24Z]
[INFO]
Assigning policy 'Certificates using elliptic curve cryptography should have allowed curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:24Z]
[SUCCESS]
Found 'Certificates using elliptic curve cryptography should have allowed curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/bd78111f-4953-4367-9fd5-7e08808b54bf
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:00:25Z]
[INFO]
Assignment already exists for 'Certificates using elliptic curve cryptography should have allowed curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:00:25Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:25Z]
[INFO]
Preparing to assign (8/46): Keys should be the specified cryptographic type RSA or EC
[2026-01-22 18:00:25Z]
[INFO]
Assigning policy 'Keys should be the specified cryptographic type RSA or EC' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:25Z]
[SUCCESS]
Found 'Keys should be the specified cryptographic type RSA or EC' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75c4f823-d65c-4f29-a733-01d0077fdbcb
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Checking parameter 'cryptographicType' against policy definition
[2026-01-22 18:00:25Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:00:25Z]
[WARN]
DEBUG: Parameter 'cryptographicType' NOT FOUND in policy definition - SKIPPED
[2026-01-22 18:00:25Z]
[WARN]
Parameter 'cryptographicType' not defined in policy. Skipping to avoid UndefinedPolicyParameter error.
[2026-01-22 18:00:25Z]
[INFO]
Assignment already exists for 'Keys should be the specified cryptographic type RSA or EC'. Updating parameters and enforcement mode...
[2026-01-22 18:00:26Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:26Z]
[INFO]
Preparing to assign (9/46): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 18:00:26Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:26Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 18:00:26Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:26Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:00:26Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:26Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:00:26Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:00:26Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:00:26Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:00:27Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:27Z]
[INFO]
Preparing to assign (10/46): [Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:00:27Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:27Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e58fd0c1-feac-4d12-92db-0a7e9421f53e
[2026-01-22 18:00:27Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:27Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:00:27Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:27Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:00:27Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:00:27Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:00:27Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:00:28Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:28Z]
[INFO]
Preparing to assign (11/46): Certificates should not expire within the specified number of days
[2026-01-22 18:00:28Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:28Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 18:00:28Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:28Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:00:28Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:28Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 18:00:28Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:00:28Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '30' to cleaned params
[2026-01-22 18:00:28Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:00:28Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:29Z]
[INFO]
Preparing to assign (12/46): Azure Key Vaults should use private link
[2026-01-22 18:00:29Z]
[INFO]
Assigning policy 'Azure Key Vaults should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:29Z]
[SUCCESS]
Found 'Azure Key Vaults should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9
[2026-01-22 18:00:29Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:29Z]
[INFO]
DEBUG: Defined parameter names: audit_effect, effect
[2026-01-22 18:00:29Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:29Z]
[INFO]
Assignment already exists for 'Azure Key Vaults should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:00:29Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:29Z]
[INFO]
Preparing to assign (13/46): Certificates should be issued by the specified integrated certificate authority
[2026-01-22 18:00:29Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:29Z]
[SUCCESS]
Found 'Certificates should be issued by the specified integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/8e826246-c976-48f6-b03e-619bb92b3d82
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Checking parameter 'allowedCAs' against policy definition
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Added parameter 'allowedCAs' = 'DigiCert GlobalSign' to cleaned params
[2026-01-22 18:00:30Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:00:30Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:30Z]
[INFO]
Preparing to assign (14/46): Keys should be backed by a hardware security module (HSM)
[2026-01-22 18:00:30Z]
[INFO]
Assigning policy 'Keys should be backed by a hardware security module (HSM)' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:30Z]
[SUCCESS]
Found 'Keys should be backed by a hardware security module (HSM)' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/587c79fe-dd04-4a5e-9d0b-f89598c7261b
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:30Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:30Z]
[INFO]
Assignment already exists for 'Keys should be backed by a hardware security module (HSM)'. Updating parameters and enforcement mode...
[2026-01-22 18:00:31Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:31Z]
[INFO]
Preparing to assign (15/46): Keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:00:31Z]
[INFO]
Assigning policy 'Keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:31Z]
[SUCCESS]
Found 'Keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ff25f3c8-b739-4538-9d07-3d6d25cfb255
[2026-01-22 18:00:31Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:31Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:00:31Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:31Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:00:31Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:00:31Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:00:32Z]
[INFO]
Assignment already exists for 'Keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:00:32Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:32Z]
[INFO]
Preparing to assign (16/46): [Preview]: Configure Azure Key Vault Managed HSM with private endpoints
[2026-01-22 18:00:32Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:32Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d1d6d8bb-cc7c-420f-8c7d-6f6f5279a844
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:00:32Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:00:32Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:00:33Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:00:33Z]
[INFO]
Assignment already exists for '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints'. Updating parameters and enforcement mode...
[2026-01-22 18:00:34Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:34Z]
[INFO]
Preparing to assign (17/46): Keys should have more than the specified number of days before expiration
[2026-01-22 18:00:34Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:34Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 18:00:34Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:34Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:00:34Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:34Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:00:34Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:00:34Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:00:34Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:00:35Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:35Z]
[INFO]
Preparing to assign (18/46): Resource logs in Azure Key Vault Managed HSM should be enabled
[2026-01-22 18:00:35Z]
[INFO]
Assigning policy 'Resource logs in Azure Key Vault Managed HSM should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:35Z]
[SUCCESS]
Found 'Resource logs in Azure Key Vault Managed HSM should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a2a5b911-5617-447e-a49e-59dbe0e0434b
[2026-01-22 18:00:35Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:35Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:00:35Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:00:35Z]
[INFO]
Assignment already exists for 'Resource logs in Azure Key Vault Managed HSM should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:00:36Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:36Z]
[INFO]
Preparing to assign (19/46): Deploy Diagnostic Settings for Key Vault to Event Hub
[2026-01-22 18:00:36Z]
[INFO]
Assigning policy 'Deploy Diagnostic Settings for Key Vault to Event Hub' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:36Z]
[SUCCESS]
Found 'Deploy Diagnostic Settings for Key Vault to Event Hub' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:00:36Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:00:36Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:00:37Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:00:37Z]
[INFO]
Assignment already exists for 'Deploy Diagnostic Settings for Key Vault to Event Hub'. Updating parameters and enforcement mode...
[2026-01-22 18:00:37Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:37Z]
[INFO]
Preparing to assign (20/46): [Preview]: Azure Key Vault Managed HSM should use private link
[2026-01-22 18:00:37Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:37Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/59fee2f4-d439-4f1b-9b9a-982e1474bfd8
[2026-01-22 18:00:38Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:38Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:38Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:38Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:00:38Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:38Z]
[INFO]
Preparing to assign (21/46): [Preview]: Azure Key Vault Managed HSM should disable public network access
[2026-01-22 18:00:38Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:38Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/19ea9d63-adee-4431-a95e-1913c6c1c75f
[2026-01-22 18:00:39Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:39Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:39Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:39Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:00:39Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:39Z]
[INFO]
Preparing to assign (22/46): Key Vault keys should have an expiration date
[2026-01-22 18:00:39Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:39Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 18:00:39Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:39Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:39Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:39Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:00:40Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:40Z]
[INFO]
Preparing to assign (23/46): Keys should have the specified maximum validity period
[2026-01-22 18:00:40Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:40Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 18:00:40Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:40Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:40Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:40Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:00:40Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:40Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 18:00:40Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:00:40Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:40Z]
[INFO]
Preparing to assign (24/46): Key Vault secrets should have an expiration date
[2026-01-22 18:00:40Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:41Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 18:00:41Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:41Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:41Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:41Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:00:41Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:41Z]
[INFO]
Preparing to assign (25/46): Key vaults should have soft delete enabled
[2026-01-22 18:00:41Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:41Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 18:00:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:42Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:42Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:00:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:42Z]
[INFO]
Preparing to assign (26/46): Azure Key Vault should disable public network access
[2026-01-22 18:00:42Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:42Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 18:00:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:42Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:42Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:00:43Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:43Z]
[INFO]
Preparing to assign (27/46): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 18:00:43Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:43Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 18:00:43Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 18:00:43Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:00:43Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'ContosoCA' to cleaned params
[2026-01-22 18:00:43Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:43Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:00:43Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:43Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:00:44Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:44Z]
[INFO]
Preparing to assign (28/46): Certificates should have the specified maximum validity period
[2026-01-22 18:00:44Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:44Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 18:00:44Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:44Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:00:44Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:44Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 18:00:44Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:00:44Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '36' to cleaned params
[2026-01-22 18:00:44Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:00:44Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:44Z]
[INFO]
Preparing to assign (29/46): Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace
[2026-01-22 18:00:44Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:44Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: Checking parameter 'logAnalytics' against policy definition
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: Added parameter 'logAnalytics' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6874' to cleaned params
[2026-01-22 18:00:45Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:00:45Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:00:46Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:00:46Z]
[INFO]
Assignment already exists for 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace'. Updating parameters and enforcement mode...
[2026-01-22 18:00:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:46Z]
[INFO]
Preparing to assign (30/46): Keys should not be active for longer than the specified number of days
[2026-01-22 18:00:46Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:46Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 18:00:47Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:47Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:47Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:47Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:00:47Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:47Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 18:00:47Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:00:47Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:47Z]
[INFO]
Preparing to assign (31/46): Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.
[2026-01-22 18:00:47Z]
[INFO]
Assigning policy 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:47Z]
[SUCCESS]
Found 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d8cf8476-a2ec-4916-896e-992351803c44
[2026-01-22 18:00:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:48Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:00:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:48Z]
[INFO]
DEBUG: Checking parameter 'maximumDaysToRotate' against policy definition
[2026-01-22 18:00:48Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:00:48Z]
[INFO]
DEBUG: Added parameter 'maximumDaysToRotate' = '365' to cleaned params
[2026-01-22 18:00:48Z]
[INFO]
Assignment already exists for 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.'. Updating parameters and enforcement mode...
[2026-01-22 18:00:48Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:48Z]
[INFO]
Preparing to assign (32/46): Configure Azure Key Vaults to use private DNS zones
[2026-01-22 18:00:48Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults to use private DNS zones' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:48Z]
[SUCCESS]
Found 'Configure Azure Key Vaults to use private DNS zones' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01d4
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: Checking parameter 'privateDnsZoneId' against policy definition
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: Added parameter 'privateDnsZoneId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net' to cleaned params
[2026-01-22 18:00:49Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:00:49Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:00:50Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:00:50Z]
[INFO]
Assignment already exists for 'Configure Azure Key Vaults to use private DNS zones'. Updating parameters and enforcement mode...
[2026-01-22 18:00:50Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:50Z]
[INFO]
Preparing to assign (33/46): Secrets should have content type set
[2026-01-22 18:00:50Z]
[INFO]
Assigning policy 'Secrets should have content type set' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:50Z]
[SUCCESS]
Found 'Secrets should have content type set' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75262d3e-ba4a-4f43-85f8-9f72c090e5e3
[2026-01-22 18:00:51Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:51Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:51Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:51Z]
[INFO]
Assignment already exists for 'Secrets should have content type set'. Updating parameters and enforcement mode...
[2026-01-22 18:00:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:51Z]
[INFO]
Preparing to assign (34/46): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 18:00:51Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:51Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:00:52Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '' to cleaned params
[2026-01-22 18:00:52Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 18:00:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:52Z]
[INFO]
Preparing to assign (35/46): [Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration
[2026-01-22 18:00:52Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:52Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ad27588c-0198-4c84-81ef-08efd0274653
[2026-01-22 18:00:53Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:53Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:00:53Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:53Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:00:53Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:00:53Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:00:53Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:00:53Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:53Z]
[INFO]
Preparing to assign (36/46): Azure Key Vault should use RBAC permission model
[2026-01-22 18:00:53Z]
[INFO]
Assigning policy 'Azure Key Vault should use RBAC permission model' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:53Z]
[SUCCESS]
Found 'Azure Key Vault should use RBAC permission model' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:54Z]
[INFO]
Assignment already exists for 'Azure Key Vault should use RBAC permission model'. Updating parameters and enforcement mode...
[2026-01-22 18:00:54Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:54Z]
[INFO]
Preparing to assign (37/46): Secrets should have more than the specified number of days before expiration
[2026-01-22 18:00:54Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:54Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:00:54Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:00:54Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:00:55Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:55Z]
[INFO]
Preparing to assign (38/46): Key vaults should have deletion protection enabled
[2026-01-22 18:00:55Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:55Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 18:00:55Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:55Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:55Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:55Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:00:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:56Z]
[INFO]
Preparing to assign (39/46): Certificates should have the specified lifetime action triggers
[2026-01-22 18:00:56Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:56Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '30' to cleaned params
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:00:56Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 18:00:56Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 18:00:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:57Z]
[INFO]
Preparing to assign (40/46): Secrets should not be active for longer than the specified number of days
[2026-01-22 18:00:57Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:57Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 18:00:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:57Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:57Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:00:57Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:00:57Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 18:00:57Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:00:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:57Z]
[INFO]
Preparing to assign (41/46): Configure key vaults to enable firewall
[2026-01-22 18:00:57Z]
[INFO]
Assigning policy 'Configure key vaults to enable firewall' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:57Z]
[SUCCESS]
Found 'Configure key vaults to enable firewall' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc
[2026-01-22 18:00:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:58Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:00:58Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:00:58Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:00:58Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:00:58Z]
[INFO]
Assignment already exists for 'Configure key vaults to enable firewall'. Updating parameters and enforcement mode...
[2026-01-22 18:00:59Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:00:59Z]
[INFO]
Preparing to assign (42/46): [Preview]: Azure Key Vault Managed HSM keys should have an expiration date
[2026-01-22 18:00:59Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:00:59Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1d478a74-21ba-4b9f-9d8f-8e6fced0eec5
[2026-01-22 18:00:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:00:59Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:00:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:00:59Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:01:00Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:01:00Z]
[INFO]
Preparing to assign (43/46): Certificates should use allowed key types
[2026-01-22 18:01:00Z]
[INFO]
Assigning policy 'Certificates should use allowed key types' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:01:00Z]
[SUCCESS]
Found 'Certificates should use allowed key types' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1151cede-290b-4ba0-8b38-0ad145ac888f
[2026-01-22 18:01:00Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:01:00Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:01:00Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:01:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:01:00Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:01:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:01:00Z]
[INFO]
Assignment already exists for 'Certificates should use allowed key types'. Updating parameters and enforcement mode...
[2026-01-22 18:01:01Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:01:01Z]
[INFO]
Preparing to assign (44/46): Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM
[2026-01-22 18:01:01Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:01:01Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6d2c800-5230-4a40-bff3-8268b4987d42
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:01:01Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:01:01Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:01:02Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:01:02Z]
[INFO]
Assignment already exists for 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM'. Updating parameters and enforcement mode...
[2026-01-22 18:01:03Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:01:03Z]
[INFO]
Preparing to assign (45/46): Configure Azure Key Vaults with private endpoints
[2026-01-22 18:01:03Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:01:03Z]
[SUCCESS]
Found 'Configure Azure Key Vaults with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/9d4fad1f-5189-4a42-b29e-cf7929c6b6df
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:01:03Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:01:03Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:01:04Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:01:04Z]
[INFO]
Assignment already exists for 'Configure Azure Key Vaults with private endpoints'. Updating parameters and enforcement mode...
[2026-01-22 18:01:04Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:01:04Z]
[INFO]
Preparing to assign (46/46): [Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:01:04Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:01:04Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/86810a98-8e91-4a44-8386-ec66d0de5d57
[2026-01-22 18:01:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:01:05Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:01:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:01:05Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:01:05Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:01:05Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:01:05Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:01:05Z]
[SUCCESS]
Updated assignment
[2026-01-22 18:01:05Z]
[INFO]
Collected 46 assignment IDs for filtering
[2026-01-22 18:01:05Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907

Generating compliance report with operational metrics...
[2026-01-22 18:01:11Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-22 18:01:12Z]
[INFO]
Compliance query returned: Raw states=504, Policies reporting=36
[2026-01-22 18:01:12Z]
[INFO]
Filtering compliance data: 46 assignments, 504 total policy states
[2026-01-22 18:01:12Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535
[2026-01-22 18:01:12Z]
[INFO]
Found 316 compliance states for newly deployed policies
[2026-01-22 18:01:12Z]
[INFO]
Total unique assignment IDs in compliance data: 36

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
33.54%
 | Policies Reporting:
46
 | Resources Evaluated:
12

[2026-01-22 18:01:12Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-180112.md, KeyVaultPolicyImplementationReport-20260122-180112.json, KeyVaultPolicyImplementationReport-20260122-180112.csv
[2026-01-22 18:01:12Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-180112.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:01:12Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-180112.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-180112.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-180112.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (33.54%) - Azure is still evaluating resources

ðŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 33.54% to 60-80% range
with all policies reporting complete data.


[2026-01-22 18:01:12Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:01:12Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 18:01:12Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŽ¯ Auto-Remediation Deployment Complete (8 Policies - DeployIfNotExists)

âœ… What was deployed:
  â†’ 8 auto-remediation policies (DeployIfNotExists/Modify effects)
  â†’ Managed identity assigned: Contributor role for automatic fixes
  â†’ Policies: Diagnostic settings, Private Endpoints, Soft Delete, Purge Protection

âš ï¸  CRITICAL: Remediation Timeline
  â†’ Azure Policy creates remediation tasks in 10-15 minutes
  â†’ Remediation completes in 2-10 minutes after task creation
  â†’ Total wait time: 15-30 minutes minimum

ðŸ“‹ Recommended Next Steps:
  1. â³ Wait 15-30 minutes for auto-remediation tasks to complete
  2. ðŸ“Š Monitor remediation status:

Get-AzPolicyRemediation -Scope '/subscriptions/YOUR_SUB_ID'
  3. âœ… Verify resources were remediated:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  4. ðŸ“‹ Review remediation tasks in HTML report

ðŸ› Troubleshooting Remediation Failures:
  â†’ Check managed identity has Contributor role
  â†’ Verify no Azure Policy conflicts (conflicting assignments)
  â†’ Review Azure Activity Log for error details

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!
True

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript; Write-Host "`nâœ… Transcript saved`n" -ForegroundColor Green; $transcriptFile = Get-ChildItem -Filter "scenario3-auto-remediation-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1; Write-Host "ðŸ“ Transcript: $($transcriptFile.Name)" -ForegroundColor Cyan; Write-Host "`nðŸ” Running validation script...`n" -ForegroundColor Cyan; .\Validate-Deployment.ps1 -ScenarioNumber 3 -TranscriptFile $transcriptFile.Name -ExpectedParameterFile "PolicyParameters-DevTest-Full-Remediation.json" -ExpectedPolicyCount 46 -ExpectedSkippedCount 0
Transcript stopped, output file is C:\Source\powershell-akv-policyhardening\scenario3-auto-remediation-20260122-175946.txt

âœ… Transcript saved
ðŸ“ Transcript: scenario3-auto-remediation-20260122-175810.txt

ðŸ” Running validation script...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 3          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-DevTest-Full-Remediation.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 46 policies
  âœ… Correct number of policies skipped: 0 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âœ… Next steps guidance present in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-180112.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:01:12
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 33.54%

[2/8] Policies Reporting...
  âœ… Found: 46 policies

[3/8] Resources Evaluated...
  âœ… Found: 316 total (106 compliant, 210 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 3                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âœ… PASS (13/13 checks)

â•â•â• Transcript Validation: 5/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âœ… PASS
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS

Name                           Value
----                           -----
TranscriptValidation           {[PolicyCountCorrect, True], [HistoryTracked, True], [NextStepsInConsole, True], [ParameterFileCorrect, True]â€¦}
ScenarioNumber                 3
HTMLValidation                 {[HasComplianceOverview, True], [HasDeploymentMetadata, True], [HasNextStepsInHTML, True], [HasScope, True]â€¦}

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâœ… Testing validation menu option...`n" -ForegroundColor Cyan; .\Deploy-PolicyScenarios.ps1

âœ… Testing validation menu option...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâœ… Testing validation menu option...`n" -ForegroundColor Cyan; Write-Host "V" | .\Deploy-PolicyScenarios.ps1

âœ… Testing validation menu option...
V
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                               Deployment History
================================================================================


Scenario 1: DevTest Baseline (30 Policies)
------------------------------------------
  [âœ“]
2026-01-22 17:11:17
[Actual mode]
  [âœ“]
2026-01-22 17:29:56
[Actual mode]


Scenario 2: DevTest Full (46 Policies)
--------------------------------------
  [âœ“]
2026-01-22 17:47:56
[Actual mode]


Scenario 3: DevTest Auto-Remediation (46 Policies)
--------------------------------------------------
  [âœ“]
2026-01-22 18:01:12
[Actual mode]


Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                            Validate Last Deployment
================================================================================

Last deployment:
Scenario 3 - DevTest Auto-Remediation (46 Policies)
Timestamp: 01/22/2026 18:01:12
ðŸ“ Transcript: scenario3-auto-remediation-20260122-175858.txt

ðŸ” Running validation...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 3          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-DevTest-Full-Remediation.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 46 policies
  âœ… Correct number of policies skipped: 0 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âœ… Next steps guidance present in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-180112.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:01:12
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 33.54%

[2/8] Policies Reporting...
  âœ… Found: 46 policies

[3/8] Resources Evaluated...
  âœ… Found: 316 total (106 compliant, 210 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 3                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âœ… PASS (13/13 checks)

â•â•â• Transcript Validation: 5/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âœ… PASS
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS

Name                           Value
----                           -----
TranscriptValidation           {[PolicyCountCorrect, True], [HistoryTracked, True], [NextStepsInConsole, True], [ParameterFileCorrect, True]â€¦}
ScenarioNumber                 3
HTMLValidation                 {[HasComplianceOverview, True], [HasDeploymentMetadata, True], [HasNextStepsInHTML, True], [HasScope, True]â€¦}


WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [Not Deployed]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                   Deploying: Production Audit (46 Policies)
================================================================================

Description:
Production monitoring without blocking - Audit mode
Parameter File:
PolicyParameters-Production.json
Effect:
Audit
Risk Level:
Low
Duration:
5 minutes

Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED

ðŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json
  -SkipRBACCheck


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 18:09:36Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 18:09:36Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 18:09:36Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 18:09:36Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 18:09:37Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 18:09:37Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 18:09:37Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 18:09:37Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 18:09:37Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 18:09:37Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 18:09:37Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json
[2026-01-22 18:09:37Z]
[INFO]
Detected deployment type: ProductionAudit (from parameter file: PolicyParameters-Production.json)
[2026-01-22 18:09:37Z]
[INFO]
DEBUG: PSBoundParameters keys: SkipRBACCheck, CsvPath, ParameterOverridesPath
[2026-01-22 18:09:37Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-22 18:09:37Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-22 18:09:38Z]
[INFO]
Checking current subscription context.
[2026-01-22 18:09:38Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 18:09:39Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 18:09:39Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â„¹ï¸  Production Configuration Detected (Audit Mode)            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Using production parameters in Audit mode (recommended first step)
  No resources will be blocked during this deployment

[2026-01-22 18:09:39Z]
[SUCCESS]
Loaded 46 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json

Processing 46 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 18:09:39Z]
[INFO]
Preparing to assign (1/46): Secrets should have the specified maximum validity period
[2026-01-22 18:09:39Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:39Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:09:40Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:09:40Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:40Z]
[INFO]
Preparing to assign (2/46): Resource logs in Key Vault should be enabled
[2026-01-22 18:09:40Z]
[INFO]
Assigning policy 'Resource logs in Key Vault should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:40Z]
[SUCCESS]
Found 'Resource logs in Key Vault should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21
[2026-01-22 18:09:40Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:41Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:09:41Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:09:41Z]
[INFO]
DEBUG: Checking parameter 'requiredRetentionDays' against policy definition
[2026-01-22 18:09:41Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:09:41Z]
[INFO]
DEBUG: Added parameter 'requiredRetentionDays' = '365' to cleaned params
[2026-01-22 18:09:41Z]
[INFO]
Assignment already exists for 'Resource logs in Key Vault should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:09:41Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:41Z]
[INFO]
Preparing to assign (3/46): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 18:09:41Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:41Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'ContosoCA FabrikamCA' to cleaned params
[2026-01-22 18:09:42Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 18:09:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:42Z]
[INFO]
Preparing to assign (4/46): [Preview]: Configure Azure Key Vault Managed HSM to disable public network access
[2026-01-22 18:09:42Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:42Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/84d327c3-164a-4685-b453-900478614456
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:09:42Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:09:42Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:09:42Z]
[INFO]
Preparing to assign (5/46): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:09:42Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:42Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 18:09:43Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:43Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:09:43Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:43Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:09:43Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:09:43Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:09:43Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:09:43Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:43Z]
[INFO]
Preparing to assign (6/46): Azure Key Vault Managed HSM should have purge protection enabled
[2026-01-22 18:09:43Z]
[INFO]
Assigning policy 'Azure Key Vault Managed HSM should have purge protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:43Z]
[SUCCESS]
Found 'Azure Key Vault Managed HSM should have purge protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c39ba22d-4428-4149-b981-70acb31fc383
[2026-01-22 18:09:44Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:44Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:44Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:44Z]
[INFO]
Assignment already exists for 'Azure Key Vault Managed HSM should have purge protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:09:44Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:44Z]
[INFO]
Preparing to assign (7/46): Certificates using elliptic curve cryptography should have allowed curve names
[2026-01-22 18:09:44Z]
[INFO]
Assigning policy 'Certificates using elliptic curve cryptography should have allowed curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:44Z]
[SUCCESS]
Found 'Certificates using elliptic curve cryptography should have allowed curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/bd78111f-4953-4367-9fd5-7e08808b54bf
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:09:45Z]
[INFO]
Assignment already exists for 'Certificates using elliptic curve cryptography should have allowed curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:09:45Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:45Z]
[INFO]
Preparing to assign (8/46): Keys should be the specified cryptographic type RSA or EC
[2026-01-22 18:09:45Z]
[INFO]
Assigning policy 'Keys should be the specified cryptographic type RSA or EC' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:45Z]
[SUCCESS]
Found 'Keys should be the specified cryptographic type RSA or EC' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75c4f823-d65c-4f29-a733-01d0077fdbcb
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:09:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:45Z]
[INFO]
Assignment already exists for 'Keys should be the specified cryptographic type RSA or EC'. Updating parameters and enforcement mode...
[2026-01-22 18:09:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:46Z]
[INFO]
Preparing to assign (9/46): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 18:09:46Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:46Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 18:09:46Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:46Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:09:46Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:46Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:09:46Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:09:46Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:09:46Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:09:47Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:47Z]
[INFO]
Preparing to assign (10/46): [Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:09:47Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:47Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e58fd0c1-feac-4d12-92db-0a7e9421f53e
[2026-01-22 18:09:47Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:47Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:09:47Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:47Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:09:47Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:09:47Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:09:47Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:09:47Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:47Z]
[INFO]
Preparing to assign (11/46): Certificates should not expire within the specified number of days
[2026-01-22 18:09:47Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:47Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 18:09:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:48Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:09:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:48Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 18:09:48Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:09:48Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '90' to cleaned params
[2026-01-22 18:09:48Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:09:48Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:48Z]
[INFO]
Preparing to assign (12/46): Azure Key Vaults should use private link
[2026-01-22 18:09:48Z]
[INFO]
Assigning policy 'Azure Key Vaults should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:48Z]
[SUCCESS]
Found 'Azure Key Vaults should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Defined parameter names: audit_effect, effect
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:49Z]
[INFO]
Assignment already exists for 'Azure Key Vaults should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:09:49Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:49Z]
[INFO]
Preparing to assign (13/46): Certificates should be issued by the specified integrated certificate authority
[2026-01-22 18:09:49Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:49Z]
[SUCCESS]
Found 'Certificates should be issued by the specified integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/8e826246-c976-48f6-b03e-619bb92b3d82
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Checking parameter 'allowedCAs' against policy definition
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:09:49Z]
[INFO]
DEBUG: Added parameter 'allowedCAs' = 'DigiCert GlobalSign' to cleaned params
[2026-01-22 18:09:49Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:09:50Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:50Z]
[INFO]
Preparing to assign (14/46): Keys should be backed by a hardware security module (HSM)
[2026-01-22 18:09:50Z]
[INFO]
Assigning policy 'Keys should be backed by a hardware security module (HSM)' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:50Z]
[SUCCESS]
Found 'Keys should be backed by a hardware security module (HSM)' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/587c79fe-dd04-4a5e-9d0b-f89598c7261b
[2026-01-22 18:09:50Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:50Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:50Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:50Z]
[INFO]
Assignment already exists for 'Keys should be backed by a hardware security module (HSM)'. Updating parameters and enforcement mode...
[2026-01-22 18:09:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:51Z]
[INFO]
Preparing to assign (15/46): Keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:09:51Z]
[INFO]
Assigning policy 'Keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:51Z]
[SUCCESS]
Found 'Keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ff25f3c8-b739-4538-9d07-3d6d25cfb255
[2026-01-22 18:09:51Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:51Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:09:51Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:51Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:09:51Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:09:51Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:09:51Z]
[INFO]
Assignment already exists for 'Keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:09:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:52Z]
[INFO]
Preparing to assign (16/46): Keys should have more than the specified number of days before expiration
[2026-01-22 18:09:52Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:52Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 18:09:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:52Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:09:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:52Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:09:52Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:09:52Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:09:52Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:09:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:52Z]
[INFO]
Preparing to assign (17/46): Resource logs in Azure Key Vault Managed HSM should be enabled
[2026-01-22 18:09:52Z]
[INFO]
Assigning policy 'Resource logs in Azure Key Vault Managed HSM should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:52Z]
[SUCCESS]
Found 'Resource logs in Azure Key Vault Managed HSM should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a2a5b911-5617-447e-a49e-59dbe0e0434b
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:09:53Z]
[INFO]
Assignment already exists for 'Resource logs in Azure Key Vault Managed HSM should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:09:53Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:53Z]
[INFO]
Preparing to assign (18/46): Deploy Diagnostic Settings for Key Vault to Event Hub
[2026-01-22 18:09:53Z]
[INFO]
Assigning policy 'Deploy Diagnostic Settings for Key Vault to Event Hub' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:53Z]
[SUCCESS]
Found 'Deploy Diagnostic Settings for Key Vault to Event Hub' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:09:53Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:09:54Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:09:54Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:09:54Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:09:54Z]
[INFO]
Preparing to assign (19/46): [Preview]: Azure Key Vault Managed HSM should use private link
[2026-01-22 18:09:54Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:54Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/59fee2f4-d439-4f1b-9b9a-982e1474bfd8
[2026-01-22 18:09:54Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:54Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:54Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:09:54Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:54Z]
[INFO]
Preparing to assign (20/46): [Preview]: Azure Key Vault Managed HSM should disable public network access
[2026-01-22 18:09:54Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:54Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/19ea9d63-adee-4431-a95e-1913c6c1c75f
[2026-01-22 18:09:55Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:55Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:55Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:55Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:09:55Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:55Z]
[INFO]
Preparing to assign (21/46): Key Vault keys should have an expiration date
[2026-01-22 18:09:55Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:55Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 18:09:55Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:55Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:55Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:55Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:09:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:56Z]
[INFO]
Preparing to assign (22/46): Keys should have the specified maximum validity period
[2026-01-22 18:09:56Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:56Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 18:09:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:56Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:09:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:56Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:09:56Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:09:56Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:09:56Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:09:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:57Z]
[INFO]
Preparing to assign (23/46): Key Vault secrets should have an expiration date
[2026-01-22 18:09:57Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:57Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 18:09:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:57Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:57Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:09:58Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:58Z]
[INFO]
Preparing to assign (24/46): Key vaults should have soft delete enabled
[2026-01-22 18:09:58Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:58Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 18:09:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:58Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:09:58Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:09:59Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:59Z]
[INFO]
Preparing to assign (25/46): Azure Key Vault should disable public network access
[2026-01-22 18:09:59Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:59Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 18:09:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:09:59Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:09:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:09:59Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:09:59Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:09:59Z]
[INFO]
Preparing to assign (26/46): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 18:09:59Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:09:59Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'ContosoCA' to cleaned params
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:00Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:10:00Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:00Z]
[INFO]
Preparing to assign (27/46): Certificates should have the specified maximum validity period
[2026-01-22 18:10:00Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:00Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:10:00Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '12' to cleaned params
[2026-01-22 18:10:00Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:10:01Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:01Z]
[INFO]
Preparing to assign (28/46): Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace
[2026-01-22 18:10:01Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:01Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: Checking parameter 'logAnalytics' against policy definition
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: Added parameter 'logAnalytics' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6874' to cleaned params
[2026-01-22 18:10:01Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:10:01Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:10:01Z]
[INFO]
Preparing to assign (29/46): Keys should not be active for longer than the specified number of days
[2026-01-22 18:10:01Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:01Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:10:02Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:10:02Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:02Z]
[INFO]
Preparing to assign (30/46): Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.
[2026-01-22 18:10:02Z]
[INFO]
Assigning policy 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:02Z]
[SUCCESS]
Found 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d8cf8476-a2ec-4916-896e-992351803c44
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Checking parameter 'maximumDaysToRotate' against policy definition
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:10:02Z]
[INFO]
DEBUG: Added parameter 'maximumDaysToRotate' = '90' to cleaned params
[2026-01-22 18:10:02Z]
[INFO]
Assignment already exists for 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.'. Updating parameters and enforcement mode...
[2026-01-22 18:10:03Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:03Z]
[INFO]
Preparing to assign (31/46): [Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:10:03Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:03Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/86810a98-8e91-4a44-8386-ec66d0de5d57
[2026-01-22 18:10:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:03Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:10:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:03Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:10:03Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:10:03Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:10:03Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:10:04Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:04Z]
[INFO]
Preparing to assign (32/46): Configure Azure Key Vaults to use private DNS zones
[2026-01-22 18:10:04Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults to use private DNS zones' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:04Z]
[SUCCESS]
Found 'Configure Azure Key Vaults to use private DNS zones' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01d4
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Checking parameter 'privateDnsZoneId' against policy definition
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Added parameter 'privateDnsZoneId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net' to cleaned params
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:10:04Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:10:04Z]
[INFO]
Preparing to assign (33/46): Secrets should have content type set
[2026-01-22 18:10:04Z]
[INFO]
Assigning policy 'Secrets should have content type set' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:04Z]
[SUCCESS]
Found 'Secrets should have content type set' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75262d3e-ba4a-4f43-85f8-9f72c090e5e3
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:10:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:04Z]
[INFO]
Assignment already exists for 'Secrets should have content type set'. Updating parameters and enforcement mode...
[2026-01-22 18:10:05Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:05Z]
[INFO]
Preparing to assign (34/46): [Preview]: Configure Azure Key Vault Managed HSM with private endpoints
[2026-01-22 18:10:05Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:05Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d1d6d8bb-cc7c-420f-8c7d-6f6f5279a844
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:10:05Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:10:05Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:10:05Z]
[INFO]
Preparing to assign (35/46): [Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration
[2026-01-22 18:10:05Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:05Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ad27588c-0198-4c84-81ef-08efd0274653
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:10:06Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:10:06Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:06Z]
[INFO]
Preparing to assign (36/46): Azure Key Vault should use RBAC permission model
[2026-01-22 18:10:06Z]
[INFO]
Assigning policy 'Azure Key Vault should use RBAC permission model' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:06Z]
[SUCCESS]
Found 'Azure Key Vault should use RBAC permission model' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:10:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:10:06Z]
[INFO]
Assignment already exists for 'Azure Key Vault should use RBAC permission model'. Updating parameters and enforcement mode...
[2026-01-22 18:10:07Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:07Z]
[INFO]
Preparing to assign (37/46): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 18:10:07Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:07Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:10:07Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '0.0.0.0/0' to cleaned params
[2026-01-22 18:10:07Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 18:10:08Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:08Z]
[INFO]
Preparing to assign (38/46): Key vaults should have deletion protection enabled
[2026-01-22 18:10:08Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:08Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 18:10:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:08Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:10:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:10:08Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:10:09Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:09Z]
[INFO]
Preparing to assign (39/46): Certificates should have the specified lifetime action triggers
[2026-01-22 18:10:09Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:09Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '90' to cleaned params
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:10:09Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 18:10:09Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 18:10:10Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:10Z]
[INFO]
Preparing to assign (40/46): Secrets should not be active for longer than the specified number of days
[2026-01-22 18:10:10Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:10Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 18:10:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:10Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:10:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:10Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:10:10Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:10:10Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:10:10Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:10:10Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:10Z]
[INFO]
Preparing to assign (41/46): Configure key vaults to enable firewall
[2026-01-22 18:10:10Z]
[INFO]
Assigning policy 'Configure key vaults to enable firewall' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:10Z]
[SUCCESS]
Found 'Configure key vaults to enable firewall' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:10:11Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:10:11Z]
[INFO]
Preparing to assign (42/46): [Preview]: Azure Key Vault Managed HSM keys should have an expiration date
[2026-01-22 18:10:11Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:11Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1d478a74-21ba-4b9f-9d8f-8e6fced0eec5
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:10:11Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:10:11Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:10:12Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:12Z]
[INFO]
Preparing to assign (43/46): Certificates should use allowed key types
[2026-01-22 18:10:12Z]
[INFO]
Assigning policy 'Certificates should use allowed key types' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:12Z]
[SUCCESS]
Found 'Certificates should use allowed key types' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1151cede-290b-4ba0-8b38-0ad145ac888f
[2026-01-22 18:10:12Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:10:12Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:10:12Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:10:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:12Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:10:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:10:12Z]
[INFO]
Assignment already exists for 'Certificates should use allowed key types'. Updating parameters and enforcement mode...
[2026-01-22 18:10:13Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:10:13Z]
[INFO]
Preparing to assign (44/46): Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM
[2026-01-22 18:10:13Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:13Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6d2c800-5230-4a40-bff3-8268b4987d42
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:10:13Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:10:13Z]
[INFO]
Preparing to assign (45/46): Configure Azure Key Vaults with private endpoints
[2026-01-22 18:10:13Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:13Z]
[SUCCESS]
Found 'Configure Azure Key Vaults with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/9d4fad1f-5189-4a42-b29e-cf7929c6b6df
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:13Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:10:14Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:10:14Z]
[INFO]
Preparing to assign (46/46): Secrets should have more than the specified number of days before expiration
[2026-01-22 18:10:14Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:10:14Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:10:14Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:10:14Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:10:14Z]
[SUCCESS]
Updated assignment
[2026-01-22 18:10:14Z]
[INFO]
Collected 38 assignment IDs for filtering
[2026-01-22 18:10:14Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907

Generating compliance report with operational metrics...
[2026-01-22 18:10:20Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-22 18:10:21Z]
[INFO]
Compliance query returned: Raw states=504, Policies reporting=36
[2026-01-22 18:10:21Z]
[INFO]
Filtering compliance data: 38 assignments, 504 total policy states
[2026-01-22 18:10:21Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535
[2026-01-22 18:10:21Z]
[INFO]
Found 268 compliance states for newly deployed policies
[2026-01-22 18:10:21Z]
[INFO]
Total unique assignment IDs in compliance data: 36

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
39.55%
 | Policies Reporting:
38
 | Resources Evaluated:
12

[2026-01-22 18:10:22Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-181021.md, KeyVaultPolicyImplementationReport-20260122-181021.json, KeyVaultPolicyImplementationReport-20260122-181021.csv
[2026-01-22 18:10:22Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-181022.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:10:22Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-181022.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-181021.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-181021.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (39.55%) - Azure is still evaluating resources

ðŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 39.55% to 60-80% range
with all policies reporting complete data.


[2026-01-22 18:10:22Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:10:22Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 18:10:22Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŽ¯ Production Deployment Complete (46 Policies - Audit Mode)

âœ… What was deployed:
  â†’ All 46 Azure Key Vault governance policies in AUDIT mode
  â†’ Production environment: Monitoring compliance without blocking operations
  â†’ Zero operational impact: Existing resources unaffected

âš ï¸  IMPORTANT: Audit Phase Best Practices
  â†’ Recommended monitoring period: 30-90 days before moving to Deny mode
  â†’ Weekly compliance reviews recommended
  â†’ Stakeholder communication: Notify teams of upcoming Deny enforcement

ðŸ“‹ Recommended Next Steps:
  1. â³ Wait 30-60 minutes for Azure Policy evaluation cycle
  2. ðŸ“Š Generate weekly compliance reports:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  3. ðŸ“§ Configure email alerts for non-compliance:
     See: EMAIL-ALERT-CONFIGURATION.md
  4. âœ… Remediate non-compliant resources using HTML report guidance
  5. ðŸš¨ After 30-90 days, upgrade to Deny mode:

.\\AzPolicyImplScript.ps1 -ParameterFile .\\PolicyParameters-Production.json
     (Update effect parameters to 'Deny' in JSON file first)

ðŸ“š Critical Documentation:
  â†’ Pre-Deployment Checklist: PRE-DEPLOYMENT-CHECKLIST.md
  â†’ Email Alert Setup: EMAIL-ALERT-CONFIGURATION.md
  â†’ Deployment Prerequisites: DEPLOYMENT-PREREQUISITES.md

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!
True

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:10:22]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâœ“ Validating Scenario 4...`n" -ForegroundColor Cyan; Write-Host "V" | .\Deploy-PolicyScenarios.ps1

âœ“ Validating Scenario 4...
V
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:10:22]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                            Validate Last Deployment
================================================================================

Last deployment:
Scenario 4 - Production Audit (46 Policies)
Timestamp: 01/22/2026 18:10:22
âš ï¸  No transcript file found for Scenario 4
   Looking for: scenario4-*.txt

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:10:22]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Get-ChildItem -Filter "scenario4-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 3 | Format-Table Name, LastWriteTime, Length
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Get-ChildItem -Filter "*.txt" | Where-Object { $_.Name -match 'scenario.*4' -or $_.Name -match 'production.*audit' } | Sort-Object LastWriteTime -Descending | Select-Object -First 5 | Format-Table Name, LastWriteTime

Name                                           LastWriteTime
----                                           -------------
scenario3-auto-remediation-20260122-175734.txt 1/22/2026 6:14:36 PM
scenario3-auto-remediation-20260122-175432.txt 1/22/2026 6:14:36 PM
scenario3-auto-remediation-20260122-175946.txt 1/22/2026 6:01:51 PM
scenario2-devtest-full-20260122-174659.txt     1/22/2026 5:51:34 PM
scenario-9-output-20260122-154118.txt          1/22/2026 3:42:44 PM

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Get-Content .\.policy-deployment-history.json -Raw | ConvertFrom-Json | ConvertTo-Json -Depth 5
{
  "Scenario1": {
    "Name": "DevTest Baseline (30 Policies)",
    "Deployments": [
      "@{Parameters=; Success=True; Mode=Actual; Timestamp=2026-01-22 17:11:17}",
      "@{Parameters=; Success=True; Mode=Actual; Timestamp=2026-01-22 17:29:56}"
    ]
  },
  "Scenario2": {
    "Name": "DevTest Full (46 Policies)",
    "Deployments": [
      "@{Parameters=; Success=True; Mode=Actual; Timestamp=2026-01-22 17:47:56}"
    ]
  },
  "Scenario3": {
    "Name": "DevTest Auto-Remediation (46 Policies)",
    "Deployments": [
      "@{Parameters=; Success=True; Mode=Actual; Timestamp=2026-01-22 18:01:12}"
    ]
  },
  "Scenario4": {
    "Name": "Production Audit (46 Policies)",
    "Deployments": [
      {
        "Parameters": {
          "ParameterFile": "C:\\Source\\powershell-akv-policyhardening\\PolicyParameters-Production.json",
          "SkipRBACCheck": true
        },
        "Success": true,
        "Mode": "Actual",
        "Timestamp": "2026-01-22 18:10:22"
      }
    ]
  }
}
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>.\Deploy-PolicyScenarios.ps1
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:10:22]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                   Deploying: Production Audit (46 Policies)
================================================================================

Description:
Production monitoring without blocking - Audit mode
Parameter File:
PolicyParameters-Production.json
Effect:
Audit
Risk Level:
Low
Duration:
5 minutes

Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED

ðŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json
  -SkipRBACCheck


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 18:15:35Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 18:15:35Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 18:15:35Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 18:15:35Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 18:15:35Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 18:15:35Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 18:15:35Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 18:15:35Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 18:15:35Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 18:15:35Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 18:15:35Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json
[2026-01-22 18:15:36Z]
[INFO]
Detected deployment type: ProductionAudit (from parameter file: PolicyParameters-Production.json)
[2026-01-22 18:15:36Z]
[INFO]
DEBUG: PSBoundParameters keys: SkipRBACCheck, CsvPath, ParameterOverridesPath
[2026-01-22 18:15:36Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-22 18:15:36Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-22 18:15:39Z]
[INFO]
Checking current subscription context.
[2026-01-22 18:15:39Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 18:15:42Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 18:15:42Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â„¹ï¸  Production Configuration Detected (Audit Mode)            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Using production parameters in Audit mode (recommended first step)
  No resources will be blocked during this deployment

[2026-01-22 18:15:42Z]
[SUCCESS]
Loaded 46 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production.json

Processing 46 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 18:15:42Z]
[INFO]
Preparing to assign (1/46): Secrets should have the specified maximum validity period
[2026-01-22 18:15:42Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:42Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 18:15:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:42Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:15:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:42Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:15:42Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:15:42Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:15:42Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:15:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:42Z]
[INFO]
Preparing to assign (2/46): Resource logs in Key Vault should be enabled
[2026-01-22 18:15:42Z]
[INFO]
Assigning policy 'Resource logs in Key Vault should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:42Z]
[SUCCESS]
Found 'Resource logs in Key Vault should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21
[2026-01-22 18:15:43Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:43Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:15:43Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:15:43Z]
[INFO]
DEBUG: Checking parameter 'requiredRetentionDays' against policy definition
[2026-01-22 18:15:43Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:15:43Z]
[INFO]
DEBUG: Added parameter 'requiredRetentionDays' = '365' to cleaned params
[2026-01-22 18:15:43Z]
[INFO]
Assignment already exists for 'Resource logs in Key Vault should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:15:43Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:43Z]
[INFO]
Preparing to assign (3/46): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 18:15:43Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:43Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 18:15:44Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:44Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:15:44Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:44Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 18:15:44Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:15:44Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'ContosoCA FabrikamCA' to cleaned params
[2026-01-22 18:15:44Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 18:15:44Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:44Z]
[INFO]
Preparing to assign (4/46): [Preview]: Configure Azure Key Vault Managed HSM to disable public network access
[2026-01-22 18:15:44Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:44Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/84d327c3-164a-4685-b453-900478614456
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:15:45Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:15:45Z]
[INFO]
Preparing to assign (5/46): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:15:45Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:45Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:15:45Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:15:45Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:15:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:46Z]
[INFO]
Preparing to assign (6/46): Azure Key Vault Managed HSM should have purge protection enabled
[2026-01-22 18:15:46Z]
[INFO]
Assigning policy 'Azure Key Vault Managed HSM should have purge protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:46Z]
[SUCCESS]
Found 'Azure Key Vault Managed HSM should have purge protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c39ba22d-4428-4149-b981-70acb31fc383
[2026-01-22 18:15:46Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:46Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:46Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:46Z]
[INFO]
Assignment already exists for 'Azure Key Vault Managed HSM should have purge protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:15:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:46Z]
[INFO]
Preparing to assign (7/46): Certificates using elliptic curve cryptography should have allowed curve names
[2026-01-22 18:15:46Z]
[INFO]
Assigning policy 'Certificates using elliptic curve cryptography should have allowed curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:46Z]
[SUCCESS]
Found 'Certificates using elliptic curve cryptography should have allowed curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/bd78111f-4953-4367-9fd5-7e08808b54bf
[2026-01-22 18:15:47Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:47Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:15:47Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:47Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:15:47Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:15:47Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:15:47Z]
[INFO]
Assignment already exists for 'Certificates using elliptic curve cryptography should have allowed curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:15:47Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:47Z]
[INFO]
Preparing to assign (8/46): Keys should be the specified cryptographic type RSA or EC
[2026-01-22 18:15:47Z]
[INFO]
Assigning policy 'Keys should be the specified cryptographic type RSA or EC' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:47Z]
[SUCCESS]
Found 'Keys should be the specified cryptographic type RSA or EC' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75c4f823-d65c-4f29-a733-01d0077fdbcb
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:48Z]
[INFO]
Assignment already exists for 'Keys should be the specified cryptographic type RSA or EC'. Updating parameters and enforcement mode...
[2026-01-22 18:15:48Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:48Z]
[INFO]
Preparing to assign (9/46): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 18:15:48Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:48Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:15:48Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:15:48Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:15:49Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:49Z]
[INFO]
Preparing to assign (10/46): [Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:15:49Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:49Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e58fd0c1-feac-4d12-92db-0a7e9421f53e
[2026-01-22 18:15:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:49Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:15:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:49Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:15:49Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:15:49Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:15:49Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:15:49Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:49Z]
[INFO]
Preparing to assign (11/46): Certificates should not expire within the specified number of days
[2026-01-22 18:15:49Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:49Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '90' to cleaned params
[2026-01-22 18:15:50Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:15:50Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:50Z]
[INFO]
Preparing to assign (12/46): Azure Key Vaults should use private link
[2026-01-22 18:15:50Z]
[INFO]
Assigning policy 'Azure Key Vaults should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:50Z]
[SUCCESS]
Found 'Azure Key Vaults should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Defined parameter names: audit_effect, effect
[2026-01-22 18:15:50Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:50Z]
[INFO]
Assignment already exists for 'Azure Key Vaults should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:15:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:51Z]
[INFO]
Preparing to assign (13/46): Certificates should be issued by the specified integrated certificate authority
[2026-01-22 18:15:51Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:51Z]
[SUCCESS]
Found 'Certificates should be issued by the specified integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/8e826246-c976-48f6-b03e-619bb92b3d82
[2026-01-22 18:15:51Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:51Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:15:51Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:51Z]
[INFO]
DEBUG: Checking parameter 'allowedCAs' against policy definition
[2026-01-22 18:15:51Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:15:51Z]
[INFO]
DEBUG: Added parameter 'allowedCAs' = 'DigiCert GlobalSign' to cleaned params
[2026-01-22 18:15:51Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:15:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:52Z]
[INFO]
Preparing to assign (14/46): Keys should be backed by a hardware security module (HSM)
[2026-01-22 18:15:52Z]
[INFO]
Assigning policy 'Keys should be backed by a hardware security module (HSM)' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:52Z]
[SUCCESS]
Found 'Keys should be backed by a hardware security module (HSM)' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/587c79fe-dd04-4a5e-9d0b-f89598c7261b
[2026-01-22 18:15:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:52Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:52Z]
[INFO]
Assignment already exists for 'Keys should be backed by a hardware security module (HSM)'. Updating parameters and enforcement mode...
[2026-01-22 18:15:53Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:53Z]
[INFO]
Preparing to assign (15/46): Keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:15:53Z]
[INFO]
Assigning policy 'Keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:53Z]
[SUCCESS]
Found 'Keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ff25f3c8-b739-4538-9d07-3d6d25cfb255
[2026-01-22 18:15:53Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:53Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:15:53Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:53Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:15:53Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:15:53Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:15:53Z]
[INFO]
Assignment already exists for 'Keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:15:54Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:54Z]
[INFO]
Preparing to assign (16/46): Keys should have more than the specified number of days before expiration
[2026-01-22 18:15:54Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:54Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 18:15:54Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:54Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:15:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:54Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:15:54Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:15:54Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:15:54Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:15:54Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:54Z]
[INFO]
Preparing to assign (17/46): Resource logs in Azure Key Vault Managed HSM should be enabled
[2026-01-22 18:15:54Z]
[INFO]
Assigning policy 'Resource logs in Azure Key Vault Managed HSM should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:54Z]
[SUCCESS]
Found 'Resource logs in Azure Key Vault Managed HSM should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a2a5b911-5617-447e-a49e-59dbe0e0434b
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:15:55Z]
[INFO]
Assignment already exists for 'Resource logs in Azure Key Vault Managed HSM should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:15:55Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:55Z]
[INFO]
Preparing to assign (18/46): Deploy Diagnostic Settings for Key Vault to Event Hub
[2026-01-22 18:15:55Z]
[INFO]
Assigning policy 'Deploy Diagnostic Settings for Key Vault to Event Hub' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:55Z]
[SUCCESS]
Found 'Deploy Diagnostic Settings for Key Vault to Event Hub' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:15:55Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:15:55Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:15:56Z]
[INFO]
Preparing to assign (19/46): [Preview]: Azure Key Vault Managed HSM should use private link
[2026-01-22 18:15:56Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:56Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/59fee2f4-d439-4f1b-9b9a-982e1474bfd8
[2026-01-22 18:15:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:56Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:56Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:15:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:56Z]
[INFO]
Preparing to assign (20/46): [Preview]: Azure Key Vault Managed HSM should disable public network access
[2026-01-22 18:15:56Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:57Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/19ea9d63-adee-4431-a95e-1913c6c1c75f
[2026-01-22 18:15:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:57Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:15:57Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:15:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:57Z]
[INFO]
Preparing to assign (21/46): Key Vault keys should have an expiration date
[2026-01-22 18:15:57Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:57Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:58Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:15:58Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:58Z]
[INFO]
Preparing to assign (22/46): Keys should have the specified maximum validity period
[2026-01-22 18:15:58Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:58Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:15:58Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:15:58Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:15:59Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:15:59Z]
[INFO]
Preparing to assign (23/46): Key Vault secrets should have an expiration date
[2026-01-22 18:15:59Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:15:59Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 18:15:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:15:59Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:15:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:15:59Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:16:00Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:00Z]
[INFO]
Preparing to assign (24/46): Key vaults should have soft delete enabled
[2026-01-22 18:16:00Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:00Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 18:16:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:00Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:00Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:16:01Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:01Z]
[INFO]
Preparing to assign (25/46): Azure Key Vault should disable public network access
[2026-01-22 18:16:01Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:01Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 18:16:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:01Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:01Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:16:01Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:01Z]
[INFO]
Preparing to assign (26/46): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 18:16:01Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:01Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'ContosoCA' to cleaned params
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:02Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:16:02Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:02Z]
[INFO]
Preparing to assign (27/46): Certificates should have the specified maximum validity period
[2026-01-22 18:16:02Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:02Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:16:02Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '12' to cleaned params
[2026-01-22 18:16:03Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:16:03Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:03Z]
[INFO]
Preparing to assign (28/46): Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace
[2026-01-22 18:16:03Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:03Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: Checking parameter 'logAnalytics' against policy definition
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: Added parameter 'logAnalytics' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6874' to cleaned params
[2026-01-22 18:16:03Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:16:03Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:16:03Z]
[INFO]
Preparing to assign (29/46): Keys should not be active for longer than the specified number of days
[2026-01-22 18:16:03Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:03Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:16:04Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:16:04Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:04Z]
[INFO]
Preparing to assign (30/46): Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.
[2026-01-22 18:16:04Z]
[INFO]
Assigning policy 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:04Z]
[SUCCESS]
Found 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d8cf8476-a2ec-4916-896e-992351803c44
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Checking parameter 'maximumDaysToRotate' against policy definition
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:16:04Z]
[INFO]
DEBUG: Added parameter 'maximumDaysToRotate' = '90' to cleaned params
[2026-01-22 18:16:04Z]
[INFO]
Assignment already exists for 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.'. Updating parameters and enforcement mode...
[2026-01-22 18:16:05Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:05Z]
[INFO]
Preparing to assign (31/46): [Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:16:05Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:05Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/86810a98-8e91-4a44-8386-ec66d0de5d57
[2026-01-22 18:16:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:05Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:16:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:05Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:16:05Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:16:05Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:16:05Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:16:06Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:06Z]
[INFO]
Preparing to assign (32/46): Configure Azure Key Vaults to use private DNS zones
[2026-01-22 18:16:06Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults to use private DNS zones' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:06Z]
[SUCCESS]
Found 'Configure Azure Key Vaults to use private DNS zones' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01d4
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Checking parameter 'privateDnsZoneId' against policy definition
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Added parameter 'privateDnsZoneId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net' to cleaned params
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:16:06Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:16:06Z]
[INFO]
Preparing to assign (33/46): Secrets should have content type set
[2026-01-22 18:16:06Z]
[INFO]
Assigning policy 'Secrets should have content type set' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:06Z]
[SUCCESS]
Found 'Secrets should have content type set' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75262d3e-ba4a-4f43-85f8-9f72c090e5e3
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:06Z]
[INFO]
Assignment already exists for 'Secrets should have content type set'. Updating parameters and enforcement mode...
[2026-01-22 18:16:07Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:07Z]
[INFO]
Preparing to assign (34/46): [Preview]: Configure Azure Key Vault Managed HSM with private endpoints
[2026-01-22 18:16:07Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:07Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d1d6d8bb-cc7c-420f-8c7d-6f6f5279a844
[2026-01-22 18:16:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:07Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:16:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:16:07Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:16:08Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:16:08Z]
[INFO]
Preparing to assign (35/46): [Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration
[2026-01-22 18:16:08Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:08Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ad27588c-0198-4c84-81ef-08efd0274653
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:16:08Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:16:08Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:16:09Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:09Z]
[INFO]
Preparing to assign (36/46): Azure Key Vault should use RBAC permission model
[2026-01-22 18:16:09Z]
[INFO]
Assigning policy 'Azure Key Vault should use RBAC permission model' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:09Z]
[SUCCESS]
Found 'Azure Key Vault should use RBAC permission model' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5
[2026-01-22 18:16:09Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:09Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:09Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:09Z]
[INFO]
Assignment already exists for 'Azure Key Vault should use RBAC permission model'. Updating parameters and enforcement mode...
[2026-01-22 18:16:10Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:10Z]
[INFO]
Preparing to assign (37/46): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 18:16:10Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:10Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:16:10Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '0.0.0.0/0' to cleaned params
[2026-01-22 18:16:10Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 18:16:10Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:10Z]
[INFO]
Preparing to assign (38/46): Key vaults should have deletion protection enabled
[2026-01-22 18:16:10Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:11Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 18:16:11Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:11Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:11Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:11Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:16:11Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:11Z]
[INFO]
Preparing to assign (39/46): Certificates should have the specified lifetime action triggers
[2026-01-22 18:16:11Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:11Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '90' to cleaned params
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 18:16:12Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 18:16:12Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:12Z]
[INFO]
Preparing to assign (40/46): Secrets should not be active for longer than the specified number of days
[2026-01-22 18:16:12Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:12Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:16:12Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:16:12Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:16:13Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:13Z]
[INFO]
Preparing to assign (41/46): Configure key vaults to enable firewall
[2026-01-22 18:16:13Z]
[INFO]
Assigning policy 'Configure key vaults to enable firewall' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:13Z]
[SUCCESS]
Found 'Configure key vaults to enable firewall' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc
[2026-01-22 18:16:13Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:13Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:13Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:16:13Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:16:13Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:16:13Z]
[INFO]
Preparing to assign (42/46): [Preview]: Azure Key Vault Managed HSM keys should have an expiration date
[2026-01-22 18:16:13Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:13Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1d478a74-21ba-4b9f-9d8f-8e6fced0eec5
[2026-01-22 18:16:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:14Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:16:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:14Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:16:14Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:14Z]
[INFO]
Preparing to assign (43/46): Certificates should use allowed key types
[2026-01-22 18:16:14Z]
[INFO]
Assigning policy 'Certificates should use allowed key types' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:14Z]
[SUCCESS]
Found 'Certificates should use allowed key types' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1151cede-290b-4ba0-8b38-0ad145ac888f
[2026-01-22 18:16:15Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:16:15Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:16:15Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:16:15Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:15Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:16:15Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:16:15Z]
[INFO]
Assignment already exists for 'Certificates should use allowed key types'. Updating parameters and enforcement mode...
[2026-01-22 18:16:15Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:16:15Z]
[INFO]
Preparing to assign (44/46): Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM
[2026-01-22 18:16:15Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:15Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6d2c800-5230-4a40-bff3-8268b4987d42
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:16:16Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:16:16Z]
[INFO]
Preparing to assign (45/46): Configure Azure Key Vaults with private endpoints
[2026-01-22 18:16:16Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:16Z]
[SUCCESS]
Found 'Configure Azure Key Vaults with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/9d4fad1f-5189-4a42-b29e-cf7929c6b6df
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:16:16Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:16:16Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:16:16Z]
[INFO]
Preparing to assign (46/46): Secrets should have more than the specified number of days before expiration
[2026-01-22 18:16:16Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:16:16Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 18:16:17Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:16:17Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:16:17Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:16:17Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:16:17Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:16:17Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:16:17Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:16:17Z]
[SUCCESS]
Updated assignment
[2026-01-22 18:16:17Z]
[INFO]
Collected 38 assignment IDs for filtering
[2026-01-22 18:16:17Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907

Generating compliance report with operational metrics...
[2026-01-22 18:16:22Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-22 18:16:23Z]
[INFO]
Compliance query returned: Raw states=504, Policies reporting=36
[2026-01-22 18:16:23Z]
[INFO]
Filtering compliance data: 38 assignments, 504 total policy states
[2026-01-22 18:16:23Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535
[2026-01-22 18:16:23Z]
[INFO]
Found 268 compliance states for newly deployed policies
[2026-01-22 18:16:23Z]
[INFO]
Total unique assignment IDs in compliance data: 36

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
39.55%
 | Policies Reporting:
38
 | Resources Evaluated:
12

[2026-01-22 18:16:23Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-181623.md, KeyVaultPolicyImplementationReport-20260122-181623.json, KeyVaultPolicyImplementationReport-20260122-181623.csv
[2026-01-22 18:16:23Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-181623.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:16:23Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-181623.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-181623.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-181623.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (39.55%) - Azure is still evaluating resources

ðŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 39.55% to 60-80% range
with all policies reporting complete data.


[2026-01-22 18:16:24Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:16:24Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 18:16:24Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŽ¯ Production Deployment Complete (46 Policies - Audit Mode)

âœ… What was deployed:
  â†’ All 46 Azure Key Vault governance policies in AUDIT mode
  â†’ Production environment: Monitoring compliance without blocking operations
  â†’ Zero operational impact: Existing resources unaffected

âš ï¸  IMPORTANT: Audit Phase Best Practices
  â†’ Recommended monitoring period: 30-90 days before moving to Deny mode
  â†’ Weekly compliance reviews recommended
  â†’ Stakeholder communication: Notify teams of upcoming Deny enforcement

ðŸ“‹ Recommended Next Steps:
  1. â³ Wait 30-60 minutes for Azure Policy evaluation cycle
  2. ðŸ“Š Generate weekly compliance reports:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  3. ðŸ“§ Configure email alerts for non-compliance:
     See: EMAIL-ALERT-CONFIGURATION.md
  4. âœ… Remediate non-compliant resources using HTML report guidance
  5. ðŸš¨ After 30-90 days, upgrade to Deny mode:

.\\AzPolicyImplScript.ps1 -ParameterFile .\\PolicyParameters-Production.json
     (Update effect parameters to 'Deny' in JSON file first)

ðŸ“š Critical Documentation:
  â†’ Pre-Deployment Checklist: PRE-DEPLOYMENT-CHECKLIST.md
  â†’ Email Alert Setup: EMAIL-ALERT-CONFIGURATION.md
  â†’ Deployment Prerequisites: DEPLOYMENT-PREREQUISITES.md

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!
True

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Get-ChildItem -Filter "scenario4-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Write-Host "âœ“ Found transcript: $($_.Name)" -ForegroundColor Green }
âœ“ Found transcript: scenario4-production-audit-46-policies-20260122-181535.txt
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâœ“ Running Validation for Scenario 4...`n" -ForegroundColor Cyan; .\Validate-Deployment.ps1 -ScenarioNumber 4 -TranscriptPath ".\scenario4-production-audit-46-policies-20260122-181535.txt" -ExpectedMode "Actual" -ExpectedPolicyCount 46 -ExpectedParameterFile "PolicyParameters-Production.json"

âœ“ Running Validation for Scenario 4...
PS>TerminatingError(Validate-Deployment.ps1): "A parameter cannot be found that matches parameter name 'TranscriptPath'."
Validate-Deployment.ps1: A parameter cannot be found that matches parameter name 'TranscriptPath'.
Validate-Deployment.ps1: A parameter cannot be found that matches parameter name 'TranscriptPath'.
]633;D;1]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâœ“ Running Validation for Scenario 4...`n" -ForegroundColor Cyan; .\Validate-Deployment.ps1 -ScenarioNumber 4 -TranscriptFile ".\scenario4-production-audit-46-policies-20260122-181535.txt" -ExpectedParameterFile "PolicyParameters-Production.json" -ExpectedPolicyCount 46 -ExpectedSkippedCount 8

âœ“ Running Validation for Scenario 4...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 4          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-Production.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 46 policies
  âœ… Correct number of policies skipped: 8 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âœ… Next steps guidance present in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-181623.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:16:24
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 39.55%

[2/8] Policies Reporting...
  âœ… Found: 38 policies

[3/8] Resources Evaluated...
  âœ… Found: 268 total (106 compliant, 162 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 4                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âœ… PASS (13/13 checks)

â•â•â• Transcript Validation: 5/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âœ… PASS
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS

Name                           Value
----                           -----
TranscriptValidation           {[PolicyCountCorrect, True], [HistoryTracked, True], [NextStepsInConsole, True], [ParameterFileCorrect, True]â€¦}
ScenarioNumber                 4
HTMLValidation                 {[HasComplianceOverview, True], [HasDeploymentMetadata, True], [HasNextStepsInHTML, True], [HasScope, True]â€¦}

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nðŸ“‹ Scenario 4: âœ… VALIDATED (13/13 checks passed)`n" -ForegroundColor Green; Write-Host "ðŸš€ Starting Scenario 5: Production Deny (35 Policies)`n" -ForegroundColor Cyan; Write-Host "âš ï¸  WARNING: HIGH RISK - This will BLOCK non-compliant resources!`n" -ForegroundColor Yellow; .\Deploy-PolicyScenarios.ps1

ðŸ“‹ Scenario 4: âœ… VALIDATED (13/13 checks passed)
ðŸš€ Starting Scenario 5: Production Deny (35 Policies)
âš ï¸  WARNING: HIGH RISK - This will BLOCK non-compliant resources!
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [Not Deployed]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                    Deploying: Production Deny (35 Policies)
================================================================================

Description:
Maximum enforcement - BLOCKS non-compliant resources
Parameter File:
PolicyParameters-Production-Deny.json
Effect:
Deny
Risk Level:
HIGH
Duration:
5 minutes

Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED
â— WARNING: This scenario has HIGH RISK LEVEL
   Maximum enforcement - BLOCKS non-compliant resources

ðŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Deny.json
  -SkipRBACCheck


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 18:17:44Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 18:17:44Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 18:17:44Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 18:17:44Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 18:17:44Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 18:17:44Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 18:17:44Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 18:17:44Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 18:17:44Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 18:17:44Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 18:17:44Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Deny.json
[2026-01-22 18:17:44Z]
[INFO]
Detected deployment type: Custom (from parameter file: PolicyParameters-Production-Deny.json)
[2026-01-22 18:17:44Z]
[INFO]
DEBUG: PSBoundParameters keys: SkipRBACCheck, CsvPath, ParameterOverridesPath
[2026-01-22 18:17:44Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-22 18:17:44Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-22 18:17:47Z]
[INFO]
Checking current subscription context.
[2026-01-22 18:17:47Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 18:17:49Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 18:17:49Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Deny.json

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â„¹ï¸  Production Configuration Detected (Audit Mode)            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Using production parameters in Audit mode (recommended first step)
  No resources will be blocked during this deployment

[2026-01-22 18:17:49Z]
[SUCCESS]
Loaded 34 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Deny.json

Processing 34 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 18:17:49Z]
[INFO]
Preparing to assign (1/34): Secrets should have the specified maximum validity period
[2026-01-22 18:17:49Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:49Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 18:17:49Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:49Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:17:49Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:49Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:17:49Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:17:49Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:17:49Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:17:50Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:50Z]
[INFO]
Preparing to assign (2/34): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 18:17:50Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:50Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 18:17:50Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:50Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:17:50Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:50Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 18:17:50Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:17:50Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'ContosoCA FabrikamCA' to cleaned params
[2026-01-22 18:17:50Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 18:17:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:51Z]
[INFO]
Preparing to assign (3/34): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:17:51Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:51Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 18:17:51Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:51Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:17:51Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:51Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:17:51Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:17:51Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:17:51Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:17:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:52Z]
[INFO]
Preparing to assign (4/34): Azure Key Vault Managed HSM should have purge protection enabled
[2026-01-22 18:17:52Z]
[INFO]
Assigning policy 'Azure Key Vault Managed HSM should have purge protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:52Z]
[SUCCESS]
Found 'Azure Key Vault Managed HSM should have purge protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c39ba22d-4428-4149-b981-70acb31fc383
[2026-01-22 18:17:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:52Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:17:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:52Z]
[INFO]
Assignment already exists for 'Azure Key Vault Managed HSM should have purge protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:17:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:52Z]
[INFO]
Preparing to assign (5/34): Certificates using elliptic curve cryptography should have allowed curve names
[2026-01-22 18:17:52Z]
[INFO]
Assigning policy 'Certificates using elliptic curve cryptography should have allowed curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:52Z]
[SUCCESS]
Found 'Certificates using elliptic curve cryptography should have allowed curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/bd78111f-4953-4367-9fd5-7e08808b54bf
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:17:53Z]
[INFO]
Assignment already exists for 'Certificates using elliptic curve cryptography should have allowed curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:17:53Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:53Z]
[INFO]
Preparing to assign (6/34): Keys should be the specified cryptographic type RSA or EC
[2026-01-22 18:17:53Z]
[INFO]
Assigning policy 'Keys should be the specified cryptographic type RSA or EC' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:53Z]
[SUCCESS]
Found 'Keys should be the specified cryptographic type RSA or EC' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75c4f823-d65c-4f29-a733-01d0077fdbcb
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:53Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Checking parameter 'cryptographicType' against policy definition
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:17:54Z]
[WARN]
DEBUG: Parameter 'cryptographicType' NOT FOUND in policy definition - SKIPPED
[2026-01-22 18:17:54Z]
[WARN]
Parameter 'cryptographicType' not defined in policy. Skipping to avoid UndefinedPolicyParameter error.
[2026-01-22 18:17:54Z]
[INFO]
Assignment already exists for 'Keys should be the specified cryptographic type RSA or EC'. Updating parameters and enforcement mode...
[2026-01-22 18:17:54Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:54Z]
[INFO]
Preparing to assign (7/34): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 18:17:54Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:54Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:17:54Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:17:54Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:17:55Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:55Z]
[INFO]
Preparing to assign (8/34): [Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:17:55Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:55Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e58fd0c1-feac-4d12-92db-0a7e9421f53e
[2026-01-22 18:17:55Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:55Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:17:55Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:55Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:17:55Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:17:55Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:17:55Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:17:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:56Z]
[INFO]
Preparing to assign (9/34): Certificates should not expire within the specified number of days
[2026-01-22 18:17:56Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:56Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 18:17:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:56Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:17:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:56Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 18:17:56Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:17:56Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '90' to cleaned params
[2026-01-22 18:17:56Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:17:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:57Z]
[INFO]
Preparing to assign (10/34): Azure Key Vaults should use private link
[2026-01-22 18:17:57Z]
[INFO]
Assigning policy 'Azure Key Vaults should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:57Z]
[SUCCESS]
Found 'Azure Key Vaults should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9
[2026-01-22 18:17:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:57Z]
[INFO]
DEBUG: Defined parameter names: audit_effect, effect
[2026-01-22 18:17:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:57Z]
[INFO]
Assignment already exists for 'Azure Key Vaults should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:17:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:57Z]
[INFO]
Preparing to assign (11/34): Certificates should be issued by the specified integrated certificate authority
[2026-01-22 18:17:57Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:57Z]
[SUCCESS]
Found 'Certificates should be issued by the specified integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/8e826246-c976-48f6-b03e-619bb92b3d82
[2026-01-22 18:17:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:58Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:17:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:58Z]
[INFO]
DEBUG: Checking parameter 'allowedCAs' against policy definition
[2026-01-22 18:17:58Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:17:58Z]
[INFO]
DEBUG: Added parameter 'allowedCAs' = 'DigiCert GlobalSign' to cleaned params
[2026-01-22 18:17:58Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:17:58Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:58Z]
[INFO]
Preparing to assign (12/34): Keys should be backed by a hardware security module (HSM)
[2026-01-22 18:17:58Z]
[INFO]
Assigning policy 'Keys should be backed by a hardware security module (HSM)' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:58Z]
[SUCCESS]
Found 'Keys should be backed by a hardware security module (HSM)' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/587c79fe-dd04-4a5e-9d0b-f89598c7261b
[2026-01-22 18:17:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:17:59Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:17:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:17:59Z]
[INFO]
Assignment already exists for 'Keys should be backed by a hardware security module (HSM)'. Updating parameters and enforcement mode...
[2026-01-22 18:17:59Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:17:59Z]
[INFO]
Preparing to assign (13/34): Keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:17:59Z]
[INFO]
Assigning policy 'Keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:17:59Z]
[SUCCESS]
Found 'Keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ff25f3c8-b739-4538-9d07-3d6d25cfb255
[2026-01-22 18:18:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:00Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:18:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:00Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:18:00Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:18:00Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:18:00Z]
[INFO]
Assignment already exists for 'Keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:18:00Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:00Z]
[INFO]
Preparing to assign (14/34): Keys should have more than the specified number of days before expiration
[2026-01-22 18:18:00Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:00Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 18:18:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:01Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:18:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:01Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:18:01Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:18:01Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:18:01Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:18:01Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:01Z]
[INFO]
Preparing to assign (15/34): [Preview]: Azure Key Vault Managed HSM should disable public network access
[2026-01-22 18:18:01Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:01Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/19ea9d63-adee-4431-a95e-1913c6c1c75f
[2026-01-22 18:18:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:02Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:02Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:18:02Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:02Z]
[INFO]
Preparing to assign (16/34): Key Vault keys should have an expiration date
[2026-01-22 18:18:02Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:02Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 18:18:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:02Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:02Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:18:03Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:03Z]
[INFO]
Preparing to assign (17/34): Keys should have the specified maximum validity period
[2026-01-22 18:18:03Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:03Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 18:18:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:03Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:18:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:03Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:18:03Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:18:03Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:18:03Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:18:04Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:04Z]
[INFO]
Preparing to assign (18/34): Key Vault secrets should have an expiration date
[2026-01-22 18:18:04Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:04Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 18:18:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:04Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:04Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:18:04Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:04Z]
[INFO]
Preparing to assign (19/34): Key vaults should have soft delete enabled
[2026-01-22 18:18:04Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:04Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 18:18:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:05Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:05Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:18:06Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:06Z]
[INFO]
Preparing to assign (20/34): Azure Key Vault should disable public network access
[2026-01-22 18:18:06Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:06Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 18:18:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:06Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:06Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:18:06Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:06Z]
[INFO]
Preparing to assign (21/34): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 18:18:06Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:06Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'ContosoCA' to cleaned params
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:07Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:18:07Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:07Z]
[INFO]
Preparing to assign (22/34): Certificates should have the specified maximum validity period
[2026-01-22 18:18:07Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:07Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:18:07Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '12' to cleaned params
[2026-01-22 18:18:07Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:18:08Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:08Z]
[INFO]
Preparing to assign (23/34): Keys should not be active for longer than the specified number of days
[2026-01-22 18:18:08Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:08Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 18:18:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:08Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:18:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:08Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:18:08Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:18:08Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:18:08Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:18:09Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:09Z]
[INFO]
Preparing to assign (24/34): Secrets should have content type set
[2026-01-22 18:18:09Z]
[INFO]
Assigning policy 'Secrets should have content type set' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:09Z]
[SUCCESS]
Found 'Secrets should have content type set' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75262d3e-ba4a-4f43-85f8-9f72c090e5e3
[2026-01-22 18:18:09Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:09Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:09Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:09Z]
[INFO]
Assignment already exists for 'Secrets should have content type set'. Updating parameters and enforcement mode...
[2026-01-22 18:18:10Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:10Z]
[INFO]
Preparing to assign (25/34): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 18:18:10Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:10Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:18:10Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '0.0.0.0/0' to cleaned params
[2026-01-22 18:18:10Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 18:18:10Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:10Z]
[INFO]
Preparing to assign (26/34): [Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration
[2026-01-22 18:18:10Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:10Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ad27588c-0198-4c84-81ef-08efd0274653
[2026-01-22 18:18:11Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:11Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:18:11Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:11Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:18:11Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:18:11Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:18:11Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:18:11Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:11Z]
[INFO]
Preparing to assign (27/34): Azure Key Vault should use RBAC permission model
[2026-01-22 18:18:11Z]
[INFO]
Assigning policy 'Azure Key Vault should use RBAC permission model' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:11Z]
[SUCCESS]
Found 'Azure Key Vault should use RBAC permission model' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:12Z]
[INFO]
Assignment already exists for 'Azure Key Vault should use RBAC permission model'. Updating parameters and enforcement mode...
[2026-01-22 18:18:12Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:12Z]
[INFO]
Preparing to assign (28/34): Secrets should have more than the specified number of days before expiration
[2026-01-22 18:18:12Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:12Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:18:12Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:18:12Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:18:13Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:13Z]
[INFO]
Preparing to assign (29/34): Key vaults should have deletion protection enabled
[2026-01-22 18:18:13Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:13Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 18:18:13Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:13Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:13Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:13Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:18:13Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:13Z]
[INFO]
Preparing to assign (30/34): Certificates should have the specified lifetime action triggers
[2026-01-22 18:18:13Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:13Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '90' to cleaned params
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:18:14Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 18:18:14Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 18:18:14Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:14Z]
[INFO]
Preparing to assign (31/34): Secrets should not be active for longer than the specified number of days
[2026-01-22 18:18:14Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:14Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 18:18:15Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:15Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:18:15Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:15Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:18:15Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:18:15Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:18:15Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:18:15Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:15Z]
[INFO]
Preparing to assign (32/34): [Preview]: Azure Key Vault Managed HSM keys should have an expiration date
[2026-01-22 18:18:15Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:15Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1d478a74-21ba-4b9f-9d8f-8e6fced0eec5
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:16Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:18:16Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:16Z]
[INFO]
Preparing to assign (33/34): Certificates should use allowed key types
[2026-01-22 18:18:16Z]
[INFO]
Assigning policy 'Certificates should use allowed key types' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:16Z]
[SUCCESS]
Found 'Certificates should use allowed key types' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1151cede-290b-4ba0-8b38-0ad145ac888f
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:18:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:16Z]
[INFO]
Assignment already exists for 'Certificates should use allowed key types'. Updating parameters and enforcement mode...
[2026-01-22 18:18:17Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:18:17Z]
[INFO]
Preparing to assign (34/34): [Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:18:17Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:18:17Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/86810a98-8e91-4a44-8386-ec66d0de5d57
[2026-01-22 18:18:17Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:18:17Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:18:17Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-22 18:18:17Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:18:17Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:18:17Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:18:17Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:18:17Z]
[SUCCESS]
Updated assignment
[2026-01-22 18:18:17Z]
[INFO]
Collected 34 assignment IDs for filtering
[2026-01-22 18:18:17Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/KeysusingRSAcryptographyshouldhaveaspecifiedminimumkey-909744685

Generating compliance report with operational metrics...
[2026-01-22 18:18:21Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-22 18:18:22Z]
[INFO]
Compliance query returned: Raw states=504, Policies reporting=36
[2026-01-22 18:18:22Z]
[INFO]
Filtering compliance data: 34 assignments, 504 total policy states
[2026-01-22 18:18:22Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907
[2026-01-22 18:18:22Z]
[INFO]
Found 248 compliance states for newly deployed policies
[2026-01-22 18:18:22Z]
[INFO]
Total unique assignment IDs in compliance data: 36

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
42.74%
 | Policies Reporting:
34
 | Resources Evaluated:
12

[2026-01-22 18:18:22Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-181822.md, KeyVaultPolicyImplementationReport-20260122-181822.json, KeyVaultPolicyImplementationReport-20260122-181822.csv
[2026-01-22 18:18:22Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-181822.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:18:22Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-181822.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-181822.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-181822.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (42.74%) - Azure is still evaluating resources

ðŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 42.74% to 60-80% range
with all policies reporting complete data.


[2026-01-22 18:18:22Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:18:22Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 18:18:22Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŽ¯ Custom Deployment Complete

âœ… What was deployed:
  â†’ Custom policy configuration from parameter file

ðŸ“‹ Recommended Next Steps:
  1. â³ Wait 30-60 minutes for Azure Policy evaluation cycle
  2. ðŸ“Š Check compliance status:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  3. ðŸ“š Review deployment documentation for custom workflows

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!
True

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Get-ChildItem -Filter "scenario5-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Write-Host "`nâœ“ Validating Scenario 5: $($_.Name)`n" -ForegroundColor Green; .\Validate-Deployment.ps1 -ScenarioNumber 5 -TranscriptFile $_.FullName -ExpectedParameterFile "PolicyParameters-Production-Deny.json" -ExpectedPolicyCount 34 -ExpectedSkippedCount 0 }

âœ“ Validating Scenario 5: scenario5-production-deny-35-policies-20260122-181744.txt

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 5          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-Production-Deny.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 34 policies
  âœ… Correct number of policies skipped: 0 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âœ… Next steps guidance present in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-181822.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:18:22
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 42.74%

[2/8] Policies Reporting...
  âœ… Found: 34 policies

[3/8] Resources Evaluated...
  âœ… Found: 248 total (106 compliant, 142 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 5                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âœ… PASS (13/13 checks)

â•â•â• Transcript Validation: 5/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âœ… PASS
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS

Name                           Value
----                           -----
TranscriptValidation           {[PolicyCountCorrect, True], [HistoryTracked, True], [NextStepsInConsole, True], [ParameterFileCorrect, True]â€¦}
ScenarioNumber                 5
HTMLValidation                 {[HasComplianceOverview, True], [HasDeploymentMetadata, True], [HasNextStepsInHTML, True], [HasScope, True]â€¦}

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nðŸ“‹ Scenario 5: âœ… VALIDATED (13/13 checks - 34 Deny policies)`n" -ForegroundColor Green; Write-Host "ðŸš€ Starting Scenario 6: Production Auto-Remediation (46 Policies)`n" -ForegroundColor Cyan; .\Deploy-PolicyScenarios.ps1

ðŸ“‹ Scenario 5: âœ… VALIDATED (13/13 checks - 34 Deny policies)
ðŸš€ Starting Scenario 6: Production Auto-Remediation (46 Policies)
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                               Deployment History
================================================================================


Scenario 1: DevTest Baseline (30 Policies)
------------------------------------------
  [âœ“]
2026-01-22 17:11:17
[Actual mode]
  [âœ“]
2026-01-22 17:29:56
[Actual mode]


Scenario 2: DevTest Full (46 Policies)
--------------------------------------
  [âœ“]
2026-01-22 17:47:56
[Actual mode]


Scenario 3: DevTest Auto-Remediation (46 Policies)
--------------------------------------------------
  [âœ“]
2026-01-22 18:01:12
[Actual mode]


Scenario 4: Production Audit (46 Policies)
------------------------------------------
  [âœ“]
2026-01-22 18:10:22
[Actual mode]
  [âœ“]
2026-01-22 18:16:24
[Actual mode]


Scenario 5: Production Deny (35 Policies)
-----------------------------------------
  [âœ“]
2026-01-22 18:18:22
[Actual mode]


Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [Not Deployed]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
              Deploying: Production Auto-Remediation (46 Policies)
================================================================================

Description:
Production automated compliance - Audit + DeployIfNotExists
Parameter File:
PolicyParameters-Production-Remediation.json
Effect:
Audit + DINE
Risk Level:
Medium
Duration:
60-90 minutes (Azure evaluation)
âš ï¸  This scenario requires a managed identity for auto-remediation.
  ðŸ” Auto-discovering managed identity...
  âœ… Found: id-policy-remediation
     Resource ID: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
  âœ… Using auto-discovered managed identity


Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED

ðŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -IdentityResourceId /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
  -SkipRBACCheck
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Remediation.json


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 18:21:04Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 18:21:04Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 18:21:04Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 18:21:04Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 18:21:04Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 18:21:04Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 18:21:04Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 18:21:04Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 18:21:04Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 18:21:04Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 18:21:04Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Remediation.json
[2026-01-22 18:21:04Z]
[INFO]
Detected deployment type: ProductionRemediation (from parameter file: PolicyParameters-Production-Remediation.json)
[2026-01-22 18:21:04Z]
[INFO]
DEBUG: PSBoundParameters keys: IdentityResourceId, SkipRBACCheck, CsvPath, ParameterOverridesPath
[2026-01-22 18:21:04Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-22 18:21:04Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-22 18:21:05Z]
[INFO]
Checking current subscription context.
[2026-01-22 18:21:05Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 18:21:06Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 18:21:06Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Remediation.json

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â„¹ï¸  Production Configuration Detected (Audit Mode)            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Using production parameters in Audit mode (recommended first step)
  No resources will be blocked during this deployment

[2026-01-22 18:21:06Z]
[SUCCESS]
Loaded 46 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-Production-Remediation.json

Processing 46 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 18:21:06Z]
[INFO]
Preparing to assign (1/46): Secrets should have the specified maximum validity period
[2026-01-22 18:21:06Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:06Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 18:21:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:07Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:07Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:21:07Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:07Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:21:07Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:21:07Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:07Z]
[INFO]
Preparing to assign (2/46): Resource logs in Key Vault should be enabled
[2026-01-22 18:21:07Z]
[INFO]
Assigning policy 'Resource logs in Key Vault should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:07Z]
[SUCCESS]
Found 'Resource logs in Key Vault should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Checking parameter 'requiredRetentionDays' against policy definition
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Added parameter 'requiredRetentionDays' = '365' to cleaned params
[2026-01-22 18:21:08Z]
[INFO]
Assignment already exists for 'Resource logs in Key Vault should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:21:08Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:08Z]
[INFO]
Preparing to assign (3/46): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 18:21:08Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:08Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:21:08Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'ContosoCA FabrikamCA' to cleaned params
[2026-01-22 18:21:08Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 18:21:09Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:09Z]
[INFO]
Preparing to assign (4/46): [Preview]: Configure Azure Key Vault Managed HSM to disable public network access
[2026-01-22 18:21:09Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:09Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/84d327c3-164a-4685-b453-900478614456
[2026-01-22 18:21:09Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:09Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:09Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:21:09Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:09Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:12Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:12Z]
[INFO]
Assignment already exists for '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:21:13Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:13Z]
[INFO]
Preparing to assign (5/46): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:21:13Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:13Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 18:21:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:14Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:21:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:14Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:21:14Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:21:14Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:21:14Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:21:14Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:14Z]
[INFO]
Preparing to assign (6/46): Azure Key Vault Managed HSM should have purge protection enabled
[2026-01-22 18:21:14Z]
[INFO]
Assigning policy 'Azure Key Vault Managed HSM should have purge protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:14Z]
[SUCCESS]
Found 'Azure Key Vault Managed HSM should have purge protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c39ba22d-4428-4149-b981-70acb31fc383
[2026-01-22 18:21:15Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:15Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:15Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:15Z]
[INFO]
Assignment already exists for 'Azure Key Vault Managed HSM should have purge protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:21:15Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:15Z]
[INFO]
Preparing to assign (7/46): Certificates using elliptic curve cryptography should have allowed curve names
[2026-01-22 18:21:15Z]
[INFO]
Assigning policy 'Certificates using elliptic curve cryptography should have allowed curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:15Z]
[SUCCESS]
Found 'Certificates using elliptic curve cryptography should have allowed curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/bd78111f-4953-4367-9fd5-7e08808b54bf
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:21:16Z]
[INFO]
Assignment already exists for 'Certificates using elliptic curve cryptography should have allowed curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:21:16Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:16Z]
[INFO]
Preparing to assign (8/46): Keys should be the specified cryptographic type RSA or EC
[2026-01-22 18:21:16Z]
[INFO]
Assigning policy 'Keys should be the specified cryptographic type RSA or EC' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:16Z]
[SUCCESS]
Found 'Keys should be the specified cryptographic type RSA or EC' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75c4f823-d65c-4f29-a733-01d0077fdbcb
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Checking parameter 'cryptographicType' against policy definition
[2026-01-22 18:21:16Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:21:16Z]
[WARN]
DEBUG: Parameter 'cryptographicType' NOT FOUND in policy definition - SKIPPED
[2026-01-22 18:21:16Z]
[WARN]
Parameter 'cryptographicType' not defined in policy. Skipping to avoid UndefinedPolicyParameter error.
[2026-01-22 18:21:16Z]
[INFO]
Assignment already exists for 'Keys should be the specified cryptographic type RSA or EC'. Updating parameters and enforcement mode...
[2026-01-22 18:21:17Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:17Z]
[INFO]
Preparing to assign (9/46): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 18:21:17Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:17Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:21:18Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:21:18Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:18Z]
[INFO]
Preparing to assign (10/46): [Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:21:18Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:18Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e58fd0c1-feac-4d12-92db-0a7e9421f53e
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:21:18Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:21:18Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:21:19Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:19Z]
[INFO]
Preparing to assign (11/46): Certificates should not expire within the specified number of days
[2026-01-22 18:21:19Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:19Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 18:21:19Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:19Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:21:19Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:19Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 18:21:19Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:21:19Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '90' to cleaned params
[2026-01-22 18:21:19Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:21:20Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:20Z]
[INFO]
Preparing to assign (12/46): Azure Key Vaults should use private link
[2026-01-22 18:21:20Z]
[INFO]
Assigning policy 'Azure Key Vaults should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:20Z]
[SUCCESS]
Found 'Azure Key Vaults should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9
[2026-01-22 18:21:20Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:20Z]
[INFO]
DEBUG: Defined parameter names: audit_effect, effect
[2026-01-22 18:21:20Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:20Z]
[INFO]
Assignment already exists for 'Azure Key Vaults should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:21:21Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:21Z]
[INFO]
Preparing to assign (13/46): Certificates should be issued by the specified integrated certificate authority
[2026-01-22 18:21:21Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:21Z]
[SUCCESS]
Found 'Certificates should be issued by the specified integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/8e826246-c976-48f6-b03e-619bb92b3d82
[2026-01-22 18:21:21Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:21Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:21:21Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:21Z]
[INFO]
DEBUG: Checking parameter 'allowedCAs' against policy definition
[2026-01-22 18:21:21Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-22 18:21:21Z]
[INFO]
DEBUG: Added parameter 'allowedCAs' = 'DigiCert GlobalSign' to cleaned params
[2026-01-22 18:21:21Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:21:21Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:21Z]
[INFO]
Preparing to assign (14/46): Keys should be backed by a hardware security module (HSM)
[2026-01-22 18:21:21Z]
[INFO]
Assigning policy 'Keys should be backed by a hardware security module (HSM)' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:21Z]
[SUCCESS]
Found 'Keys should be backed by a hardware security module (HSM)' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/587c79fe-dd04-4a5e-9d0b-f89598c7261b
[2026-01-22 18:21:22Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:22Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:22Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:22Z]
[INFO]
Assignment already exists for 'Keys should be backed by a hardware security module (HSM)'. Updating parameters and enforcement mode...
[2026-01-22 18:21:22Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:22Z]
[INFO]
Preparing to assign (15/46): Keys using elliptic curve cryptography should have the specified curve names
[2026-01-22 18:21:22Z]
[INFO]
Assigning policy 'Keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:22Z]
[SUCCESS]
Found 'Keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ff25f3c8-b739-4538-9d07-3d6d25cfb255
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-22 18:21:23Z]
[INFO]
Assignment already exists for 'Keys using elliptic curve cryptography should have the specified curve names'. Updating parameters and enforcement mode...
[2026-01-22 18:21:23Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:23Z]
[INFO]
Preparing to assign (16/46): [Preview]: Configure Azure Key Vault Managed HSM with private endpoints
[2026-01-22 18:21:23Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:23Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d1d6d8bb-cc7c-420f-8c7d-6f6f5279a844
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:21:23Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:23Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:25Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:25Z]
[INFO]
Assignment already exists for '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints'. Updating parameters and enforcement mode...
[2026-01-22 18:21:26Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:26Z]
[INFO]
Preparing to assign (17/46): Keys should have more than the specified number of days before expiration
[2026-01-22 18:21:26Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:26Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 18:21:26Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:26Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:21:26Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:26Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:21:26Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:21:26Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:21:26Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:21:26Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:26Z]
[INFO]
Preparing to assign (18/46): Resource logs in Azure Key Vault Managed HSM should be enabled
[2026-01-22 18:21:26Z]
[INFO]
Assigning policy 'Resource logs in Azure Key Vault Managed HSM should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:26Z]
[SUCCESS]
Found 'Resource logs in Azure Key Vault Managed HSM should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a2a5b911-5617-447e-a49e-59dbe0e0434b
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:21:27Z]
[INFO]
Assignment already exists for 'Resource logs in Azure Key Vault Managed HSM should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:21:27Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:27Z]
[INFO]
Preparing to assign (19/46): Deploy Diagnostic Settings for Key Vault to Event Hub
[2026-01-22 18:21:27Z]
[INFO]
Assigning policy 'Deploy Diagnostic Settings for Key Vault to Event Hub' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:27Z]
[SUCCESS]
Found 'Deploy Diagnostic Settings for Key Vault to Event Hub' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:21:27Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:21:28Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:28Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:28Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:28Z]
[INFO]
Assignment already exists for 'Deploy Diagnostic Settings for Key Vault to Event Hub'. Updating parameters and enforcement mode...
[2026-01-22 18:21:29Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:29Z]
[INFO]
Preparing to assign (20/46): [Preview]: Azure Key Vault Managed HSM should use private link
[2026-01-22 18:21:29Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:29Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/59fee2f4-d439-4f1b-9b9a-982e1474bfd8
[2026-01-22 18:21:29Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:29Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:29Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:29Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should use private link'. Updating parameters and enforcement mode...
[2026-01-22 18:21:30Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:30Z]
[INFO]
Preparing to assign (21/46): [Preview]: Azure Key Vault Managed HSM should disable public network access
[2026-01-22 18:21:30Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:30Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/19ea9d63-adee-4431-a95e-1913c6c1c75f
[2026-01-22 18:21:30Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:30Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:30Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:30Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:21:30Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:30Z]
[INFO]
Preparing to assign (22/46): Key Vault keys should have an expiration date
[2026-01-22 18:21:30Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:30Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 18:21:31Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:31Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:31Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:31Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:21:31Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:31Z]
[INFO]
Preparing to assign (23/46): Keys should have the specified maximum validity period
[2026-01-22 18:21:31Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:31Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:21:32Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:21:32Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:32Z]
[INFO]
Preparing to assign (24/46): Key Vault secrets should have an expiration date
[2026-01-22 18:21:32Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:32Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:32Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:32Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:21:33Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:33Z]
[INFO]
Preparing to assign (25/46): Key vaults should have soft delete enabled
[2026-01-22 18:21:33Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:33Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 18:21:33Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:33Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:33Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:33Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:21:33Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:33Z]
[INFO]
Preparing to assign (26/46): Azure Key Vault should disable public network access
[2026-01-22 18:21:33Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:33Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:34Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:21:34Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:34Z]
[INFO]
Preparing to assign (27/46): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 18:21:34Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:34Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'ContosoCA' to cleaned params
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:21:34Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:34Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:21:35Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:35Z]
[INFO]
Preparing to assign (28/46): Certificates should have the specified maximum validity period
[2026-01-22 18:21:35Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:35Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 18:21:35Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:35Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:21:35Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:35Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 18:21:35Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:21:35Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '12' to cleaned params
[2026-01-22 18:21:35Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:21:36Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:36Z]
[INFO]
Preparing to assign (29/46): Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace
[2026-01-22 18:21:36Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:36Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: Checking parameter 'logAnalytics' against policy definition
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: Added parameter 'logAnalytics' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6874' to cleaned params
[2026-01-22 18:21:36Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:36Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:37Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:37Z]
[INFO]
Assignment already exists for 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace'. Updating parameters and enforcement mode...
[2026-01-22 18:21:38Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:38Z]
[INFO]
Preparing to assign (30/46): Keys should not be active for longer than the specified number of days
[2026-01-22 18:21:38Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:38Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 18:21:38Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:38Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:38Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:38Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:21:38Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:38Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:21:38Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:21:39Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:39Z]
[INFO]
Preparing to assign (31/46): Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.
[2026-01-22 18:21:39Z]
[INFO]
Assigning policy 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:39Z]
[SUCCESS]
Found 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d8cf8476-a2ec-4916-896e-992351803c44
[2026-01-22 18:21:39Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:39Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:21:39Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:39Z]
[INFO]
DEBUG: Checking parameter 'maximumDaysToRotate' against policy definition
[2026-01-22 18:21:39Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:21:39Z]
[INFO]
DEBUG: Added parameter 'maximumDaysToRotate' = '90' to cleaned params
[2026-01-22 18:21:39Z]
[INFO]
Assignment already exists for 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.'. Updating parameters and enforcement mode...
[2026-01-22 18:21:39Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:39Z]
[INFO]
Preparing to assign (32/46): Configure Azure Key Vaults to use private DNS zones
[2026-01-22 18:21:39Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults to use private DNS zones' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:39Z]
[SUCCESS]
Found 'Configure Azure Key Vaults to use private DNS zones' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01d4
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: Checking parameter 'privateDnsZoneId' against policy definition
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: Added parameter 'privateDnsZoneId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net' to cleaned params
[2026-01-22 18:21:40Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:40Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:40Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:40Z]
[INFO]
Assignment already exists for 'Configure Azure Key Vaults to use private DNS zones'. Updating parameters and enforcement mode...
[2026-01-22 18:21:41Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:41Z]
[INFO]
Preparing to assign (33/46): Secrets should have content type set
[2026-01-22 18:21:41Z]
[INFO]
Assigning policy 'Secrets should have content type set' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:41Z]
[SUCCESS]
Found 'Secrets should have content type set' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75262d3e-ba4a-4f43-85f8-9f72c090e5e3
[2026-01-22 18:21:41Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:41Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:41Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:41Z]
[INFO]
Assignment already exists for 'Secrets should have content type set'. Updating parameters and enforcement mode...
[2026-01-22 18:21:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:42Z]
[INFO]
Preparing to assign (34/46): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 18:21:42Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:42Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:21:42Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '0.0.0.0/0' to cleaned params
[2026-01-22 18:21:42Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 18:21:42Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:42Z]
[INFO]
Preparing to assign (35/46): [Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration
[2026-01-22 18:21:42Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:42Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ad27588c-0198-4c84-81ef-08efd0274653
[2026-01-22 18:21:43Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:43Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:21:43Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:43Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:21:43Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-22 18:21:43Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:21:43Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:21:43Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:43Z]
[INFO]
Preparing to assign (36/46): Azure Key Vault should use RBAC permission model
[2026-01-22 18:21:43Z]
[INFO]
Assigning policy 'Azure Key Vault should use RBAC permission model' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:43Z]
[SUCCESS]
Found 'Azure Key Vault should use RBAC permission model' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5
[2026-01-22 18:21:44Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:44Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:44Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:44Z]
[INFO]
Assignment already exists for 'Azure Key Vault should use RBAC permission model'. Updating parameters and enforcement mode...
[2026-01-22 18:21:44Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:44Z]
[INFO]
Preparing to assign (37/46): Secrets should have more than the specified number of days before expiration
[2026-01-22 18:21:44Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:44Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 18:21:45Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:45Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:21:45Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:45Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:21:45Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:21:45Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-22 18:21:45Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:21:45Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:45Z]
[INFO]
Preparing to assign (38/46): Key vaults should have deletion protection enabled
[2026-01-22 18:21:45Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:45Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:46Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:21:46Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:46Z]
[INFO]
Preparing to assign (39/46): Certificates should have the specified lifetime action triggers
[2026-01-22 18:21:46Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:46Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '90' to cleaned params
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:21:46Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 18:21:46Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 18:21:47Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:47Z]
[INFO]
Preparing to assign (40/46): Secrets should not be active for longer than the specified number of days
[2026-01-22 18:21:47Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:47Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-22 18:21:48Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:21:48Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:48Z]
[INFO]
Preparing to assign (41/46): Configure key vaults to enable firewall
[2026-01-22 18:21:48Z]
[INFO]
Assigning policy 'Configure key vaults to enable firewall' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:48Z]
[SUCCESS]
Found 'Configure key vaults to enable firewall' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:21:48Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:48Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:49Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:49Z]
[INFO]
Assignment already exists for 'Configure key vaults to enable firewall'. Updating parameters and enforcement mode...
[2026-01-22 18:21:50Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:50Z]
[INFO]
Preparing to assign (42/46): [Preview]: Azure Key Vault Managed HSM keys should have an expiration date
[2026-01-22 18:21:50Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:50Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1d478a74-21ba-4b9f-9d8f-8e6fced0eec5
[2026-01-22 18:21:50Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:50Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:21:50Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:50Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:21:51Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:51Z]
[INFO]
Preparing to assign (43/46): Certificates should use allowed key types
[2026-01-22 18:21:51Z]
[INFO]
Assigning policy 'Certificates should use allowed key types' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:51Z]
[SUCCESS]
Found 'Certificates should use allowed key types' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1151cede-290b-4ba0-8b38-0ad145ac888f
[2026-01-22 18:21:51Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-22 18:21:51Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:21:51Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-22 18:21:51Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:51Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-22 18:21:51Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:51Z]
[INFO]
Assignment already exists for 'Certificates should use allowed key types'. Updating parameters and enforcement mode...
[2026-01-22 18:21:52Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:52Z]
[INFO]
Preparing to assign (44/46): Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM
[2026-01-22 18:21:52Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:52Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6d2c800-5230-4a40-bff3-8268b4987d42
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:21:52Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:52Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:53Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:53Z]
[INFO]
Assignment already exists for 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM'. Updating parameters and enforcement mode...
[2026-01-22 18:21:54Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:54Z]
[INFO]
Preparing to assign (45/46): Configure Azure Key Vaults with private endpoints
[2026-01-22 18:21:54Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:54Z]
[SUCCESS]
Found 'Configure Azure Key Vaults with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/9d4fad1f-5189-4a42-b29e-cf7929c6b6df
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault' to cleaned params
[2026-01-22 18:21:54Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation' (Length: 169)
[2026-01-22 18:21:54Z]
[INFO]
Policy requires managed identity. Using: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation
PS>TerminatingError(Get-AzUserAssignedIdentity): "A parameter cannot be found that matches parameter name 'ResourceId'."
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 28a0fe2d-1db4-4c3e-9a58-142d0f38e709. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 28a0fe2d-1db4-4c3e-9a58-142d0f38e709'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 93298d06-3fff-4626-8e13-397bf9bd4c30. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 93298d06-3fff-4626-8e13-397bf9bd4c30'.'
WARNING: Unable to acquire token for tenant '' with error 'Authentication failed against tenant 218094f2-2976-4255-a15c-4008e6c8a18b. User interaction is required. This may be due to the conditional access policy settings such as multi-factor authentication (MFA). If you need to access subscriptions in that tenant, please rerun 'Connect-AzAccount' with additional parameter '-TenantId 218094f2-2976-4255-a15c-4008e6c8a18b'.'
[2026-01-22 18:21:55Z]
[INFO]
Added user-assigned identity: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation (using default location: eastus)
[2026-01-22 18:21:55Z]
[INFO]
Assignment already exists for 'Configure Azure Key Vaults with private endpoints'. Updating parameters and enforcement mode...
[2026-01-22 18:21:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:21:56Z]
[INFO]
Preparing to assign (46/46): [Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:21:56Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Audit)
[2026-01-22 18:21:56Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/86810a98-8e91-4a44-8386-ec66d0de5d57
[2026-01-22 18:21:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:21:56Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:21:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:21:56Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:21:56Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-22 18:21:56Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-22 18:21:56Z]
[INFO]
Assignment already exists for '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:21:56Z]
[SUCCESS]
Updated assignment
[2026-01-22 18:21:56Z]
[INFO]
Collected 46 assignment IDs for filtering
[2026-01-22 18:21:56Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907

Generating compliance report with operational metrics...
[2026-01-22 18:22:01Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-22 18:22:02Z]
[INFO]
Compliance query returned: Raw states=504, Policies reporting=36
[2026-01-22 18:22:02Z]
[INFO]
Filtering compliance data: 46 assignments, 504 total policy states
[2026-01-22 18:22:02Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535
[2026-01-22 18:22:02Z]
[INFO]
Found 316 compliance states for newly deployed policies
[2026-01-22 18:22:02Z]
[INFO]
Total unique assignment IDs in compliance data: 36

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
33.54%
 | Policies Reporting:
46
 | Resources Evaluated:
12

[2026-01-22 18:22:02Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-182202.md, KeyVaultPolicyImplementationReport-20260122-182202.json, KeyVaultPolicyImplementationReport-20260122-182202.csv
[2026-01-22 18:22:02Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-182202.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:22:02Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-182202.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-182202.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-182202.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (33.54%) - Azure is still evaluating resources

ðŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 33.54% to 60-80% range
with all policies reporting complete data.


[2026-01-22 18:22:02Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:22:02Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 18:22:02Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŽ¯ Production Auto-Remediation Complete (8 Policies - DeployIfNotExists)

âœ… What was deployed:
  â†’ 8 auto-remediation policies in PRODUCTION environment
  â†’ Managed identity with Contributor role assigned
  â†’ Policies: Diagnostic settings, Private Endpoints, Soft Delete, Purge Protection

âš ï¸  PRODUCTION ENVIRONMENT - HIGH RISK
  â†’ Auto-remediation WILL MODIFY existing Key Vaults
  â†’ Changes apply to all non-compliant vaults in scope
  â†’ Remediation cannot be automatically rolled back

ðŸ“‹ Critical Next Steps:
  1. â³ Wait 15-30 minutes for auto-remediation tasks to complete
  2. ðŸ” Monitor remediation progress in Azure Portal:
     Azure Policy â†’ Compliance â†’ Remediations tab
  3. ðŸ“Š Verify remediation results:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  4. ðŸ“§ Alert stakeholders of automated changes
  5. ðŸ“‹ Review Activity Log for remediation errors:

Get-AzLog -ResourceProvider 'Microsoft.Authorization'

ðŸš¨ Emergency Response (if remediation causes issues):
  1. Stop remediation tasks:

Get-AzPolicyRemediation | Stop-AzPolicyRemediation
  2. Create policy exemptions for affected vaults:

.\\AzPolicyImplScript.ps1 -ExemptionAction Create
  3. Contact Azure Support if data loss occurred

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!
True

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:22:02]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


Exiting...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Get-ChildItem -Filter "scenario6-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Write-Host "`nðŸ“‹ Validating Scenario 6: $($_.Name)`n" -ForegroundColor Cyan; .\Validate-Deployment.ps1 -ScenarioNumber 6 -TranscriptFile $_.FullName -ExpectedParameterFile "PolicyParameters-Production-Remediation.json" -ExpectedPolicyCount 46 -ExpectedSkippedCount 0 | Select-String -Pattern "(Validation Summary|Overall Result|PASS|FAIL)" }

ðŸ“‹ Validating Scenario 6: scenario6-production-auto-remediation-46-policies-20260122-182104.txt

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 6          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-Production-Remediation.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 46 policies
  âœ… Correct number of policies skipped: 0 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âŒ Next steps guidance NOT found in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-182202.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:22:02
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 33.54%

[2/8] Policies Reporting...
  âœ… Found: 46 policies

[3/8] Resources Evaluated...
  âœ… Found: 316 total (106 compliant, 210 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 6                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âš ï¸  PARTIAL (12/13 checks)

â•â•â• Transcript Validation: 4/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âŒ FAIL
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>$file = Get-ChildItem -Filter "scenario6-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1; Get-Content $file.FullName | Select-String -Pattern "NEXT STEPS" -Context 2,2

  [2026-01-22 18:22:02Z]
  [INFO]
>                     ðŸ“‹ NEXT STEPS GUIDANCE
  [2026-01-22 18:22:02Z]
  [INFO]
    â†’ Remediation cannot be automatically rolled back

> ðŸ“‹ Critical Next Steps:
    1. â³ Wait 15-30 minutes for auto-remediation tasks to complete
    2. ðŸ” Monitor remediation progress in Azure Portal:

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>$file = Get-ChildItem -Filter "scenario6-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1; $content = Get-Content $file.FullName -Raw; Write-Host "Has 'NEXT STEPS GUIDANCE': $($content -match 'NEXT STEPS GUIDANCE')"; Write-Host "Has 'Recommended Next Steps': $($content -match 'Recommended Next Steps:')"; Write-Host "Has 'Critical Next Steps': $($content -match 'Critical Next Steps:')"
Has 'NEXT STEPS GUIDANCE': True
Has 'Recommended Next Steps': False
Has 'Critical Next Steps': True
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>$file = Get-ChildItem -Filter "scenario6-*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1; Write-Host "`nâœ“ Re-validating Scenario 6 with fixed validation script...`n" -ForegroundColor Cyan; .\Validate-Deployment.ps1 -ScenarioNumber 6 -TranscriptFile $file.FullName -ExpectedParameterFile "PolicyParameters-Production-Remediation.json" -ExpectedPolicyCount 46 -ExpectedSkippedCount 0 | Select-String -Pattern "(Checking Next Steps|Next steps guidance|Validation Summary|Overall Result|\/5 ===|\/8 ===)"

âœ“ Re-validating Scenario 6 with fixed validation script...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 6          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-Production-Remediation.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 46 policies
  âœ… Correct number of policies skipped: 0 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âœ… Next steps guidance present in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-182202.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:22:02
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 33.54%

[2/8] Policies Reporting...
  âœ… Found: 46 policies

[3/8] Resources Evaluated...
  âœ… Found: 316 total (106 compliant, 210 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 6                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âœ… PASS (13/13 checks)

â•â•â• Transcript Validation: 5/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âœ… PASS
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nðŸš€ Starting Scenario 7 Deployment (Resource Group Scope - 30 Policies)...`n" -ForegroundColor Cyan; .\Deploy-PolicyScenarios.ps1

ðŸš€ Starting Scenario 7 Deployment (Resource Group Scope - 30 Policies)...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:22:02]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                 Deploying: Resource Group Scope (30 Policies)
================================================================================

Description:
Limited scope testing - Single resource group
Parameter File:
PolicyParameters-DevTest.json
Effect:
Audit
Risk Level:
Low
Duration:
5 minutes
PS>TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
]633;D;1]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nðŸš€ Testing Scenario 7 with auto-discovery...`n" -ForegroundColor Cyan; $input = "7`ny"; $input | .\Deploy-PolicyScenarios.ps1 2>&1 | Select-String -Pattern "(Auto-discovering|Found:|Resource Group|Deployment Mode|Select mode)" -Context 0,1

ðŸš€ Testing Scenario 7 with auto-discovery...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:22:02]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [Not Deployed]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                 Deploying: Resource Group Scope (30 Policies)
================================================================================

Description:
Limited scope testing - Single resource group
Parameter File:
PolicyParameters-DevTest.json
Effect:
Audit
Risk Level:
Low
Duration:
5 minutes
  ðŸ” Auto-discovering test resource group...
  âœ… Found: rg-policy-keyvault-test
     Location: eastus
     Key Vaults: 3

Deployment Mode:
  [P] Preview (safe validation - no changes)
  [A] Actual (deploy policies to Azure)

âš ï¸  ACTUAL DEPLOYMENT MODE SELECTED

ðŸš€ Starting deployment...
Command: .\AzPolicyImplScript.ps1
  -ParameterFile C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json
  -ResourceGroupName rg-policy-keyvault-test
  -ScopeType ResourceGroup
  -SkipRBACCheck


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-22 18:27:53Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-22 18:27:53Z]
[INFO]
Checking required PowerShell modules...
[2026-01-22 18:27:53Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-22 18:27:53Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-22 18:27:53Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-22 18:27:53Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-22 18:27:53Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-22 18:27:53Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-22 18:27:53Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-22 18:27:53Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-22 18:27:53Z]
[INFO]
Loading policy parameter overrides from C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json
[2026-01-22 18:27:53Z]
[INFO]
Detected deployment type: DevTest30 (from parameter file: PolicyParameters-DevTest.json)
[2026-01-22 18:27:53Z]
[INFO]
DEBUG: PSBoundParameters keys: SkipRBACCheck, CsvPath, ParameterOverridesPath, ScopeType
[2026-01-22 18:27:53Z]
[INFO]
DEBUG: ScopeType value: 'ResourceGroup'
[2026-01-22 18:27:53Z]
[INFO]
Using scope type from parameter: ResourceGroup
[2026-01-22 18:27:53Z]
[INFO]
DevTest environment detected - automatically using resource group: rg-policy-keyvault-test
[2026-01-22 18:27:53Z]
[INFO]
Checking current subscription context.
[2026-01-22 18:27:53Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-22 18:27:55Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-22 18:27:55Z]
[INFO]
Using policy effects from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json
[2026-01-22 18:27:55Z]
[SUCCESS]
Loaded 30 policies from parameter file: C:\Source\powershell-akv-policyhardening\PolicyParameters-DevTest.json

Processing 30 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-22 18:27:55Z]
[INFO]
Preparing to assign (1/30): Certificates should have the specified maximum validity period
[2026-01-22 18:27:55Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:55Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '36' to cleaned params
[2026-01-22 18:27:56Z]
[INFO]
Assignment already exists for 'Certificates should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:27:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:27:56Z]
[INFO]
Preparing to assign (2/30): Resource logs in Key Vault should be enabled
[2026-01-22 18:27:56Z]
[INFO]
Assigning policy 'Resource logs in Key Vault should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:56Z]
[SUCCESS]
Found 'Resource logs in Key Vault should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Checking parameter 'requiredRetentionDays' against policy definition
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:27:56Z]
[INFO]
DEBUG: Added parameter 'requiredRetentionDays' = '30' to cleaned params
[2026-01-22 18:27:56Z]
[INFO]
Assignment already exists for 'Resource logs in Key Vault should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:27:56Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:27:56Z]
[INFO]
Preparing to assign (3/30): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-22 18:27:56Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:56Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'CN=ContosoCA CN=InternalCA' to cleaned params
[2026-01-22 18:27:57Z]
[INFO]
Assignment already exists for 'Certificates should be issued by one of the specified non-integrated certificate authorities'. Updating parameters and enforcement mode...
[2026-01-22 18:27:57Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:27:57Z]
[INFO]
Preparing to assign (4/30): [Preview]: Configure Azure Key Vault Managed HSM to disable public network access
[2026-01-22 18:27:57Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:57Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM to disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/84d327c3-164a-4685-b453-900478614456
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:27:57Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:27:57Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:27:57Z]
[INFO]
Preparing to assign (5/30): Keys using RSA cryptography should have a specified minimum key size
[2026-01-22 18:27:57Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:58Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-22 18:27:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:58Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:27:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:27:58Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:27:58Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:27:58Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:27:58Z]
[INFO]
Assignment already exists for 'Keys using RSA cryptography should have a specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:27:58Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:27:58Z]
[INFO]
Preparing to assign (6/30): Configure Azure Key Vaults to use private DNS zones
[2026-01-22 18:27:58Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults to use private DNS zones' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:58Z]
[SUCCESS]
Found 'Configure Azure Key Vaults to use private DNS zones' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01d4
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Checking parameter 'privateDnsZoneId' against policy definition
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Defined parameter names: privateDnsZoneId, effect
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Added parameter 'privateDnsZoneId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net' to cleaned params
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:27:59Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:27:59Z]
[INFO]
Preparing to assign (7/30): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-22 18:27:59Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:59Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '2048' to cleaned params
[2026-01-22 18:27:59Z]
[INFO]
Assignment already exists for 'Certificates using RSA cryptography should have the specified minimum key size'. Updating parameters and enforcement mode...
[2026-01-22 18:27:59Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:27:59Z]
[INFO]
Preparing to assign (8/30): Certificates should not expire within the specified number of days
[2026-01-22 18:27:59Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:27:59Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:27:59Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '30' to cleaned params
[2026-01-22 18:28:00Z]
[INFO]
Assignment already exists for 'Certificates should not expire within the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:28:00Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:00Z]
[INFO]
Preparing to assign (9/30): Deploy Diagnostic Settings for Key Vault to Event Hub
[2026-01-22 18:28:00Z]
[INFO]
Assigning policy 'Deploy Diagnostic Settings for Key Vault to Event Hub' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:00Z]
[SUCCESS]
Found 'Deploy Diagnostic Settings for Key Vault to Event Hub' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-6513/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:28:00Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:28:00Z]
[INFO]
Preparing to assign (10/30): Configure key vaults to enable firewall
[2026-01-22 18:28:00Z]
[INFO]
Assigning policy 'Configure key vaults to enable firewall' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:00Z]
[SUCCESS]
Found 'Configure key vaults to enable firewall' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ac673a9a-f77d-4846-b2d8-a57f8e1c01dc
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Modify' to cleaned params
[2026-01-22 18:28:00Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:28:00Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:28:00Z]
[INFO]
Preparing to assign (11/30): [Preview]: Configure Azure Key Vault Managed HSM with private endpoints
[2026-01-22 18:28:00Z]
[INFO]
Assigning policy '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:00Z]
[SUCCESS]
Found '[Preview]: Configure Azure Key Vault Managed HSM with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d1d6d8bb-cc7c-420f-8c7d-6f6f5279a844
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/snet-privateendpoints' to cleaned params
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:28:01Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:28:01Z]
[INFO]
Preparing to assign (12/30): Keys should have more than the specified number of days before expiration
[2026-01-22 18:28:01Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:01Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:28:01Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:28:01Z]
[INFO]
Assignment already exists for 'Keys should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:28:01Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:01Z]
[INFO]
Preparing to assign (13/30): Resource logs in Azure Key Vault Managed HSM should be enabled
[2026-01-22 18:28:01Z]
[INFO]
Assigning policy 'Resource logs in Azure Key Vault Managed HSM should be enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:01Z]
[SUCCESS]
Found 'Resource logs in Azure Key Vault Managed HSM should be enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a2a5b911-5617-447e-a49e-59dbe0e0434b
[2026-01-22 18:28:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:02Z]
[INFO]
DEBUG: Defined parameter names: effect, requiredRetentionDays
[2026-01-22 18:28:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'AuditIfNotExists' to cleaned params
[2026-01-22 18:28:02Z]
[INFO]
Assignment already exists for 'Resource logs in Azure Key Vault Managed HSM should be enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:28:02Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:02Z]
[INFO]
Preparing to assign (14/30): Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace
[2026-01-22 18:28:02Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:02Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Checking parameter 'logAnalytics' against policy definition
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Defined parameter names: effect, diagnosticsSettingNameToUse, logAnalytics, AuditEventEnabled, AllMetricsEnabled
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Added parameter 'logAnalytics' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6827' to cleaned params
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:28:03Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:28:03Z]
[INFO]
Preparing to assign (15/30): Key Vault keys should have an expiration date
[2026-01-22 18:28:03Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:03Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:28:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:03Z]
[INFO]
Assignment already exists for 'Key Vault keys should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:28:03Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:03Z]
[INFO]
Preparing to assign (16/30): Keys should have the specified maximum validity period
[2026-01-22 18:28:03Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:03Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-22 18:28:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:04Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:04Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:28:04Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:04Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 18:28:04Z]
[INFO]
Assignment already exists for 'Keys should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:28:04Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:04Z]
[INFO]
Preparing to assign (17/30): Key Vault secrets should have an expiration date
[2026-01-22 18:28:04Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:04Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-22 18:28:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:05Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:28:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:05Z]
[INFO]
Assignment already exists for 'Key Vault secrets should have an expiration date'. Updating parameters and enforcement mode...
[2026-01-22 18:28:05Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:05Z]
[INFO]
Preparing to assign (18/30): Key vaults should have soft delete enabled
[2026-01-22 18:28:05Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:05Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-22 18:28:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:05Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:28:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:05Z]
[INFO]
Assignment already exists for 'Key vaults should have soft delete enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:28:06Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:06Z]
[INFO]
Preparing to assign (19/30): Azure Key Vault should disable public network access
[2026-01-22 18:28:06Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:06Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-22 18:28:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:06Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:28:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:06Z]
[INFO]
Assignment already exists for 'Azure Key Vault should disable public network access'. Updating parameters and enforcement mode...
[2026-01-22 18:28:07Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:07Z]
[INFO]
Preparing to assign (20/30): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-22 18:28:07Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:07Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-22 18:28:07Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-22 18:28:07Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:28:07Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'CN=ContosoCA' to cleaned params
[2026-01-22 18:28:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:07Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-22 18:28:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:07Z]
[INFO]
Assignment already exists for 'Certificates should be issued by the specified non-integrated certificate authority'. Updating parameters and enforcement mode...
[2026-01-22 18:28:07Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:07Z]
[INFO]
Preparing to assign (21/30): Keys should not be active for longer than the specified number of days
[2026-01-22 18:28:07Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:07Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-22 18:28:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:08Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:08Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:28:08Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:08Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '730' to cleaned params
[2026-01-22 18:28:08Z]
[INFO]
Assignment already exists for 'Keys should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:28:08Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:08Z]
[INFO]
Preparing to assign (22/30): Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.
[2026-01-22 18:28:08Z]
[INFO]
Assigning policy 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:08Z]
[SUCCESS]
Found 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d8cf8476-a2ec-4916-896e-992351803c44
[2026-01-22 18:28:09Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:09Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:28:09Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:09Z]
[INFO]
DEBUG: Checking parameter 'maximumDaysToRotate' against policy definition
[2026-01-22 18:28:09Z]
[INFO]
DEBUG: Defined parameter names: maximumDaysToRotate, effect
[2026-01-22 18:28:09Z]
[INFO]
DEBUG: Added parameter 'maximumDaysToRotate' = '180' to cleaned params
[2026-01-22 18:28:09Z]
[INFO]
Assignment already exists for 'Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.'. Updating parameters and enforcement mode...
[2026-01-22 18:28:09Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:09Z]
[INFO]
Preparing to assign (23/30): Configure Azure Key Vaults with private endpoints
[2026-01-22 18:28:09Z]
[INFO]
Assigning policy 'Configure Azure Key Vaults with private endpoints' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:09Z]
[SUCCESS]
Found 'Configure Azure Key Vaults with private endpoints' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/9d4fad1f-5189-4a42-b29e-cf7929c6b6df
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Checking parameter 'privateEndpointSubnetId' against policy definition
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Defined parameter names: privateEndpointSubnetId, effect
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Added parameter 'privateEndpointSubnetId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/snet-privateendpoints' to cleaned params
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:28:10Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:28:10Z]
[INFO]
Preparing to assign (24/30): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-22 18:28:10Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:10Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-22 18:28:10Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '' to cleaned params
[2026-01-22 18:28:10Z]
[INFO]
Assignment already exists for 'Azure Key Vault should have firewall enabled or public network access disabled'. Updating parameters and enforcement mode...
[2026-01-22 18:28:11Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:11Z]
[INFO]
Preparing to assign (25/30): Key vaults should have deletion protection enabled
[2026-01-22 18:28:11Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:11Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-22 18:28:11Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:11Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-22 18:28:11Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:11Z]
[INFO]
Assignment already exists for 'Key vaults should have deletion protection enabled'. Updating parameters and enforcement mode...
[2026-01-22 18:28:11Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:11Z]
[INFO]
Preparing to assign (26/30): Certificates should have the specified lifetime action triggers
[2026-01-22 18:28:11Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:11Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '30' to cleaned params
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-22 18:28:12Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-22 18:28:12Z]
[INFO]
Assignment already exists for 'Certificates should have the specified lifetime action triggers'. Updating parameters and enforcement mode...
[2026-01-22 18:28:12Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:12Z]
[INFO]
Preparing to assign (27/30): Secrets should not be active for longer than the specified number of days
[2026-01-22 18:28:12Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:12Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-22 18:28:13Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:13Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:13Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:13Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:28:13Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:13Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '730' to cleaned params
[2026-01-22 18:28:13Z]
[INFO]
Assignment already exists for 'Secrets should not be active for longer than the specified number of days'. Updating parameters and enforcement mode...
[2026-01-22 18:28:13Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:13Z]
[INFO]
Preparing to assign (28/30): Secrets should have the specified maximum validity period
[2026-01-22 18:28:13Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:13Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '1095' to cleaned params
[2026-01-22 18:28:14Z]
[INFO]
Assignment already exists for 'Secrets should have the specified maximum validity period'. Updating parameters and enforcement mode...
[2026-01-22 18:28:14Z]
[SUCCESS]
Updated assignment

[2026-01-22 18:28:14Z]
[INFO]
Preparing to assign (29/30): Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM
[2026-01-22 18:28:14Z]
[INFO]
Assigning policy 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:14Z]
[SUCCESS]
Found 'Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6d2c800-5230-4a40-bff3-8268b4987d42
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Checking parameter 'eventHubRuleId' against policy definition
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Added parameter 'eventHubRuleId' = '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-6513/authorizationrules/RootManageSharedAccessKey' to cleaned params
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:14Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Added parameter 'effect' = 'DeployIfNotExists' to cleaned params
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Checking parameter 'eventHubLocation' against policy definition
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Defined parameter names: effect, profileName, eventHubRuleId, eventHubLocation, metricsEnabled, logsEnabled
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Added parameter 'eventHubLocation' = 'eastus' to cleaned params
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: IdentityResourceId parameter value: '' (Length: 0)
[2026-01-22 18:28:15Z]
[WARN]
Effect '' requires managed identity. Skipping assignment - provide -IdentityResourceId to enable.

[2026-01-22 18:28:15Z]
[INFO]
Preparing to assign (30/30): Secrets should have more than the specified number of days before expiration
[2026-01-22 18:28:15Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test (Mode=Audit)
[2026-01-22 18:28:15Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Audit' to cleaned params
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-22 18:28:15Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-22 18:28:15Z]
[INFO]
Assignment already exists for 'Secrets should have more than the specified number of days before expiration'. Updating parameters and enforcement mode...
[2026-01-22 18:28:15Z]
[SUCCESS]
Updated assignment
[2026-01-22 18:28:15Z]
[INFO]
Collected 22 assignment IDs for filtering
[2026-01-22 18:28:15Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldhavethespecifiedmaximumvalidityperio-407807336, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907

Generating compliance report with operational metrics...
[2026-01-22 18:28:18Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test
[2026-01-22 18:28:19Z]
[INFO]
Compliance query returned: Raw states=120, Policies reporting=35
[2026-01-22 18:28:19Z]
[INFO]
Filtering compliance data: 22 assignments, 120 total policy states
[2026-01-22 18:28:19Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldhavethespecifiedmaximumvalidityperio-407807336 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/ResourcelogsinKeyVaultshouldbeenabled-1683835535
[2026-01-22 18:28:19Z]
[INFO]
Found 63 compliance states for newly deployed policies
[2026-01-22 18:28:19Z]
[INFO]
Total unique assignment IDs in compliance data: 35

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
52.38%
 | Policies Reporting:
22
 | Resources Evaluated:
3

[2026-01-22 18:28:19Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260122-182819.md, KeyVaultPolicyImplementationReport-20260122-182819.json, KeyVaultPolicyImplementationReport-20260122-182819.csv
[2026-01-22 18:28:19Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260122-182819.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:28:19Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260122-182819.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260122-182819.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260122-182819.json

âš ï¸  IMPORTANT: Azure Policy Evaluation in Progress

Deployment Status:
âœ… All policies successfully assigned
Compliance Status:
â³ Partial data (52.38%) - Azure is still evaluating resources

ðŸ“Š Why Compliance is Low Right Now:
  â€¢ Policy Assignment Propagation: 30-90 minutes for Azure to distribute assignments
  â€¢ Resource Scanning: 15-30 minutes for Azure Policy engine to scan existing Key Vaults
  â€¢ Compliance State Calculation: 10-15 minutes to evaluate resources against policy rules

â±ï¸  WAIT 60 MINUTES from now, then regenerate this report to see accurate compliance.

How to Regenerate Report:
  .\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan

Expected improvement: Compliance should increase from 52.38% to 60-80% range
with all policies reporting complete data.


[2026-01-22 18:28:19Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-22 18:28:19Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-22 18:28:19Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸŽ¯ DevTest Deployment Complete (30 Policies - Audit Mode)

âœ… What was deployed:
  â†’ 30 Azure Key Vault governance policies in Audit mode
  â†’ Monitoring compliance without blocking operations
  â†’ Test environment: rg-policy-keyvault-test resource group

ðŸ“‹ Recommended Next Steps:
  1. â³ Wait 30-60 minutes for Azure Policy evaluation cycle
  2. ðŸ“Š Check compliance status:

.\\AzPolicyImplScript.ps1 -CheckCompliance -TriggerScan
  3. ðŸ§ª Test infrastructure validation:

.\\AzPolicyImplScript.ps1 -TestInfrastructure -Detailed
  4. ðŸ“ˆ Deploy full 46-policy suite when ready:

.\\AzPolicyImplScript.ps1 -ParameterFile .\\PolicyParameters-DevTest-Full.json

ðŸ“š Documentation:
  â†’ Testing Guide: QUICKSTART.md (lines 1-150)
  â†’ Policy List: DefinitionListExport.csv (first 30 policies)

WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

âœ… Deployment completed successfully!

Press any key to continue...
WARNING: Resulting JSON is truncated as serialization has exceeded the set depth of 2.

================================================================================
                   Azure Key Vault Policy Deployment Scenarios
================================================================================

Select a deployment scenario:
  [1]
DevTest Baseline (30 Policies)
 [\u2713 Deployed: 2026-01-22 17:29:56]
      Safe initial deployment with core policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [2]
DevTest Full (46 Policies)
 [\u2713 Deployed: 2026-01-22 17:47:56]
      Comprehensive testing of all policies - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [3]
DevTest Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:01:12]
      Test automated compliance fixes - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [4]
Production Audit (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:16:24]
      Production monitoring without blocking - Audit mode
      Risk:
Low
 | Duration:
5 minutes

  [5]
Production Deny (35 Policies)
 [\u2713 Deployed: 2026-01-22 18:18:22]
      Maximum enforcement - BLOCKS non-compliant resources
      Risk:
HIGH
 | Duration:
5 minutes

  [6]
Production Auto-Remediation (46 Policies)
 [\u2713 Deployed: 2026-01-22 18:22:02]
      Production automated compliance - Audit + DeployIfNotExists
      Risk:
Medium
 | Duration:
60-90 minutes (Azure evaluation)

  [7]
Resource Group Scope (30 Policies)
 [\u2713 Deployed: 2026-01-22 18:28:19]
      Limited scope testing - Single resource group
      Risk:
Low
 | Duration:
5 minutes

  [8]
Management Group Scope (46 Policies)
 [Not Deployed]
      Organization-wide governance - Multiple subscriptions
      Risk:
Medium
 | Duration:
5 minutes

  [9]
Rollback (Remove All Policies)
 [Not Deployed]
      Remove all KV-* policy assignments
      Risk:
Low
 | Duration:
3 minutes

  [V]
Validate Last Deployment
  [H]
View Deployment History
  [C]
Clear Deployment History
  [Q]
Quit


================================================================================
                            Validate Last Deployment
================================================================================

Last deployment:
Scenario 7 - Resource Group Scope (30 Policies)
Timestamp: 01/22/2026 18:28:19
ðŸ“ Transcript: scenario7-resource-group-scope-30-policies-20260122-182753.txt

ðŸ” Running validation...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Comprehensive Deployment Validation - Scenario 7          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â• Part 1: Transcript Validation (Console Output) â•â•â•
[1/5] Checking Parameter File Usage...
  âœ… Correct parameter file: PolicyParameters-DevTest.json

[2/5] Checking Policy Count...
  âœ… Correct policy count: 30 policies
  âœ… Correct number of policies skipped: 8 (expected without identity)

[3/5] Checking Next Steps in Console Output...
  âœ… Next steps guidance present in console

[4/5] Checking HTML Report Generation...
  âœ… HTML report generated: PolicyImplementationReport-20260122-182819.html

[5/5] Checking Deployment History...
  âœ… Deployment history tracked
     â€¢ Timestamp: 2026-01-22 18:28:19
     â€¢ Mode: Actual

â•â•â• Part 2: HTML Report Validation (Report Content) â•â•â•
[1/8] Overall Compliance...
  âœ… Found: 52.38%

[2/8] Policies Reporting...
  âœ… Found: 22 policies

[3/8] Resources Evaluated...
  âœ… Found: 63 total (33 compliant, 30 non-compliant)

[4/8] Scope...
  âœ… Found: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test

[5/8] Deployment Metadata...
  âœ… Found

[6/8] Compliance Overview...
  âœ… Found

[7/8] Policy Assignments...
  âœ… Found

[8/8] Next Steps in HTML...
  âœ… Found

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Validation Summary - Scenario 7                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š Overall Result:
âœ… PASS (13/13 checks)

â•â•â• Transcript Validation: 5/5 â•â•â•
  [1] Parameter File:       âœ… PASS
  [2] Policy Count:         âœ… PASS
  [3] Next Steps (Console): âœ… PASS
  [4] HTML Report:          âœ… PASS
  [5] History Tracking:     âœ… PASS

â•â•â• HTML Report Validation: 8/8 â•â•â•
  [1] Overall Compliance:   âœ… PASS
  [2] Policies Reporting:   âœ… PASS
  [3] Resources Evaluated:  âœ… PASS
  [4] Scope:                âœ… PASS
  [5] Deployment Metadata:  âœ… PASS
  [6] Compliance Overview:  âœ… PASS
  [7] Policy Assignments:   âœ… PASS
  [8] Next Steps (HTML):    âœ… PASS

