{
  "_comment": "Production environment - 46 policies with REMEDIATION mode (8 policies with DeployIfNotExists/Modify effects)",
  
  "Key vaults should have soft delete enabled": {
    "effect": "Audit"
  },
  "Key vaults should have deletion protection enabled": {
    "effect": "Audit"
  },
  "Azure Key Vault should disable public network access": {
    "effect": "Audit"
  },
  "Azure Key Vault should have firewall enabled or public network access disabled": {
    "allowedIPAddresses": ["0.0.0.0/0"],
    "forbiddenIPAddresses": [],
    "effect": "Audit"
  },
  "Azure Key Vault Managed HSM should have purge protection enabled": {
    "effect": "Audit"
  },
  "Azure Key Vault should use RBAC permission model": {
    "effect": "Audit"
  },
  
  "Certificates should use allowed key types": {
    "allowedKeyTypes": ["RSA", "EC"],
    "effect": "Audit"
  },
  "Certificates using elliptic curve cryptography should have allowed curve names": {
    "allowedECNames": ["P-256", "P-256K", "P-384", "P-521"],
    "effect": "Audit"
  },
  "Certificates should have the specified maximum validity period": {
    "maximumValidityInMonths": 12,
    "effect": "Audit"
  },
  "Certificates should have the specified lifetime action triggers": {
    "maximumPercentageLife": 80,
    "minimumDaysBeforeExpiry": 90,
    "effect": "Audit"
  },
  "Certificates should be issued by the specified integrated certificate authority": {
    "allowedCAs": ["DigiCert", "GlobalSign"],
    "effect": "Audit"
  },
  "Certificates should be issued by the specified non-integrated certificate authority": {
    "caCommonName": "ContosoCA",
    "effect": "Audit"
  },
  "Certificates should be issued by one of the specified non-integrated certificate authorities": {
    "caCommonNames": ["ContosoCA", "FabrikamCA"],
    "effect": "Audit"
  },
  "Certificates should not expire within the specified number of days": {
    "daysToExpire": 90,
    "effect": "Audit"
  },
  "Keys should have the specified maximum validity period": {
    "maximumValidityInDays": 365,
    "effect": "Audit"
  },
  "Secrets should have the specified maximum validity period": {
    "maximumValidityInDays": 365,
    "effect": "Audit"
  },
  
  "Key Vault secrets should have an expiration date": {
    "effect": "Audit"
  },
  "Key Vault keys should have an expiration date": {
    "effect": "Audit"
  },
  
  "Keys should have more than the specified number of days before expiration": {
    "minimumDaysBeforeExpiration": 90,
    "effect": "Audit"
  },
  "Secrets should have more than the specified number of days before expiration": {
    "minimumDaysBeforeExpiration": 90,
    "effect": "Audit"
  },
  
  "Keys should not be active for longer than the specified number of days": {
    "maximumValidityInDays": 365,
    "effect": "Audit"
  },
  "Secrets should not be active for longer than the specified number of days": {
    "maximumValidityInDays": 365,
    "effect": "Audit"
  },
  
  "Keys should have a rotation policy ensuring that their rotation is scheduled within the specified number of days after creation.": {
    "maximumDaysToRotate": 90,
    "effect": "Audit"
  },
  
  "Keys should be the specified cryptographic type RSA or EC": {
    "cryptographicType": ["RSA", "EC"],
    "effect": "Audit"
  },
  "Keys using RSA cryptography should have a specified minimum key size": {
    "minimumRSAKeySize": 4096,
    "effect": "Audit"
  },
  "Keys using elliptic curve cryptography should have the specified curve names": {
    "allowedECNames": ["P-256", "P-256K", "P-384", "P-521"],
    "effect": "Audit"
  },
  "Certificates using RSA cryptography should have the specified minimum key size": {
    "minimumRSAKeySize": 4096,
    "effect": "Audit"
  },  "[Preview]: Azure Key Vault Managed HSM should disable public network access": {
    "effect": "Audit"
  },
  "[Preview]: Azure Key Vault Managed HSM keys should have an expiration date": {
    "effect": "Audit"
  },
  "[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration": {
    "minimumDaysBeforeExpiration": 30,
    "effect": "Audit"
  },
  "[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names": {
    "allowedECNames": ["P-256", "P-256K", "P-384", "P-521"],
    "effect": "Audit"
  },  "[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size": {
    "minimumRSAKeySize": 4096,
    "effect": "Audit"
  },
  
  "Keys should be backed by a hardware security module (HSM)": {
    "effect": "Audit"
  },
  
  "Secrets should have content type set": {
    "effect": "Audit"
  },
  
  "Resource logs in Key Vault should be enabled": {
    "effect": "AuditIfNotExists",
    "requiredRetentionDays": "365"
  },
  "Resource logs in Azure Key Vault Managed HSM should be enabled": {
    "effect": "AuditIfNotExists"
  },
  
  "Azure Key Vaults should use private link": {
    "effect": "Audit"
  },
  "[Preview]: Azure Key Vault Managed HSM should use private link": {
    "effect": "Audit"
  },
  
  "[Preview]: Configure Azure Key Vault Managed HSM to disable public network access": {
    "effect": "Modify"
  },
  "Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace": {
    "effect": "DeployIfNotExists",
    "logAnalytics": "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.OperationalInsights/workspaces/law-policy-test-6874"
  },
  "Configure Azure Key Vaults with private endpoints": {
    "effect": "DeployIfNotExists",
    "privateEndpointSubnetId": "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault"
  },
  "Deploy - Configure diagnostic settings to an Event Hub to be enabled on Azure Key Vault Managed HSM": {
    "effect": "DeployIfNotExists",
    "eventHubRuleId": "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey",
    "eventHubLocation": "eastus"
  },
  "Configure Azure Key Vaults to use private DNS zones": {
    "effect": "DeployIfNotExists",
    "privateDnsZoneId": "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net"
  },
  "Configure key vaults to enable firewall": {
    "effect": "Modify"
  },
  "[Preview]: Configure Azure Key Vault Managed HSM with private endpoints": {
    "effect": "DeployIfNotExists",
    "privateEndpointSubnetId": "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-keyvault-test/providers/Microsoft.Network/virtualNetworks/vnet-policy-test/subnets/subnet-keyvault"
  },
  "Deploy Diagnostic Settings for Key Vault to Event Hub": {
    "effect": "DeployIfNotExists",
    "eventHubRuleId": "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourceGroups/rg-policy-remediation/providers/Microsoft.EventHub/namespaces/eh-policy-test-3464/authorizationrules/RootManageSharedAccessKey",
    "eventHubLocation": "eastus"
  }
}
