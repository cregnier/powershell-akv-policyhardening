**********************
PowerShell transcript start
Start time: 20260126111409
Username: DTL01\lcladmin
RunAs User: DTL01\lcladmin
Configuration Name: 
Machine: DTL01 (Microsoft Windows NT 10.0.20348.0)
Host Application: C:\Program Files\PowerShell\7\pwsh.dll -noexit -command try { . "c:\Program Files\Microsoft VS Code\resources\app\out\vs\workbench\contrib\terminal\common\scripts\shellIntegration.ps1" } catch {}
Process ID: 10360
PSVersion: 7.5.3
PSEdition: Core
GitCommitId: 7.5.3
OS: Microsoft Windows 10.0.20348
Platform: Win32NT
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1, 6.0, 7.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
WSManStackVersion: 3.0
**********************
Transcript started, output file is .\logs\Scenario2-Cleanup-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Yellow; Write-Host "â•‘       CLEANUP: Removing Scenario 2 Policies (22 assignments) â•‘" -ForegroundColor Yellow; Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`n" -ForegroundColor Yellow

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       CLEANUP: Removing Scenario 2 Policies (22 assignments) â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>$assignments = Get-AzPolicyAssignment -Scope "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb" | Where-Object { $_.Properties.DisplayName -like "*Key*Vault*" -or $_.Properties.DisplayName -like "*Certificate*" -or $_.Properties.DisplayName -like "*Secret*" }; Write-Host "Found $($assignments.Count) Key Vault policy assignments to remove" -ForegroundColor Cyan; $assignments | ForEach-Object { Write-Host "  - Removing: $($_.Properties.DisplayName)" -ForegroundColor Gray; Remove-AzPolicyAssignment -Id $_.Id -ErrorAction SilentlyContinue }; Write-Host "`nCleanup complete!" -ForegroundColor Green
Found 0 Key Vault policy assignments to remove
PS>CommandInvocation(Out-Null): "Out-Null"

Cleanup complete!
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript
**********************
PowerShell transcript end
End time: 20260126111419
**********************
**********************
PowerShell transcript start
Start time: 20260126111453
Username: DTL01\lcladmin
RunAs User: DTL01\lcladmin
Configuration Name: 
Machine: DTL01 (Microsoft Windows NT 10.0.20348.0)
Host Application: C:\Program Files\PowerShell\7\pwsh.dll -noexit -command try { . "c:\Program Files\Microsoft VS Code\resources\app\out\vs\workbench\contrib\terminal\common\scripts\shellIntegration.ps1" } catch {}
Process ID: 10360
PSVersion: 7.5.3
PSEdition: Core
GitCommitId: 7.5.3
OS: Microsoft Windows 10.0.20348
Platform: Win32NT
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1, 6.0, 7.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
WSManStackVersion: 3.0
**********************
Transcript started, output file is .\logs\Scenario2-Cleanup-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>$scope = "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb"; $assignments = Get-AzPolicyAssignment -Scope $scope | Where-Object { $_.Name -notlike "sys.*" }; Write-Host "Found $($assignments.Count) policy assignments to remove (excluding system policies)" -ForegroundColor Cyan; $removed = 0; $assignments | ForEach-Object { try { Write-Host "  Removing: $($_.Name)" -ForegroundColor Gray; Remove-AzPolicyAssignment -Id $_.Id -ErrorAction Stop; $removed++ } catch { Write-Host "    Error: $($_.Exception.Message)" -ForegroundColor Red } }; Write-Host "`nRemoved $removed policy assignments" -ForegroundColor Green
Found 31 policy assignments to remove (excluding system policies)
  Removing: KeysusingRSAcryptographyshouldhaveaspecifiedminimumkey-909744685
  Removing: Certificatesshouldbeissuedbyoneofthespecifiednonintegr-165973907
  Removing: Keysshouldhavemorethanthespecifiednumberofdaysbeforeexp-12464927
  Removing: Certificatesshouldnotexpirewithinthespecifiednumberof-2114192775
  Removing: Secretsshouldnotbeactiveforlongerthanthespecifiednumb-1452013840
  Removing: Certificatesshouldbeissuedbythespecifiedintegratedcer-1190107367
  Removing: KeysshouldbebackedbyahardwaresecuritymoduleHSM-593124860
  Removing: Secretsshouldhavecontenttypeset-1186338756
  Removing: AzureKeyVaultshoulddisablepublicnetworkaccess-991364951
  Removing: ResourcelogsinKeyVaultshouldbeenabled-910571065
  Removing: ResourcelogsinAzureKeyVaultManagedHSMshouldbeenabled-1589298772
  Removing: Keyvaultsshouldhavesoftdeleteenabled-506691838
  Removing: KeyVaultsecretsshouldhaveanexpirationdate-1469264985
  Removing: Keyvaultsshouldhavedeletionprotectionenabled-102347970
  Removing: SecurityCenterBuiltIn
  Removing: DeployConfigurediagnosticsettingstoanEventHubtobeenabl-909645055
  Removing: Secretsshouldhavemorethanthespecifiednumberofdaysbefo-1193127515
  Removing: Certificatesshouldhavethespecifiedmaximumvalidityperio-407807336
  Removing: CertificatesusingRSAcryptographyshouldhavethespecifie-2031578458
  Removing: Certificatesshouldhavethespecifiedlifetimeactiontrigg-1761965968
  Removing: Keysshouldnotbeactiveforlongerthanthespecifiednumbero-1296256806
  Removing: Secretsshouldhavethespecifiedmaximumvalidityperiod-1663466362
  Removing: Certificatesshouldbeissuedbythespecifiednonintegratedc-500792775
  Removing: Keysshouldhavethespecifiedmaximumvalidityperiod-906231923
  Removing: Keysshouldhavearotationpolicyensuringthattheirrotatio-1816322754
  Removing: KeysshouldbethespecifiedcryptographictypeRSAorEC-976981238
  Removing: Keysusingellipticcurvecryptographyshouldhavethespecif-1437325202
  Removing: Certificatesusingellipticcurvecryptographyshouldhavea-1468057639
  Removing: Certificatesshoulduseallowedkeytypes-246707145
  Removing: AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-916636521
  Removing: KeyVaultkeysshouldhaveanexpirationdate-1738437431

Removed 31 policy assignments
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript
**********************
PowerShell transcript end
End time: 20260126111516
**********************
