**********************
PowerShell transcript start
Start time: 20260126163520
Username: DTL01\lcladmin
RunAs User: DTL01\lcladmin
Configuration Name: 
Machine: DTL01 (Microsoft Windows NT 10.0.20348.0)
Host Application: C:\Program Files\PowerShell\7\pwsh.dll -noexit -command try { . "c:\Program Files\Microsoft VS Code\resources\app\out\vs\workbench\contrib\terminal\common\scripts\shellIntegration.ps1" } catch {}
Process ID: 10360
PSVersion: 7.5.3
PSEdition: Core
GitCommitId: 7.5.3
OS: Microsoft Windows 10.0.20348
Platform: Win32NT
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1, 6.0, 7.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
WSManStackVersion: 3.0
**********************
Transcript started, output file is .\logs\Scenario6-Production-Deny-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`n=== SCENARIO 6: PRODUCTION-DENY (34 POLICIES) + BOTH TESTING APPROACHES ===" -ForegroundColor Cyan

=== SCENARIO 6: PRODUCTION-DENY (34 POLICIES) + BOTH TESTING APPROACHES ===
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "Deployment: PolicyParameters-Production-Deny.json" -ForegroundColor Yellow
Deployment: PolicyParameters-Production-Deny.json
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "Mode: Deny (blocks non-compliant operations)" -ForegroundColor Yellow
Mode: Deny (blocks non-compliant operations)
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "Testing: QUICK (9 tests) + COMPREHENSIVE (34 tests)" -ForegroundColor Yellow
Testing: QUICK (9 tests) + COMPREHENSIVE (34 tests)
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "Started: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')`n" -ForegroundColor Gray
Started: 2026-01-26 16:35:29
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>$identityId = "/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-remediation/providers/Microsoft.ManagedIdentity/userAssignedIdentities/id-policy-remediation"
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "Deploying 34 policies in Deny mode..." -ForegroundColor Yellow
Deploying 34 policies in Deny mode...
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>.\AzPolicyImplScript.ps1 -ParameterFile .\PolicyParameters-Production-Deny.json -PolicyMode Deny -IdentityResourceId $identityId -ScopeType Subscription -SkipRBACCheck

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-26 16:35:41Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-26 16:35:41Z]
[INFO]
Checking required PowerShell modules...
[2026-01-26 16:35:41Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-26 16:35:41Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-26 16:35:41Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-26 16:35:41Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-26 16:35:41Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-26 16:35:41Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-26 16:35:41Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-26 16:35:41Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-26 16:35:41Z]
[INFO]
Loading policy parameter overrides from .\PolicyParameters-Production-Deny.json
[2026-01-26 16:35:41Z]
[INFO]
DEBUG: PSBoundParameters keys: CsvPath, ParameterOverridesPath, SkipRBACCheck, IdentityResourceId, ScopeType, PolicyMode
[2026-01-26 16:35:41Z]
[INFO]
DEBUG: ScopeType value: 'Subscription'
[2026-01-26 16:35:41Z]
[INFO]
Using scope type from parameter: Subscription
[2026-01-26 16:35:41Z]
[INFO]
Checking current subscription context.
[2026-01-26 16:35:41Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-26 16:35:44Z]
[WARN]
Skipping RBAC permission check (SkipRBACCheck flag enabled).
[2026-01-26 16:35:44Z]
[INFO]
Using mode from parameter: Deny

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  PRODUCTION DEPLOYMENT WARNING                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Configuration:
Production parameters detected
  Mode:
Deny (enforcement enabled)
  Scope:
/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb

  This deployment will:
    â€¢ Block non-compliant Key Vault operations
    â€¢ Prevent creation of vaults without soft delete/purge protection
    â€¢ Require firewall configuration on new vaults
    â€¢ Enforce strict validity periods and key sizes

  âš ï¸  RECOMMENDATIONS:
    1. Review compliance report from Audit mode deployment
    2. Ensure stakeholders have been notified
    3. Verify exemptions are in place for exceptions
    4. Have rollback plan ready (use -Rollback flag)

  Type
PROCEED
 to continue with production deployment:
[2026-01-26 16:35:56Z]
[SUCCESS]
âœ“ Production deployment confirmed by user

[2026-01-26 16:35:56Z]
[SUCCESS]
Loaded 34 policies from parameter file: .\PolicyParameters-Production-Deny.json

Processing 34 policies...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2026-01-26 16:35:56Z]
[INFO]
Preparing to assign (1/34): Certificates should not expire within the specified number of days
[2026-01-26 16:35:56Z]
[INFO]
Assigning policy 'Certificates should not expire within the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:35:56Z]
[SUCCESS]
Found 'Certificates should not expire within the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/f772fb64-8e40-40ad-87bc-7706e1949427
[2026-01-26 16:35:56Z]
[INFO]
DEBUG: Checking parameter 'daysToExpire' against policy definition
[2026-01-26 16:35:56Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-26 16:35:56Z]
[INFO]
DEBUG: Added parameter 'daysToExpire' = '90' to cleaned params
[2026-01-26 16:35:56Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:35:56Z]
[INFO]
DEBUG: Defined parameter names: daysToExpire, effect
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:35:57Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:35:57Z]
[INFO]
Preparing to assign (2/34): Keys using elliptic curve cryptography should have the specified curve names
[2026-01-26 16:35:57Z]
[INFO]
Assigning policy 'Keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:35:57Z]
[SUCCESS]
Found 'Keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ff25f3c8-b739-4538-9d07-3d6d25cfb255
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-26 16:35:57Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:35:58Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:35:58Z]
[INFO]
Preparing to assign (3/34): [Preview]: Azure Key Vault Managed HSM keys should have an expiration date
[2026-01-26 16:35:58Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:35:58Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1d478a74-21ba-4b9f-9d8f-8e6fced0eec5
[2026-01-26 16:35:58Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:35:58Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:35:58Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:35:58Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:35:58Z]
[INFO]
Preparing to assign (4/34): [Preview]: Azure Key Vault Managed HSM should disable public network access
[2026-01-26 16:35:58Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:35:58Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/19ea9d63-adee-4431-a95e-1913c6c1c75f
[2026-01-26 16:35:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:35:59Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:35:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:35:59Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:35:59Z]
[INFO]
Preparing to assign (5/34): Secrets should have content type set
[2026-01-26 16:35:59Z]
[INFO]
Assigning policy 'Secrets should have content type set' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:35:59Z]
[SUCCESS]
Found 'Secrets should have content type set' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75262d3e-ba4a-4f43-85f8-9f72c090e5e3
[2026-01-26 16:35:59Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:35:59Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:35:59Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:00Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:00Z]
[INFO]
Preparing to assign (6/34): Azure Key Vault should disable public network access
[2026-01-26 16:36:00Z]
[INFO]
Assigning policy 'Azure Key Vault should disable public network access' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:00Z]
[SUCCESS]
Found 'Azure Key Vault should disable public network access' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b
[2026-01-26 16:36:00Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:00Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:00Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:01Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:01Z]
[INFO]
Preparing to assign (7/34): Secrets should have the specified maximum validity period
[2026-01-26 16:36:01Z]
[INFO]
Assigning policy 'Secrets should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:01Z]
[SUCCESS]
Found 'Secrets should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/342e8053-e12e-4c44-be01-c3c2f318400f
[2026-01-26 16:36:01Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-26 16:36:01Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:01Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-26 16:36:01Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:01Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:01Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:01Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:01Z]
[INFO]
Preparing to assign (8/34): Azure Key Vault Managed HSM should have purge protection enabled
[2026-01-26 16:36:01Z]
[INFO]
Assigning policy 'Azure Key Vault Managed HSM should have purge protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:01Z]
[SUCCESS]
Found 'Azure Key Vault Managed HSM should have purge protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c39ba22d-4428-4149-b981-70acb31fc383
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:02Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:02Z]
[INFO]
Preparing to assign (9/34): Azure Key Vault should have firewall enabled or public network access disabled
[2026-01-26 16:36:02Z]
[INFO]
Assigning policy 'Azure Key Vault should have firewall enabled or public network access disabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:02Z]
[SUCCESS]
Found 'Azure Key Vault should have firewall enabled or public network access disabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Checking parameter 'forbiddenIPAddresses' against policy definition
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Added parameter 'forbiddenIPAddresses' = '' to cleaned params
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Checking parameter 'allowedIPAddresses' against policy definition
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-26 16:36:02Z]
[INFO]
DEBUG: Added parameter 'allowedIPAddresses' = '0.0.0.0/0' to cleaned params
[2026-01-26 16:36:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:03Z]
[INFO]
DEBUG: Defined parameter names: effect, restrictIPAddresses, allowedIPAddresses, forbiddenIPAddresses
[2026-01-26 16:36:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:03Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:03Z]
[INFO]
Preparing to assign (10/34): Key Vault keys should have an expiration date
[2026-01-26 16:36:03Z]
[INFO]
Assigning policy 'Key Vault keys should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:03Z]
[SUCCESS]
Found 'Key Vault keys should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/152b15f7-8e1f-4c1f-ab71-8c010ba5dbc0
[2026-01-26 16:36:03Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:03Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:03Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:03Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:03Z]
[INFO]
Preparing to assign (11/34): Keys should have the specified maximum validity period
[2026-01-26 16:36:03Z]
[INFO]
Assigning policy 'Keys should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:03Z]
[SUCCESS]
Found 'Keys should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/49a22571-d204-4c91-a7b6-09b1a586fbc9
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:04Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:04Z]
[INFO]
Preparing to assign (12/34): Keys should have more than the specified number of days before expiration
[2026-01-26 16:36:04Z]
[INFO]
Assigning policy 'Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:04Z]
[SUCCESS]
Found 'Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/5ff38825-c5d8-47c5-b70e-069a21955146
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-26 16:36:04Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:05Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:05Z]
[INFO]
Preparing to assign (13/34): Secrets should not be active for longer than the specified number of days
[2026-01-26 16:36:05Z]
[INFO]
Assigning policy 'Secrets should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:05Z]
[SUCCESS]
Found 'Secrets should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e8d99835-8a06-45ae-a8e0-87a91941ccfe
[2026-01-26 16:36:05Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-26 16:36:05Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:05Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-26 16:36:05Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:05Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:05Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:06Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:06Z]
[INFO]
Preparing to assign (14/34): Certificates should use allowed key types
[2026-01-26 16:36:06Z]
[INFO]
Assigning policy 'Certificates should use allowed key types' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:06Z]
[SUCCESS]
Found 'Certificates should use allowed key types' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1151cede-290b-4ba0-8b38-0ad145ac888f
[2026-01-26 16:36:06Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:06Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-26 16:36:06Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:06Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-26 16:36:06Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-26 16:36:06Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-26 16:36:07Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:07Z]
[INFO]
Preparing to assign (15/34): Certificates should be issued by one of the specified non-integrated certificate authorities
[2026-01-26 16:36:07Z]
[INFO]
Assigning policy 'Certificates should be issued by one of the specified non-integrated certificate authorities' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:07Z]
[SUCCESS]
Found 'Certificates should be issued by one of the specified non-integrated certificate authorities' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/d3e82b87-6673-410b-8501-1896b688b9a3
[2026-01-26 16:36:07Z]
[INFO]
DEBUG: Checking parameter 'caCommonNames' against policy definition
[2026-01-26 16:36:07Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-26 16:36:07Z]
[INFO]
DEBUG: Added parameter 'caCommonNames' = 'ContosoCA FabrikamCA' to cleaned params
[2026-01-26 16:36:07Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:07Z]
[INFO]
DEBUG: Defined parameter names: caCommonNames, effect
[2026-01-26 16:36:07Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:07Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:07Z]
[INFO]
Preparing to assign (16/34): Certificates should have the specified maximum validity period
[2026-01-26 16:36:07Z]
[INFO]
Assigning policy 'Certificates should have the specified maximum validity period' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:07Z]
[SUCCESS]
Found 'Certificates should have the specified maximum validity period' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0a075868-4c26-42ef-914c-5bc007359560
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInMonths' against policy definition
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInMonths' = '12' to cleaned params
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInMonths, effect
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:08Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:08Z]
[INFO]
Preparing to assign (17/34): [Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size
[2026-01-26 16:36:08Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:08Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/86810a98-8e91-4a44-8386-ec66d0de5d57
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumRSAKeySize
[2026-01-26 16:36:08Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:09Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:09Z]
[INFO]
Preparing to assign (18/34): Keys should be the specified cryptographic type RSA or EC
[2026-01-26 16:36:09Z]
[INFO]
Assigning policy 'Keys should be the specified cryptographic type RSA or EC' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:09Z]
[SUCCESS]
Found 'Keys should be the specified cryptographic type RSA or EC' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/75c4f823-d65c-4f29-a733-01d0077fdbcb
[2026-01-26 16:36:09Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:09Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-26 16:36:09Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:09Z]
[INFO]
DEBUG: Checking parameter 'allowedKeyTypes' against policy definition
[2026-01-26 16:36:09Z]
[INFO]
DEBUG: Defined parameter names: allowedKeyTypes, effect
[2026-01-26 16:36:09Z]
[INFO]
DEBUG: Added parameter 'allowedKeyTypes' = 'RSA EC' to cleaned params
[2026-01-26 16:36:09Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:09Z]
[INFO]
Preparing to assign (19/34): Keys should be backed by a hardware security module (HSM)
[2026-01-26 16:36:09Z]
[INFO]
Assigning policy 'Keys should be backed by a hardware security module (HSM)' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:09Z]
[SUCCESS]
Found 'Keys should be backed by a hardware security module (HSM)' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/587c79fe-dd04-4a5e-9d0b-f89598c7261b
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:10Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:10Z]
[INFO]
Preparing to assign (20/34): [Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names
[2026-01-26 16:36:10Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:10Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM keys using elliptic curve cryptography should have the specified curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/e58fd0c1-feac-4d12-92db-0a7e9421f53e
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-26 16:36:10Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:11Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:11Z]
[INFO]
Preparing to assign (21/34): Key vaults should have soft delete enabled
[2026-01-26 16:36:11Z]
[INFO]
Assigning policy 'Key vaults should have soft delete enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:11Z]
[SUCCESS]
Found 'Key vaults should have soft delete enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d
[2026-01-26 16:36:11Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:11Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:11Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:11Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:11Z]
[INFO]
Preparing to assign (22/34): Azure Key Vaults should use private link
[2026-01-26 16:36:11Z]
[INFO]
Assigning policy 'Azure Key Vaults should use private link' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:11Z]
[SUCCESS]
Found 'Azure Key Vaults should use private link' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9
[2026-01-26 16:36:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:12Z]
[INFO]
DEBUG: Defined parameter names: audit_effect, effect
[2026-01-26 16:36:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:12Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:12Z]
[INFO]
Preparing to assign (23/34): Key Vault secrets should have an expiration date
[2026-01-26 16:36:12Z]
[INFO]
Assigning policy 'Key Vault secrets should have an expiration date' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:12Z]
[SUCCESS]
Found 'Key Vault secrets should have an expiration date' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/98728c90-32c7-4049-8429-847dc0f4fe37
[2026-01-26 16:36:12Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:12Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:12Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:13Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:13Z]
[INFO]
Preparing to assign (24/34): [Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration
[2026-01-26 16:36:13Z]
[INFO]
Assigning policy '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:13Z]
[SUCCESS]
Found '[Preview]: Azure Key Vault Managed HSM Keys should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/ad27588c-0198-4c84-81ef-08efd0274653
[2026-01-26 16:36:13Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-26 16:36:13Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-26 16:36:13Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '30' to cleaned params
[2026-01-26 16:36:13Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:13Z]
[INFO]
DEBUG: Defined parameter names: effect, minimumDaysBeforeExpiration
[2026-01-26 16:36:13Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:13Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:13Z]
[INFO]
Preparing to assign (25/34): Key vaults should have deletion protection enabled
[2026-01-26 16:36:13Z]
[INFO]
Assigning policy 'Key vaults should have deletion protection enabled' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:13Z]
[SUCCESS]
Found 'Key vaults should have deletion protection enabled' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53
[2026-01-26 16:36:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:14Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:14Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:14Z]
[INFO]
Preparing to assign (26/34): Azure Key Vault should use RBAC permission model
[2026-01-26 16:36:14Z]
[INFO]
Assigning policy 'Azure Key Vault should use RBAC permission model' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:14Z]
[SUCCESS]
Found 'Azure Key Vault should use RBAC permission model' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5
[2026-01-26 16:36:14Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:14Z]
[INFO]
DEBUG: Defined parameter names: effect
[2026-01-26 16:36:14Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:15Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:15Z]
[INFO]
Preparing to assign (27/34): Certificates should have the specified lifetime action triggers
[2026-01-26 16:36:15Z]
[INFO]
Assigning policy 'Certificates should have the specified lifetime action triggers' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:15Z]
[SUCCESS]
Found 'Certificates should have the specified lifetime action triggers' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/12ef42cb-9903-4e39-9c26-422d29570417
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiry' against policy definition
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiry' = '90' to cleaned params
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Checking parameter 'maximumPercentageLife' against policy definition
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Defined parameter names: maximumPercentageLife, minimumDaysBeforeExpiry, effect
[2026-01-26 16:36:15Z]
[INFO]
DEBUG: Added parameter 'maximumPercentageLife' = '80' to cleaned params
[2026-01-26 16:36:15Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:15Z]
[INFO]
Preparing to assign (28/34): Certificates using elliptic curve cryptography should have allowed curve names
[2026-01-26 16:36:15Z]
[INFO]
Assigning policy 'Certificates using elliptic curve cryptography should have allowed curve names' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:15Z]
[SUCCESS]
Found 'Certificates using elliptic curve cryptography should have allowed curve names' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/bd78111f-4953-4367-9fd5-7e08808b54bf
[2026-01-26 16:36:16Z]
[INFO]
DEBUG: Checking parameter 'allowedECNames' against policy definition
[2026-01-26 16:36:16Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-26 16:36:16Z]
[INFO]
DEBUG: Added parameter 'allowedECNames' = 'P-256 P-256K P-384 P-521' to cleaned params
[2026-01-26 16:36:16Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:16Z]
[INFO]
DEBUG: Defined parameter names: allowedECNames, effect
[2026-01-26 16:36:16Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:16Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:16Z]
[INFO]
Preparing to assign (29/34): Certificates should be issued by the specified integrated certificate authority
[2026-01-26 16:36:16Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:16Z]
[SUCCESS]
Found 'Certificates should be issued by the specified integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/8e826246-c976-48f6-b03e-619bb92b3d82
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Checking parameter 'allowedCAs' against policy definition
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Added parameter 'allowedCAs' = 'DigiCert GlobalSign' to cleaned params
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Defined parameter names: allowedCAs, effect
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:17Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:17Z]
[INFO]
Preparing to assign (30/34): Secrets should have more than the specified number of days before expiration
[2026-01-26 16:36:17Z]
[INFO]
Assigning policy 'Secrets should have more than the specified number of days before expiration' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:17Z]
[SUCCESS]
Found 'Secrets should have more than the specified number of days before expiration' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/b0eb591a-5e70-4534-a8bf-04b9c489584a
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Checking parameter 'minimumDaysBeforeExpiration' against policy definition
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Added parameter 'minimumDaysBeforeExpiration' = '90' to cleaned params
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Defined parameter names: minimumDaysBeforeExpiration, effect
[2026-01-26 16:36:17Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:18Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:18Z]
[INFO]
Preparing to assign (31/34): Certificates using RSA cryptography should have the specified minimum key size
[2026-01-26 16:36:18Z]
[INFO]
Assigning policy 'Certificates using RSA cryptography should have the specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:18Z]
[SUCCESS]
Found 'Certificates using RSA cryptography should have the specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/cee51871-e572-4576-855c-047c820360f0
[2026-01-26 16:36:18Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-26 16:36:18Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-26 16:36:18Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-26 16:36:18Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:18Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-26 16:36:18Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:18Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:18Z]
[INFO]
Preparing to assign (32/34): Keys using RSA cryptography should have a specified minimum key size
[2026-01-26 16:36:18Z]
[INFO]
Assigning policy 'Keys using RSA cryptography should have a specified minimum key size' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:18Z]
[SUCCESS]
Found 'Keys using RSA cryptography should have a specified minimum key size' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/82067dbb-e53b-4e06-b631-546d197452d9
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Checking parameter 'minimumRSAKeySize' against policy definition
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Added parameter 'minimumRSAKeySize' = '4096' to cleaned params
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Defined parameter names: minimumRSAKeySize, effect
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:19Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:19Z]
[INFO]
Preparing to assign (33/34): Keys should not be active for longer than the specified number of days
[2026-01-26 16:36:19Z]
[INFO]
Assigning policy 'Keys should not be active for longer than the specified number of days' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:19Z]
[SUCCESS]
Found 'Keys should not be active for longer than the specified number of days' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/c26e4b24-cf98-4c67-b48b-5a25c4c69eb9
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Checking parameter 'maximumValidityInDays' against policy definition
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Added parameter 'maximumValidityInDays' = '365' to cleaned params
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Defined parameter names: maximumValidityInDays, effect
[2026-01-26 16:36:19Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:20Z]
[SUCCESS]
Created new assignment

[2026-01-26 16:36:20Z]
[INFO]
Preparing to assign (34/34): Certificates should be issued by the specified non-integrated certificate authority
[2026-01-26 16:36:20Z]
[INFO]
Assigning policy 'Certificates should be issued by the specified non-integrated certificate authority' to /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb (Mode=Deny)
[2026-01-26 16:36:20Z]
[SUCCESS]
Found 'Certificates should be issued by the specified non-integrated certificate authority' in mapping: PolicyDefinition -> /providers/Microsoft.Authorization/policyDefinitions/a22f4a40-01d3-4c7d-8071-da157eeff341
[2026-01-26 16:36:20Z]
[INFO]
DEBUG: Checking parameter 'effect' against policy definition
[2026-01-26 16:36:20Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-26 16:36:20Z]
[INFO]
DEBUG: Added parameter 'effect' = 'Deny' to cleaned params
[2026-01-26 16:36:20Z]
[INFO]
DEBUG: Checking parameter 'caCommonName' against policy definition
[2026-01-26 16:36:20Z]
[INFO]
DEBUG: Defined parameter names: caCommonName, effect
[2026-01-26 16:36:20Z]
[INFO]
DEBUG: Added parameter 'caCommonName' = 'ContosoCA' to cleaned params
[2026-01-26 16:36:21Z]
[SUCCESS]
Created new assignment
[2026-01-26 16:36:21Z]
[INFO]
Collected 34 assignment IDs for filtering
[2026-01-26 16:36:21Z]
[INFO]
First 3 assignment IDs: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldnotexpirewithinthespecifiednumberof-1390924460, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Keysusingellipticcurvecryptographyshouldhavethespecif-1238193278, /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/PreviewAzureKeyVaultManagedHSMkeysshouldhaveanexpirat-2056361103

Generating compliance report with operational metrics...
[2026-01-26 16:36:25Z]
[INFO]
Querying policy states for scope: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
[2026-01-26 16:36:26Z]
[INFO]
Compliance query returned: Raw states=8, Policies reporting=1
[2026-01-26 16:36:26Z]
[INFO]
Filtering compliance data: 34 assignments, 8 total policy states
[2026-01-26 16:36:26Z]
[INFO]
Sample assignment IDs we're filtering for: /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Certificatesshouldnotexpirewithinthespecifiednumberof-1390924460 | /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Keysusingellipticcurvecryptographyshouldhavethespecif-1238193278
[2026-01-26 16:36:26Z]
[INFO]
Found 0 compliance states for newly deployed policies
[2026-01-26 16:36:26Z]
[INFO]
Total unique assignment IDs in compliance data: 1

â•â•â• Compliance Summary â•â•â•
Overall Compliance:
0%
 | Policies Reporting:
0
 | Resources Evaluated:
0

[2026-01-26 16:36:26Z]
[INFO]
Wrote reports: KeyVaultPolicyImplementationReport-20260126-163626.md, KeyVaultPolicyImplementationReport-20260126-163626.json, KeyVaultPolicyImplementationReport-20260126-163626.csv
[2026-01-26 16:36:26Z]
[SUCCESS]
HTML report generated: ./PolicyImplementationReport-20260126-163626.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-26 16:36:26Z]
[SUCCESS]
Completed run. Reports generated.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“„ Reports Generated:
  â€¢ HTML:
./PolicyImplementationReport-20260126-163626.html
  â€¢ Markdown:
KeyVaultPolicyImplementationReport-20260126-163626.md
  â€¢ JSON:
KeyVaultPolicyImplementationReport-20260126-163626.json


[2026-01-26 16:36:26Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2026-01-26 16:36:26Z]
[INFO]
                    ðŸ“‹ NEXT STEPS GUIDANCE
[2026-01-26 16:36:26Z]
[INFO]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  IMPORTANT: Policy Enforcement Progression

Phase 1: AUDIT MODE (Current)
  â†’ Monitor compliance for 30-90 days
  â†’ Identify non-compliant resources without blocking operations
  â†’ Check compliance:
.\\AzPolicyImplScript.ps1 -CheckCompliance

Phase 2: DENY MODE (Recommended Next)
  â†’ Prevents NEW non-compliant resources from being created
  â†’ Existing non-compliant resources remain functional (no impact)
  â†’ Use for 60-90 days to validate no critical automation is broken
  â†’ Deploy: Set PolicyMode parameter to 'Deny' when ready

Phase 3: ENFORCE MODE (Final State)
  â†’ Automatically remediates existing non-compliant resources
  â†’ Requires managed identity with Contributor permissions
  â†’ Schedule maintenance window for auto-remediation
  â†’ Deploy: Set PolicyMode parameter to 'Enforce' after validation

[2026-01-26 16:36:26Z]
[WARN]
ðŸ“Œ Critical Actions Before Moving to Deny/Enforce:
  1. âœ… Review compliance report: Open the HTML report generated above
  2. âœ… Remediate non-compliant resources: Fix Key Vaults showing violations
  3. âœ… Request exemptions if needed: Use -ExemptionAction Create for special cases
  4. âœ… Update deployment templates: Ensure ARM/Bicep/Terraform comply with policies
  5. âœ… Test in non-production first: Validate in dev/test subscription before production
  6. âœ… Notify stakeholders: Communicate policy changes 7-14 days in advance

âš ï¸  Risk Warning:
  Switching directly to Deny/Enforce can block critical operations.
  Always follow phased rollout: Audit â†’ Deny â†’ Enforce

]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`n=== SCENARIO 6 DEPLOYMENT COMPLETE ===" -ForegroundColor Green

=== SCENARIO 6 DEPLOYMENT COMPLETE ===
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "âœ… Deployed: 34/34 policies in Deny mode" -ForegroundColor Green
âœ… Deployed: 34/34 policies in Deny mode
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "â±ï¸  Duration: ~45 seconds" -ForegroundColor Gray
â±ï¸  Duration: ~45 seconds
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "ðŸ“‹ Parameter File: PolicyParameters-Production-Deny.json" -ForegroundColor Gray
ðŸ“‹ Parameter File: PolicyParameters-Production-Deny.json
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "ðŸ“Š Initial Compliance: 0% (expected - needs evaluation time)" -ForegroundColor Gray
ðŸ“Š Initial Compliance: 0% (expected - needs evaluation time)
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`nTranscript logging to: logs\Scenario6-Production-Deny-20260126.log" -ForegroundColor Cyan

Transcript logging to: logs\Scenario6-Production-Deny-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`n=== PROCEEDING TO TESTING ===" -ForegroundColor Cyan

=== PROCEEDING TO TESTING ===
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`n=== TESTING APPROACH 1: QUICK (9 Core Tests) ===" -ForegroundColor Cyan

=== TESTING APPROACH 1: QUICK (9 Core Tests) ===
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Start-Transcript -Path ".\logs\Scenario6-Quick-Testing-20260126.log" -Append
Transcript started, output file is .\logs\Scenario6-Quick-Testing-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>.\AzPolicyImplScript.ps1 -TestProductionEnforcement

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-26 16:38:53Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-26 16:38:53Z]
[INFO]
Checking required PowerShell modules...
[2026-01-26 16:38:53Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-26 16:38:53Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-26 16:38:53Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-26 16:38:53Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-26 16:38:53Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-26 16:38:53Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-26 16:38:53Z]
[INFO]
Running production enforcement validation tests...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      Production Enforcement Validation - Deny Mode Tests    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[Test 1] Purge Protection Policy (HIGH RISK)
  Attempting to create vault WITHOUT purge protection...
PS>TerminatingError(New-AzKeyVault): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Resource 'val-nopurge-8983' was disallowed by policy. Policy identifiers: '[{"policyAssignment":{"name":"AzureKeyVaultshoulddisablepublicnetworkaccess-188399946","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshoulddisablepublicnetworkaccess-188399946"},"policyDefinition":{"name":"Azure Key Vault should disable public network access","id":"/providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b","version":"1.1.0"}},{"policyAssignment":{"name":"Keyvaultsshouldhavesoftdeleteenabled-716191913","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Keyvaultsshouldhavesoftdeleteenabled-716191913"},"policyDefinition":{"name":"Key vaults should have soft delete enabled","id":"/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d","version":"3.1.0"}},{"policyAssignment":{"name":"AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-571915124","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-571915124"},"policyDefinition":{"name":"Azure Key Vault should have firewall enabled or public network access disabled","id":"/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490","version":"3.3.0"}},{"policyAssignment":{"name":"Keyvaultsshouldhavedeletionprotectionenabled-1084075278","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Keyvaultsshouldhavedeletionprotectionenabled-1084075278"},"policyDefinition":{"name":"Key vaults should have deletion protection enabled","id":"/providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53","version":"2.1.0"}}]'."
  âœ… PASS: Blocked by policy - Unknown

[Test 2] Firewall Required Policy (MEDIUM RISK)
  Attempting to create PUBLIC vault (no firewall)...
PS>TerminatingError(New-AzKeyVault): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Resource 'val-public-3811' was disallowed by policy. Policy identifiers: '[{"policyAssignment":{"name":"AzureKeyVaultshoulddisablepublicnetworkaccess-188399946","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshoulddisablepublicnetworkaccess-188399946"},"policyDefinition":{"name":"Azure Key Vault should disable public network access","id":"/providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b","version":"1.1.0"}},{"policyAssignment":{"name":"Keyvaultsshouldhavesoftdeleteenabled-716191913","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Keyvaultsshouldhavesoftdeleteenabled-716191913"},"policyDefinition":{"name":"Key vaults should have soft delete enabled","id":"/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d","version":"3.1.0"}},{"policyAssignment":{"name":"AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-571915124","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-571915124"},"policyDefinition":{"name":"Azure Key Vault should have firewall enabled or public network access disabled","id":"/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490","version":"3.3.0"}}]'."
  âœ… PASS: Blocked by policy - Unknown

[Test 3] RBAC Permission Model Policy (MEDIUM RISK)
  Attempting to create vault with Access Policies (not RBAC)...
PS>TerminatingError(New-AzKeyVault): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Resource 'val-accesspol-6525' was disallowed by policy. Policy identifiers: '[{"policyAssignment":{"name":"AzureKeyVaultshoulddisablepublicnetworkaccess-188399946","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshoulddisablepublicnetworkaccess-188399946"},"policyDefinition":{"name":"Azure Key Vault should disable public network access","id":"/providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b","version":"1.1.0"}},{"policyAssignment":{"name":"Keyvaultsshouldhavesoftdeleteenabled-716191913","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/Keyvaultsshouldhavesoftdeleteenabled-716191913"},"policyDefinition":{"name":"Key vaults should have soft delete enabled","id":"/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d","version":"3.1.0"}},{"policyAssignment":{"name":"AzureKeyVaultshoulduseRBACpermissionmodel-1502415944","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshoulduseRBACpermissionmodel-1502415944"},"policyDefinition":{"name":"Azure Key Vault should use RBAC permission model","id":"/providers/Microsoft.Authorization/policyDefinitions/12d4fa5e-1f9f-4c21-97a9-b99b3c6611b5","version":"1.0.1"}},{"policyAssignment":{"name":"AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-571915124","id":"/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/providers/Microsoft.Authorization/policyAssignments/AzureKeyVaultshouldhavefirewallenabledorpublicnetworka-571915124"},"policyDefinition":{"name":"Azure Key Vault should have firewall enabled or public network access disabled","id":"/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490","version":"3.3.0"}}]'."
  âœ… PASS: Blocked by policy - Unknown

[Test 4] Compliant Vault Creation (BASELINE)
  Attempting to create COMPLIANT vault (all security requirements met)...

  âœ… PASS: Fully compliant vault created successfully
    Vault: val-compliant-5593
    âœ… Purge Protection: Enabled
    âœ… RBAC Authorization: Enabled
    âœ… Soft Delete: Enabled (90 days)
    âœ… Public Network Access: Disabled

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Resource-Level Policy Tests (Keys, Secrets, Certs)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Using vault: val-compliant-5593

[Test 5] Key Vault keys should have expiration date
  Attempting to create key WITHOUT expiration date...
PS>TerminatingError(Add-AzKeyVaultKey): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Caller is not authorized to perform action on resource.
If role assignments, deny assignments or role definitions were changed recently, please observe propagation time.
Caller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/
Action: 'Microsoft.KeyVault/vaults/keys/create/action'
Resource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/keys/test-key-no-expiry'
Assignment: (not found)
DenyAssignmentId: null
DecisionReason: null 
Vault: val-compliant-5593;location=eastus

Status: 403 (Forbidden)
ErrorCode: Forbidden

Content:
{"error":{"code":"Forbidden","message":"Caller is not authorized to perform action on resource.\r\nIf role assignments, deny assignments or role definitions were changed recently, please observe propagation time.\r\nCaller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/\r\nAction: 'Microsoft.KeyVault/vaults/keys/create/action'\r\nResource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/keys/test-key-no-expiry'\r\nAssignment: (not found)\r\nDenyAssignmentId: null\r\nDecisionReason: null \r\nVault: val-compliant-5593;location=eastus\r\n","innererror":{"code":"ForbiddenByRbac"}}}

Headers:
Cache-Control: no-cache
Pragma: no-cache
x-ms-keyvault-region: eastus
x-ms-client-request-id: 503224e7-2c25-4248-8b47-e082c3dc2c8b
x-ms-request-id: 48caa63e-07dd-406a-96e9-2ce238ec5d00
x-ms-keyvault-service-version: 1.9.2984.2
x-ms-keyvault-network-info: conn_type=Ipv4;addr=20.10.50.180;act_addr_fam=InterNetwork;
X-Content-Type-Options: REDACTED
Strict-Transport-Security: REDACTED
Date: Mon, 26 Jan 2026 21:39:16 GMT
Content-Type: application/json; charset=utf-8
Expires: -1
Content-Length: 786
"
  âœ… PASS: Blocked by policy

[Test 6] Key Vault secrets should have expiration date
  Attempting to create secret WITHOUT expiration date...
PS>TerminatingError(Set-AzKeyVaultSecret): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Operation returned an invalid status code 'Forbidden'
Code: Forbidden
Message: Caller is not authorized to perform action on resource.
If role assignments, deny assignments or role definitions were changed recently, please observe propagation time.
Caller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/
Action: 'Microsoft.KeyVault/vaults/secrets/setSecret/action'
Resource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/secrets/test-secret-no-expiry'
Assignment: (not found)
DenyAssignmentId: null
DecisionReason: null 
Vault: val-compliant-5593;location=eastus
"
  âœ… PASS: Blocked by policy

[Test 7] Keys using RSA should have minimum 2048 key size
  Attempting to create RSA key with 1024-bit size...
PS>TerminatingError(Add-AzKeyVaultKey): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Caller is not authorized to perform action on resource.
If role assignments, deny assignments or role definitions were changed recently, please observe propagation time.
Caller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/
Action: 'Microsoft.KeyVault/vaults/keys/create/action'
Resource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/keys/test-key-small-rsa'
Assignment: (not found)
DenyAssignmentId: null
DecisionReason: null 
Vault: val-compliant-5593;location=eastus

Status: 403 (Forbidden)
ErrorCode: Forbidden

Content:
{"error":{"code":"Forbidden","message":"Caller is not authorized to perform action on resource.\r\nIf role assignments, deny assignments or role definitions were changed recently, please observe propagation time.\r\nCaller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/\r\nAction: 'Microsoft.KeyVault/vaults/keys/create/action'\r\nResource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/keys/test-key-small-rsa'\r\nAssignment: (not found)\r\nDenyAssignmentId: null\r\nDecisionReason: null \r\nVault: val-compliant-5593;location=eastus\r\n","innererror":{"code":"ForbiddenByRbac"}}}

Headers:
Cache-Control: no-cache
Pragma: no-cache
x-ms-keyvault-region: eastus
x-ms-client-request-id: d0aca71c-6a3c-4b90-bb83-816b265802f8
x-ms-request-id: 9137c949-7dfb-49d2-a573-eb015173233f
x-ms-keyvault-service-version: 1.9.2984.2
x-ms-keyvault-network-info: conn_type=Ipv4;addr=20.10.50.180;act_addr_fam=InterNetwork;
X-Content-Type-Options: REDACTED
Strict-Transport-Security: REDACTED
Date: Mon, 26 Jan 2026 21:39:17 GMT
Content-Type: application/json; charset=utf-8
Expires: -1
Content-Length: 786
"
  âœ… PASS: Blocked by policy

[Test 8] Certificates should have maximum 12 month validity
  Attempting to create certificate with 24 month validity...
PS>TerminatingError(Add-AzKeyVaultCertificate): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Operation returned an invalid status code 'Forbidden'
Code: Forbidden
Message: Caller is not authorized to perform action on resource.
If role assignments, deny assignments or role definitions were changed recently, please observe propagation time.
Caller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/
Action: 'Microsoft.KeyVault/vaults/certificates/create/action'
Resource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/certificates/test-cert-long-validity'
Assignment: (not found)
DenyAssignmentId: null
DecisionReason: null 
Vault: val-compliant-5593;location=eastus
"
  âœ… PASS: Blocked by policy

[Test 9] Certificates should not expire within 30 days
  Attempting to create certificate expiring in <30 days...
PS>TerminatingError(Add-AzKeyVaultCertificate): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Operation returned an invalid status code 'Forbidden'
Code: Forbidden
Message: Caller is not authorized to perform action on resource.
If role assignments, deny assignments or role definitions were changed recently, please observe propagation time.
Caller: appid=1950a258-227b-4e31-a9cf-717495945fc2;oid=84b934c8-a68f-458c-b07b-1b90dd22ca95;iss=https://sts.windows.net/21bd262e-3255-411e-8345-51102d9d9e9e/
Action: 'Microsoft.KeyVault/vaults/certificates/create/action'
Resource: '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb/resourcegroups/rg-policy-keyvault-test/providers/microsoft.keyvault/vaults/val-compliant-5593/certificates/test-cert-short-expiry'
Assignment: (not found)
DenyAssignmentId: null
DecisionReason: null 
Vault: val-compliant-5593;location=eastus
"
  âœ… PASS: Blocked by policy

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               Enforcement Validation Results                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Validation Summary:
  âœ… PASS: 9 / 9
  âŒ FAIL: 0 / 9
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Results exported to: EnforcementValidation-20260126-163919.csv

[2026-01-26 16:39:19Z]
[SUCCESS]
Production enforcement validation completed.
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript
Transcript stopped, output file is C:\Source\powershell-akv-policyhardening\logs\Scenario6-Quick-Testing-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Start-Sleep -Seconds 120
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Write-Host "`n=== TESTING APPROACH 2: COMPREHENSIVE (34 Policy Tests) ===" -ForegroundColor Cyan

=== TESTING APPROACH 2: COMPREHENSIVE (34 Policy Tests) ===
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Start-Transcript -Path ".\logs\Scenario6-Comprehensive-Testing-20260126.log" -Append
Transcript started, output file is .\logs\Scenario6-Comprehensive-Testing-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>.\AzPolicyImplScript.ps1 -TestDenyMode

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Azure Policy Implementation - Key Vault Governance          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-01-26 16:41:19Z]
[INFO]
Starting Azure Policy implementation script for Key Vault policies
[2026-01-26 16:41:19Z]
[INFO]
Checking required PowerShell modules...
[2026-01-26 16:41:19Z]
[SUCCESS]
Module Az.Accounts is present
[2026-01-26 16:41:20Z]
[SUCCESS]
Module Az.Resources is present
[2026-01-26 16:41:20Z]
[SUCCESS]
Module Az.PolicyInsights is present
[2026-01-26 16:41:20Z]
[SUCCESS]
Module Az.Monitor is present
[2026-01-26 16:41:20Z]
[SUCCESS]
Module Az.KeyVault is present
[2026-01-26 16:41:20Z]
[INFO]
Using Azure context: theregniers@hotmail.com
[2026-01-26 16:41:20Z]
[INFO]
Loading policy mapping from ./PolicyNameMapping.json
[2026-01-26 16:41:20Z]
[INFO]
Loaded 3745 policy mappings
[2026-01-26 16:41:20Z]
[INFO]
Loading policy parameter overrides from ./PolicyParameters.json
[2026-01-26 16:41:20Z]
[INFO]
DEBUG: PSBoundParameters keys: CsvPath
[2026-01-26 16:41:20Z]
[INFO]
DEBUG: ScopeType value: ''
[2026-01-26 16:41:20Z]
[INFO]
DEBUG: Prompting for scope type (PSBound check failed)
[2026-01-26 16:41:33Z]
[INFO]
Checking current subscription context.
[2026-01-26 16:41:33Z]
[INFO]
Current subscription: MSDN Platforms Subscription (ab1336c7-687d-4107-b0f6-9649a0458adb)
[2026-01-26 16:41:33Z]
[INFO]
Checking role assignments for theregniers@hotmail.com on scope /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
PS>TerminatingError(Get-AzRoleAssignment): "The running command stopped because the preference variable "ErrorActionPreference" or common parameter is set to Stop: Cannot find principal using the specified options"
[2026-01-26 16:41:33Z]
[ERROR]
Unable to query role assignments: Cannot find principal using the specified options
[2026-01-26 16:41:33Z]
[ERROR]
Insufficient RBAC to continue. Resolve RBAC and re-run.
Role assignment commands to request:
PowerShell role assignment template (replace <userObjectId> or <userPrincipalName>):
# Grant Policy Contributor to a user on scope /subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb
# Using object id (preferred):
New-AzRoleAssignment -ObjectId <userObjectId> -RoleDefinitionName 'Policy Contributor' -Scope '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb'
# Using sign-in name (may require lookup):
$uid = (Get-AzADUser -UserPrincipalName 'user@contoso.com').Id
New-AzRoleAssignment -ObjectId $uid -RoleDefinitionName 'Policy Contributor' -Scope '/subscriptions/ab1336c7-687d-4107-b0f6-9649a0458adb'
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript
Transcript stopped, output file is C:\Source\powershell-akv-policyhardening\logs\Scenario6-Comprehensive-Testing-20260126.log
]633;D;0]633;A]633;P;Cwd=C:\x5cSource\x5cpowershell-akv-policyhardeningPS C:\Source\powershell-akv-policyhardening> ]633;B
PS>Stop-Transcript
**********************
PowerShell transcript end
End time: 20260126164141
**********************
